<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>èƒŒç¦»æŠ€æœ¯åˆ†æ - ä»£ç å®ç°ä¸å›æµ‹å±•ç¤º</title>
    <script src="https://cdn.jsdelivr.net/npm/lightweight-charts@4.1.0/dist/lightweight-charts.standalone.production.js"></script>
    <style>
        :root {
            --bg-primary: #0f1117;
            --bg-secondary: #1a1d29;
            --bg-card: #1e2130;
            --bg-hover: #262a3d;
            --text-primary: #e1e4ea;
            --text-secondary: #8b8fa3;
            --text-muted: #5c6078;
            --accent-blue: #4a9eff;
            --accent-green: #00d68f;
            --accent-red: #ff4d6a;
            --accent-yellow: #ffaa00;
            --accent-purple: #a855f7;
            --border: #2a2d3e;
            --sidebar-w: 280px;
        }

        * { margin: 0; padding: 0; box-sizing: border-box; }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Noto Sans SC', sans-serif;
            background: var(--bg-primary);
            color: var(--text-primary);
            display: flex;
            height: 100vh;
            overflow: hidden;
        }

        /* ===== Sidebar ===== */
        .sidebar {
            width: var(--sidebar-w);
            min-width: var(--sidebar-w);
            background: var(--bg-secondary);
            border-right: 1px solid var(--border);
            display: flex;
            flex-direction: column;
            overflow-y: auto;
        }

        .sidebar-header {
            padding: 24px 20px 16px;
            border-bottom: 1px solid var(--border);
        }

        .sidebar-header h1 {
            font-size: 18px;
            font-weight: 700;
            background: linear-gradient(135deg, var(--accent-blue), var(--accent-purple));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            margin-bottom: 4px;
        }

        .sidebar-header p {
            font-size: 12px;
            color: var(--text-muted);
        }

        .nav-section {
            padding: 12px 0;
            border-bottom: 1px solid var(--border);
        }

        .nav-section-title {
            font-size: 11px;
            font-weight: 600;
            color: var(--text-muted);
            text-transform: uppercase;
            letter-spacing: 0.5px;
            padding: 0 20px;
            margin-bottom: 4px;
        }

        .nav-item {
            display: flex;
            align-items: center;
            padding: 8px 20px;
            cursor: pointer;
            font-size: 13px;
            color: var(--text-secondary);
            transition: all 0.15s;
            gap: 10px;
        }

        .nav-item:hover {
            background: var(--bg-hover);
            color: var(--text-primary);
        }

        .nav-item.active {
            background: rgba(74, 158, 255, 0.1);
            color: var(--accent-blue);
            border-left: 2px solid var(--accent-blue);
        }

        .nav-icon {
            width: 18px;
            text-align: center;
            font-size: 14px;
        }

        /* ===== Main Content ===== */
        .main-content {
            flex: 1;
            overflow-y: auto;
            padding: 0;
        }

        .page {
            display: none;
            padding: 32px 40px;
            max-width: 1200px;
        }

        .page.active { display: block; }

        .page-title {
            font-size: 28px;
            font-weight: 700;
            margin-bottom: 8px;
        }

        .page-subtitle {
            font-size: 14px;
            color: var(--text-secondary);
            margin-bottom: 32px;
        }

        /* Cards */
        .card {
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: 12px;
            padding: 24px;
            margin-bottom: 20px;
        }

        .card-title {
            font-size: 16px;
            font-weight: 600;
            margin-bottom: 16px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .badge {
            display: inline-block;
            font-size: 11px;
            font-weight: 600;
            padding: 2px 8px;
            border-radius: 10px;
            background: rgba(74, 158, 255, 0.15);
            color: var(--accent-blue);
        }

        .badge.green { background: rgba(0, 214, 143, 0.15); color: var(--accent-green); }
        .badge.red { background: rgba(255, 77, 106, 0.15); color: var(--accent-red); }
        .badge.yellow { background: rgba(255, 170, 0, 0.15); color: var(--accent-yellow); }
        .badge.purple { background: rgba(168, 85, 247, 0.15); color: var(--accent-purple); }

        /* Stats Grid */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 16px;
            margin-bottom: 24px;
        }

        .stat-card {
            background: var(--bg-secondary);
            border: 1px solid var(--border);
            border-radius: 10px;
            padding: 16px;
        }

        .stat-label {
            font-size: 12px;
            color: var(--text-muted);
            margin-bottom: 6px;
        }

        .stat-value {
            font-size: 24px;
            font-weight: 700;
        }

        .stat-value.positive { color: var(--accent-green); }
        .stat-value.negative { color: var(--accent-red); }

        .stat-note {
            font-size: 11px;
            color: var(--text-muted);
            margin-top: 4px;
        }

        /* Chapter Outline */
        .chapter {
            margin-bottom: 24px;
        }

        .chapter-header {
            display: flex;
            align-items: center;
            gap: 12px;
            margin-bottom: 12px;
            cursor: pointer;
        }

        .chapter-num {
            width: 36px;
            height: 36px;
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 14px;
            font-weight: 700;
            flex-shrink: 0;
        }

        .chapter-num.ch1 { background: rgba(74, 158, 255, 0.15); color: var(--accent-blue); }
        .chapter-num.ch2 { background: rgba(0, 214, 143, 0.15); color: var(--accent-green); }
        .chapter-num.ch3 { background: rgba(255, 77, 106, 0.15); color: var(--accent-red); }
        .chapter-num.ch4 { background: rgba(255, 170, 0, 0.15); color: var(--accent-yellow); }
        .chapter-num.ch5 { background: rgba(168, 85, 247, 0.15); color: var(--accent-purple); }

        .chapter-title {
            font-size: 16px;
            font-weight: 600;
        }

        .chapter-content {
            padding-left: 48px;
            color: var(--text-secondary);
            font-size: 14px;
            line-height: 1.8;
        }

        .chapter-content ul {
            padding-left: 18px;
        }

        .chapter-content li {
            margin-bottom: 4px;
        }

        .chapter-content .key-concept {
            color: var(--accent-blue);
            font-weight: 500;
        }

        /* Code Blocks */
        .code-section {
            margin-bottom: 24px;
        }

        .code-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 10px 16px;
            background: #161822;
            border: 1px solid var(--border);
            border-bottom: none;
            border-radius: 8px 8px 0 0;
            font-size: 13px;
            color: var(--text-muted);
        }

        .code-file { color: var(--accent-blue); font-weight: 500; }

        pre {
            background: #0d0f17;
            border: 1px solid var(--border);
            border-radius: 0 0 8px 8px;
            padding: 16px;
            overflow-x: auto;
            font-size: 13px;
            line-height: 1.6;
            font-family: 'JetBrains Mono', 'Fira Code', 'Consolas', monospace;
        }

        code { font-family: inherit; }

        .kw { color: #c678dd; }
        .fn { color: #61afef; }
        .st { color: #98c379; }
        .cm { color: #5c6370; font-style: italic; }
        .nu { color: #d19a66; }
        .op { color: #56b6c2; }
        .cl { color: #e5c07b; }

        /* Chart Container */
        .chart-container {
            width: 100%;
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: 12px;
            overflow: hidden;
            margin-bottom: 20px;
        }

        .chart-toolbar {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 12px 16px;
            border-bottom: 1px solid var(--border);
        }

        .chart-toolbar h3 {
            font-size: 14px;
            font-weight: 600;
        }

        #kline-chart { width: 100%; height: 400px; }
        #equity-chart { width: 100%; height: 300px; }

        /* Trade Table */
        .trade-table-wrap {
            overflow-x: auto;
            max-height: 400px;
            overflow-y: auto;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            font-size: 13px;
        }

        th {
            text-align: left;
            padding: 10px 12px;
            background: var(--bg-secondary);
            color: var(--text-muted);
            font-weight: 600;
            font-size: 12px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            position: sticky;
            top: 0;
            z-index: 1;
        }

        td {
            padding: 8px 12px;
            border-bottom: 1px solid var(--border);
            color: var(--text-secondary);
        }

        tr:hover td {
            background: var(--bg-hover);
        }

        .pnl-pos { color: var(--accent-green); font-weight: 600; }
        .pnl-neg { color: var(--accent-red); font-weight: 600; }

        /* Principle cards */
        .principle-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-bottom: 24px;
        }

        .principle-card {
            border: 1px solid var(--border);
            border-radius: 12px;
            padding: 24px;
            position: relative;
            overflow: hidden;
        }

        .principle-card::before {
            content: '';
            position: absolute;
            top: 0; left: 0; right: 0;
            height: 3px;
        }

        .principle-card.sell::before { background: var(--accent-red); }
        .principle-card.buy::before { background: var(--accent-green); }

        .principle-card h3 {
            font-size: 16px;
            margin-bottom: 12px;
        }

        .principle-card p {
            color: var(--text-secondary);
            font-size: 14px;
            line-height: 1.7;
        }

        /* Loading */
        .loading {
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 60px;
            color: var(--text-muted);
        }

        .spinner {
            width: 24px;
            height: 24px;
            border: 3px solid var(--border);
            border-top-color: var(--accent-blue);
            border-radius: 50%;
            animation: spin 0.8s linear infinite;
            margin-right: 12px;
        }

        @keyframes spin { to { transform: rotate(360deg); } }

        /* Architecture */
        .arch-diagram {
            display: flex;
            flex-direction: column;
            gap: 12px;
            align-items: center;
            padding: 24px;
        }

        .arch-layer {
            display: flex;
            gap: 12px;
            flex-wrap: wrap;
            justify-content: center;
        }

        .arch-box {
            padding: 10px 18px;
            border-radius: 8px;
            font-size: 13px;
            font-weight: 500;
            text-align: center;
            border: 1px solid var(--border);
        }

        .arch-box.entry { background: rgba(74, 158, 255, 0.15); color: var(--accent-blue); }
        .arch-box.data { background: rgba(0, 214, 143, 0.15); color: var(--accent-green); }
        .arch-box.core { background: rgba(255, 77, 106, 0.15); color: var(--accent-red); }
        .arch-box.analysis { background: rgba(255, 170, 0, 0.15); color: var(--accent-yellow); }
        .arch-box.out { background: rgba(168, 85, 247, 0.15); color: var(--accent-purple); }

        .arch-arrow {
            color: var(--text-muted);
            font-size: 20px;
        }

        /* Responsive */
        /* Multi-interval bar chart */
        .bar-chart-container {
            display: flex;
            align-items: flex-end;
            justify-content: center;
            gap: 8px;
            height: 260px;
            padding: 20px 10px 0;
        }

        .bar-col {
            display: flex;
            flex-direction: column;
            align-items: center;
            flex: 1;
            max-width: 72px;
        }

        .bar-value {
            font-size: 11px;
            font-weight: 600;
            margin-bottom: 4px;
            white-space: nowrap;
        }

        .bar-rect {
            width: 100%;
            border-radius: 4px 4px 0 0;
            min-height: 2px;
            transition: all 0.3s ease;
            position: relative;
        }

        .bar-rect:hover {
            opacity: 0.8;
            transform: scaleX(1.1);
        }

        .bar-label {
            font-size: 11px;
            color: var(--text-muted);
            margin-top: 8px;
            text-align: center;
        }

        .bar-zero-line {
            width: 100%;
            height: 1px;
            background: var(--text-muted);
            position: relative;
        }

        /* Multi table highlight */
        #sc-table th, #sc-opt-table th {
            text-align: center;
            font-size: 11px;
            padding: 8px 10px;
            white-space: nowrap;
        }

        #sc-table td, #sc-opt-table td {
            text-align: center;
            font-size: 12px;
            padding: 8px 10px;
            white-space: nowrap;
        }

        #multi-table th {
            text-align: center;
            font-size: 11px;
            padding: 8px 6px;
            white-space: nowrap;
        }

        #multi-table td {
            text-align: center;
            font-size: 12px;
            padding: 7px 6px;
            white-space: nowrap;
        }

        #multi-table tr.best-row td {
            background: rgba(0, 214, 143, 0.05);
        }

        .cell-best {
            color: var(--accent-green) !important;
            font-weight: 700 !important;
        }

        .cell-worst {
            color: var(--accent-red) !important;
        }

        /* Conclusion */
        .conclusion-title {
            font-size: 16px;
            font-weight: 600;
            margin-bottom: 16px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .conclusion-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 16px;
        }

        .conclusion-item {
            padding: 16px;
            border-radius: 10px;
            border: 1px solid var(--border);
        }

        .conclusion-item h4 {
            font-size: 14px;
            margin-bottom: 8px;
        }

        .conclusion-item p {
            font-size: 13px;
            color: var(--text-secondary);
            line-height: 1.6;
        }

        .rank-badge {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            width: 22px;
            height: 22px;
            border-radius: 50%;
            font-size: 11px;
            font-weight: 700;
            margin-right: 4px;
        }

        .rank-1 { background: linear-gradient(135deg, #ffd700, #ffaa00); color: #000; }
        .rank-2 { background: linear-gradient(135deg, #c0c0c0, #a0a0a0); color: #000; }
        .rank-3 { background: linear-gradient(135deg, #cd7f32, #a0622a); color: #fff; }

        /* Legend for equity chart */
        .equity-legend {
            display: flex;
            flex-wrap: wrap;
            gap: 12px;
            padding: 12px 16px;
            border-bottom: 1px solid var(--border);
        }

        .legend-item {
            display: flex;
            align-items: center;
            gap: 6px;
            font-size: 12px;
            color: var(--text-secondary);
            cursor: pointer;
            padding: 3px 8px;
            border-radius: 4px;
            transition: background 0.15s;
        }

        .legend-item:hover { background: var(--bg-hover); }
        .legend-item.disabled { opacity: 0.3; }

        .legend-dot {
            width: 10px;
            height: 10px;
            border-radius: 50%;
        }

        @media (max-width: 900px) {
            .sidebar { width: 220px; min-width: 220px; }
            .page { padding: 24px 20px; }
            .principle-grid { grid-template-columns: 1fr; }
            .stats-grid { grid-template-columns: repeat(2, 1fr); }
            .conclusion-grid { grid-template-columns: 1fr; }
        }
    </style>
</head>
<body>
    <!-- Sidebar -->
    <nav class="sidebar">
        <div class="sidebar-header">
            <h1>æŠ€æœ¯åˆ†æå¹³å°</h1>
            <p>èƒŒç¦»åˆ†æ + å‡çº¿åˆ†æ Â· ETHå›æµ‹</p>
        </div>

        <div class="nav-section">
            <div class="nav-section-title">æ¦‚è§ˆ</div>
            <div class="nav-item active" data-page="overview">
                <span class="nav-icon">ğŸ“–</span> ä¹¦ç±å¤§çº²
            </div>
            <div class="nav-item" data-page="architecture">
                <span class="nav-icon">ğŸ—ï¸</span> é¡¹ç›®æ¶æ„
            </div>
        </div>

        <div class="nav-section">
            <div class="nav-section-title">ä»£ç å®ç°</div>
            <div class="nav-item" data-page="code-indicators">
                <span class="nav-icon">ğŸ“Š</span> æŠ€æœ¯æŒ‡æ ‡è®¡ç®—
            </div>
            <div class="nav-item" data-page="code-pattern">
                <span class="nav-icon">ğŸ“</span> å‡ ä½•å½¢æ€èƒŒç¦»
            </div>
            <div class="nav-item" data-page="code-macd">
                <span class="nav-icon">ğŸ“ˆ</span> MACDèƒŒç¦»
            </div>
            <div class="nav-item" data-page="code-exhaustion">
                <span class="nav-icon">âš¡</span> èƒŒç¦»ä¸èƒŒé©°
            </div>
            <div class="nav-item" data-page="code-other">
                <span class="nav-icon">ğŸ”¬</span> å…¶ä»–æŒ‡æ ‡èƒŒç¦»
            </div>
        </div>

        <div class="nav-section">
            <div class="nav-section-title">ETH/USDT å›æµ‹</div>
            <div class="nav-item" data-page="global-strategy">
                <span class="nav-icon">ğŸ†</span> å…¨å±€æœ€ä¼˜ç­–ç•¥
            </div>
            <div class="nav-item" data-page="strategy-compare">
                <span class="nav-icon">ğŸ”¬</span> ç­–ç•¥ä¼˜åŒ–å¯¹æ¯”
            </div>
            <div class="nav-item" data-page="strategy-futures">
                <span class="nav-icon">ğŸ“Š</span> åˆçº¦åšç©ºç­–ç•¥
            </div>
            <div class="nav-item" data-page="ma-strategy">
                <span class="nav-icon">ğŸ“ˆ</span> å‡çº¿æŠ€æœ¯åˆ†æ
            </div>
            <div class="nav-item" data-page="combined-strategy">
                <span class="nav-icon">ğŸ”—</span> åŒä¹¦èåˆç­–ç•¥
            </div>
            <div class="nav-item" data-page="multi-compare">
                <span class="nav-icon">ğŸ“Š</span> å¤šå‘¨æœŸå¯¹æ¯”
            </div>
            <div class="nav-item" data-page="backtest-summary">
                <span class="nav-icon">ğŸ’°</span> å•å‘¨æœŸè¯¦æƒ…
            </div>
            <div class="nav-item" data-page="backtest-chart">
                <span class="nav-icon">ğŸ“‰</span> Kçº¿ä¸ä¿¡å·
            </div>
            <div class="nav-item" data-page="backtest-trades">
                <span class="nav-icon">ğŸ“‹</span> äº¤æ˜“æ˜ç»†
            </div>
        </div>
    </nav>

    <!-- Main Content -->
    <div class="main-content">

        <!-- ====== ä¹¦ç±å¤§çº² ====== -->
        <div class="page active" id="overview">
            <div class="page-title">ã€ŠèƒŒç¦»æŠ€æœ¯åˆ†æã€‹ä¹¦ç±å¤§çº²</div>
            <div class="page-subtitle">æ±Ÿå—å°éš è‘— Â· ç†è´¢å­¦é™¢ç³»åˆ— Â· å…¨é¢è§£æèƒŒç¦»ä¸èƒŒé©°äº¤æ˜“ä½“ç³»</div>

            <div class="chapter">
                <div class="chapter-header">
                    <div class="chapter-num ch1">ä¸€</div>
                    <div class="chapter-title">ç¬¬ä¸€ç«  Â· èƒŒç¦»æ€»è¿°</div>
                </div>
                <div class="chapter-content">
                    <p>èƒŒç¦»çš„æ ¸å¿ƒå®šä¹‰: <span class="key-concept">å°†å‰åä¸¤æ®µèµ°åŠ¿çš„ç‰¹å¾è¿›è¡Œæ¯”è¾ƒ, å‘ç°è¶‹åŠ¿è¡°ç«­ä¿¡å·</span></p>
                    <ul>
                        <li>èƒŒç¦»æ˜¯è¶‹åŠ¿è¡°ç«­çš„ä¿¡å·, ä½†ä¸ä¸€å®šé©¬ä¸Šåè½¬</li>
                        <li>å¯ä»¥"èƒŒç¦»äº†åˆèƒŒç¦»", ç›´åˆ°äº§ç”Ÿ<span class="key-concept">èƒŒé©°</span>æ‰æ˜¯æœ€ç»ˆåè½¬</li>
                        <li>èƒŒç¦»åˆ†ææ˜¯ç¡®è®¤æ€§åˆ†æ, è€Œéé¢„æµ‹æ€§åˆ†æ</li>
                    </ul>
                </div>
            </div>

            <div class="chapter">
                <div class="chapter-header">
                    <div class="chapter-num ch2">äºŒ</div>
                    <div class="chapter-title">ç¬¬äºŒç«  Â· å‡ ä½•å½¢æ€èƒŒç¦»</div>
                </div>
                <div class="chapter-content">
                    <ul>
                        <li><span class="key-concept">è¶‹åŠ¿Kçº¿èƒŒç¦»</span> â€” ä¸Šæ¶¨ä¸­å‡ºç°å¤§é˜´çº¿/ä¸‹è·Œä¸­å‡ºç°å¤§é˜³çº¿, é¢„ç¤ºè¶‹åŠ¿å¯èƒ½åè½¬</li>
                        <li><span class="key-concept">è¶‹åŠ¿å¹…åº¦èƒŒç¦»</span> â€” åä¸€æ®µè¶‹åŠ¿çš„å‚ç›´å¹…åº¦å°äºå‰ä¸€æ®µ, è¯´æ˜æ¨åŠ¨åŠ›å‡å¼±</li>
                        <li><span class="key-concept">æ—¶é—´åº¦èƒŒç¦»</span> â€” åä¸€æ®µè¶‹åŠ¿æŒç»­Kçº¿æ•°å°‘äºå‰ä¸€æ®µ, æ—¶é—´ä¸Šçš„è¡°ç«­</li>
                        <li><span class="key-concept">å‡çº¿èƒŒç¦»</span> â€” ä»·æ ¼å‰§çƒˆç©¿è¶Šé•¿æœŸå‡çº¿(å‡çº¿æ–¹å‘ä¸ä»·æ ¼è¿åŠ¨æ–¹å‘ç›¸å)</li>
                        <li><span class="key-concept">å‡çº¿ç›¸äº¤é¢ç§¯èƒŒç¦»</span> â€” çŸ­æœŸä¸é•¿æœŸå‡çº¿ä¹‹é—´çš„é¢ç§¯ç¼©å°</li>
                    </ul>
                </div>
            </div>

            <div class="chapter">
                <div class="chapter-header">
                    <div class="chapter-num ch3">ä¸‰</div>
                    <div class="chapter-title">ç¬¬ä¸‰ç«  Â· MACDæŠ€æœ¯æŒ‡æ ‡èƒŒç¦» (æ ¸å¿ƒç« èŠ‚)</div>
                </div>
                <div class="chapter-content">
                    <ul>
                        <li><span class="key-concept">é»„ç™½çº¿(DIF/DEA)èƒŒç¦»</span> â€” ä»·æ ¼åˆ›æ–°é«˜/ä½, DIF/DEAçº¿æœªåŒæ­¥åˆ›æ–°é«˜/ä½</li>
                        <li><span class="key-concept">å½©æŸ±çº¿é•¿åº¦èƒŒç¦»</span> â€” çº¢/ç»¿æŸ±æœ€å¤§é•¿åº¦ç¼©çŸ­
                            <ul>
                                <li><strong>å½“å †èƒŒç¦»</strong>: åŒä¸€å †æŸ±ä½“å†…åé¢çš„æŸ±å­æ¯”å‰é¢çŸ­</li>
                                <li><strong>é‚»å †èƒŒç¦»</strong>: ç›¸é‚»ä¸¤å †æŸ±ä½“ä¸­åå †æœ€å¤§æŸ±å­æ¯”å‰å †çŸ­</li>
                                <li><strong>éš”å †èƒŒç¦»</strong>: éš”å¼€çš„ä¸¤å †æŸ±ä½“ä¸­åå †ä¸å¦‚å‰å †(æœ€é‡è¦!)</li>
                            </ul>
                        </li>
                        <li><span class="key-concept">å½©æŸ±çº¿é¢ç§¯èƒŒç¦»</span> â€” æŸ±ä½“å †é¢ç§¯ç¼©å° (é‚»å †/éš”å †)</li>
                        <li><span class="key-concept">é»„ç™½çº¿ç›¸äº¤é¢ç§¯èƒŒç¦»</span> â€” DIFä¸DEAå›´åˆçš„é¢ç§¯ç¼©å°</li>
                        <li><span class="key-concept">é‡‘å‰/æ­»å‰</span> â€” DIFä¸Šç©¿/ä¸‹ç©¿DEAçš„äº¤å‰ä¿¡å·</li>
                    </ul>
                </div>
            </div>

            <div class="chapter">
                <div class="chapter-header">
                    <div class="chapter-num ch4">å››</div>
                    <div class="chapter-title">ç¬¬å››ç«  Â· èƒŒç¦»ä¸èƒŒé©° (æ ¸å¿ƒç­–ç•¥)</div>
                </div>
                <div class="chapter-content">
                    <div class="principle-grid" style="padding-left:0; margin-top:12px;">
                        <div class="principle-card sell">
                            <h3>å–ç‚¹ç”¨èƒŒç¦» (å®æ—©å‹¿æ™š)</h3>
                            <p>
                                æ»¡è¶³ä»»ä¸€æ¡ä»¶å³è€ƒè™‘å–å‡º:<br>
                                â‘  MACD DIFè¿œç¦»é›¶è½´åè¿”å›, é‡æ–°ä¸Šå‡ä¸åˆ›æ–°é«˜ + å·²æœ‰ä¸€æ¬¡éš”å †èƒŒç¦»<br>
                                â‘¡ è™½æœªè¿”å›é›¶è½´, ä½†å·²æœ‰ä¸¤æ¬¡ä»¥ä¸Šéš”å †èƒŒç¦»
                            </p>
                        </div>
                        <div class="principle-card buy">
                            <h3>ä¹°ç‚¹ç”¨èƒŒé©° (å®è¿Ÿå‹¿æ—©)</h3>
                            <p>
                                éœ€<strong>åŒæ—¶æ»¡è¶³ä¸¤ä¸ªæ¡ä»¶</strong>æ‰è€ƒè™‘ä¹°å…¥:<br>
                                â‘  äº§ç”Ÿäº†ä¸¤æ¬¡ä»¥ä¸Šéš”å †èƒŒç¦»<br>
                                â‘¡ MACD DIFçº¿ä¸¤æ¬¡è¿”å›é›¶è½´åå†åº¦åº•èƒŒç¦»
                            </p>
                        </div>
                    </div>
                    <ul>
                        <li><span class="key-concept">èƒŒé©°</span> = è¶‹åŠ¿çš„æœ€åä¸€æ¬¡èƒŒç¦», ä¸€æ—¦äº§ç”Ÿé©¬ä¸Šåè½¬</li>
                        <li>èƒŒç¦»å¯ä»¥åå¤, ä½†èƒŒé©°åªå‡ºç°ä¸€æ¬¡</li>
                        <li>èƒŒé©°æ˜¯èƒŒç¦»é‡ç§¯ç´¯åˆ°è´¨å˜çš„é£è·ƒ</li>
                    </ul>
                </div>
            </div>

            <div class="chapter">
                <div class="chapter-header">
                    <div class="chapter-num ch5">äº”</div>
                    <div class="chapter-title">ç¬¬äº”ç«  Â· å…¶ä»–èƒŒç¦»æ–¹æ³•</div>
                </div>
                <div class="chapter-content">
                    <ul>
                        <li><span class="key-concept">KDJæŒ‡æ ‡èƒŒç¦»</span> â€” ä»·æ ¼æ–°é«˜/ä½è€ŒKDJçš„K/Dçº¿æœªåŒæ­¥, å°¤å…¶åœ¨è¶…ä¹°(>80)/è¶…å–(<20)åŒºåŸŸ</li>
                        <li><span class="key-concept">CCIæŒ‡æ ‡èƒŒç¦»</span> â€” ä»·æ ¼æ–°é«˜/ä½è€ŒCCIæœªåŒæ­¥, CCIè¶Šè¿‡+100(å¤©çº¿)æˆ–è·Œç ´-100(åœ°çº¿)ä¸ºå¼ºä¿¡å·</li>
                        <li><span class="key-concept">RSIæŒ‡æ ‡èƒŒç¦»</span> â€” ä»·æ ¼æ–°é«˜/ä½è€ŒRSIæœªåŒæ­¥, å…³æ³¨RSIåœ¨80ä»¥ä¸Š(è¶…ä¹°)æˆ–20ä»¥ä¸‹(è¶…å–)çš„åŒºåŸŸ</li>
                        <li><span class="key-concept">é‡ä»·èƒŒç¦»</span> â€” ä»·å‡é‡å‡(ä¸Šæ¶¨ä¹åŠ›)ã€ä»·è·Œé‡å¢(ææ…ŒæŠ›å”®)ã€åœ°é‡åœ°ä»·(æ½œåœ¨åº•éƒ¨)</li>
                    </ul>
                </div>
            </div>
        </div>

        <!-- ====== é¡¹ç›®æ¶æ„ ====== -->
        <div class="page" id="architecture">
            <div class="page-title">é¡¹ç›®æ¶æ„</div>
            <div class="page-subtitle">åŸºäº Python å®ç°çš„å®Œæ•´èƒŒç¦»åˆ†æç³»ç»Ÿ</div>

            <div class="card">
                <div class="card-title">ç³»ç»Ÿæ¶æ„å›¾</div>
                <div class="arch-diagram">
                    <div class="arch-layer">
                        <div class="arch-box entry">main.py<br><small>å‘½ä»¤è¡Œå…¥å£</small></div>
                        <div class="arch-box entry">app.py<br><small>Web å±•ç¤º</small></div>
                        <div class="arch-box entry">backtest.py<br><small>å›æµ‹å¼•æ“</small></div>
                    </div>
                    <div class="arch-arrow">â†“</div>
                    <div class="arch-layer">
                        <div class="arch-box analysis">ComprehensiveAnalyzer<br><small>ç»¼åˆåˆ†æå™¨</small></div>
                    </div>
                    <div class="arch-arrow">â†“</div>
                    <div class="arch-layer">
                        <div class="arch-box core">PatternDiv<br><small>å½¢æ€èƒŒç¦»</small></div>
                        <div class="arch-box core">MACDDiv<br><small>MACDèƒŒç¦»</small></div>
                        <div class="arch-box core">Exhaustion<br><small>èƒŒé©°åˆ†æ</small></div>
                        <div class="arch-box core">KDJ/CCI/RSI<br><small>æŒ‡æ ‡èƒŒç¦»</small></div>
                        <div class="arch-box core">VolPrice<br><small>é‡ä»·èƒŒç¦»</small></div>
                    </div>
                    <div class="arch-arrow">â†“</div>
                    <div class="arch-layer">
                        <div class="arch-box data">indicators.py<br><small>æŠ€æœ¯æŒ‡æ ‡è®¡ç®—</small></div>
                        <div class="arch-box data">config.py<br><small>å‚æ•°é…ç½®</small></div>
                    </div>
                    <div class="arch-arrow">â†“</div>
                    <div class="arch-layer">
                        <div class="arch-box out">binance_fetcher.py<br><small>å¸å®‰æ•°æ®è·å–</small></div>
                        <div class="arch-box out">data_fetcher.py<br><small>Aè‚¡/CSVæ•°æ®</small></div>
                        <div class="arch-box out">visualization.py<br><small>å›¾è¡¨å¯è§†åŒ–</small></div>
                    </div>
                </div>
            </div>

            <div class="card">
                <div class="card-title">æ–‡ä»¶ç»“æ„</div>
                <pre><code><span class="st">macd-analysis-claude/</span>
â”œâ”€â”€ <span class="fn">config.py</span>             <span class="cm"># å…¨å±€å‚æ•°é…ç½® (MACD/KDJ/CCI/RSIå‚æ•°, èƒŒç¦»é˜ˆå€¼)</span>
â”œâ”€â”€ <span class="fn">indicators.py</span>         <span class="cm"># æŠ€æœ¯æŒ‡æ ‡: SMA, EMA, MACD, KDJ, CCI, RSI</span>
â”œâ”€â”€ <span class="fn">binance_fetcher.py</span>    <span class="cm"># å¸å®‰APIæ•°æ®è·å– (10åˆ†é’ŸKçº¿)</span>
â”œâ”€â”€ <span class="fn">data_fetcher.py</span>       <span class="cm"># Aè‚¡/CSV/æ¨¡æ‹Ÿæ•°æ®è·å–</span>
â”œâ”€â”€ <span class="fn">backtest.py</span>           <span class="cm"># å›æµ‹å¼•æ“ (æ­¢æŸæ­¢ç›ˆ/å†·å´æœŸ/ä¿¡å·è¿‡æ»¤)</span>
â”œâ”€â”€ <span class="fn">visualization.py</span>      <span class="cm"># Matplotlib å¤šé¢æ¿å›¾è¡¨</span>
â”œâ”€â”€ <span class="fn">main.py</span>               <span class="cm"># å‘½ä»¤è¡Œä¸»ç¨‹åº</span>
â”œâ”€â”€ <span class="fn">app.py</span>                <span class="cm"># Flask Web åº”ç”¨</span>
â”œâ”€â”€ <span class="st">divergence/</span>           <span class="cm"># èƒŒç¦»æ£€æµ‹æ¨¡å—åŒ…</span>
â”‚   â”œâ”€â”€ __init__.py
â”‚   â”œâ”€â”€ <span class="fn">pattern_divergence.py</span>    <span class="cm"># ç¬¬äºŒç« : å‡ ä½•å½¢æ€èƒŒç¦»</span>
â”‚   â”œâ”€â”€ <span class="fn">macd_divergence.py</span>       <span class="cm"># ç¬¬ä¸‰ç« : MACDèƒŒç¦»</span>
â”‚   â”œâ”€â”€ <span class="fn">exhaustion.py</span>            <span class="cm"># ç¬¬å››ç« : èƒŒç¦»ä¸èƒŒé©°</span>
â”‚   â”œâ”€â”€ <span class="fn">kdj_divergence.py</span>        <span class="cm"># ç¬¬äº”ç« : KDJèƒŒç¦»</span>
â”‚   â”œâ”€â”€ <span class="fn">cci_divergence.py</span>        <span class="cm"># ç¬¬äº”ç« : CCIèƒŒç¦»</span>
â”‚   â”œâ”€â”€ <span class="fn">rsi_divergence.py</span>        <span class="cm"># ç¬¬äº”ç« : RSIèƒŒç¦»</span>
â”‚   â”œâ”€â”€ <span class="fn">volume_price_divergence.py</span>  <span class="cm"># ç¬¬äº”ç« : é‡ä»·èƒŒç¦»</span>
â”‚   â””â”€â”€ <span class="fn">comprehensive.py</span>         <span class="cm"># ç»¼åˆåˆ†æ & è¯„åˆ†</span>
â””â”€â”€ <span class="st">templates/</span>
    â””â”€â”€ index.html        <span class="cm"># Web å±•ç¤ºé¡µé¢</span></code></pre>
            </div>
        </div>

        <!-- ====== ä»£ç : æŠ€æœ¯æŒ‡æ ‡ ====== -->
        <div class="page" id="code-indicators">
            <div class="page-title">æŠ€æœ¯æŒ‡æ ‡è®¡ç®—</div>
            <div class="page-subtitle">indicators.py Â· æ‰€æœ‰åˆ†æçš„åŸºç¡€</div>

            <div class="code-section">
                <div class="code-header">
                    <span class="code-file">indicators.py</span>
                    <span>MACD è®¡ç®—</span>
                </div>
                <pre><code><span class="kw">def</span> <span class="fn">calc_macd</span>(close: pd.Series, fast=<span class="nu">12</span>, slow=<span class="nu">26</span>, signal=<span class="nu">9</span>) -> pd.DataFrame:
    <span class="st">"""è®¡ç®—MACDæŒ‡æ ‡: DIF, DEA, MACD_BAR"""</span>
    ema_fast = close.ewm(span=fast, adjust=<span class="kw">False</span>).mean()
    ema_slow = close.ewm(span=slow, adjust=<span class="kw">False</span>).mean()
    dif = ema_fast - ema_slow                    <span class="cm"># å¿«çº¿-æ…¢çº¿ = DIF(ç™½çº¿)</span>
    dea = dif.ewm(span=signal, adjust=<span class="kw">False</span>).mean()  <span class="cm"># DIFçš„EMA = DEA(é»„çº¿)</span>
    bar = <span class="nu">2</span> * (dif - dea)                       <span class="cm"># çº¢ç»¿æŸ± = 2*(DIF-DEA)</span>
    <span class="kw">return</span> pd.DataFrame({<span class="st">'DIF'</span>: dif, <span class="st">'DEA'</span>: dea, <span class="st">'MACD_BAR'</span>: bar})</code></pre>
            </div>

            <div class="code-section">
                <div class="code-header">
                    <span class="code-file">indicators.py</span>
                    <span>KDJ / CCI / RSI</span>
                </div>
                <pre><code><span class="kw">def</span> <span class="fn">calc_kdj</span>(high, low, close, n=<span class="nu">9</span>, m1=<span class="nu">3</span>, m2=<span class="nu">3</span>):
    <span class="st">"""KDJéšæœºæŒ‡æ ‡: RSV -> K -> D -> J"""</span>
    lowest = low.rolling(n).min()
    highest = high.rolling(n).max()
    rsv = (close - lowest) / (highest - lowest) * <span class="nu">100</span>
    k = rsv.ewm(com=m1-<span class="nu">1</span>, adjust=<span class="kw">False</span>).mean()
    d = k.ewm(com=m2-<span class="nu">1</span>, adjust=<span class="kw">False</span>).mean()
    j = <span class="nu">3</span> * k - <span class="nu">2</span> * d
    <span class="kw">return</span> pd.DataFrame({<span class="st">'K'</span>: k, <span class="st">'D'</span>: d, <span class="st">'J'</span>: j})

<span class="kw">def</span> <span class="fn">calc_cci</span>(high, low, close, n=<span class="nu">14</span>):
    <span class="st">"""CCIé¡ºåŠ¿æŒ‡æ ‡: TPçš„åç¦»åº¦/å¹³å‡åå·®"""</span>
    tp = (high + low + close) / <span class="nu">3</span>
    ma = tp.rolling(n).mean()
    md = tp.rolling(n).apply(<span class="kw">lambda</span> x: np.abs(x - x.mean()).mean())
    <span class="kw">return</span> (tp - ma) / (<span class="nu">0.015</span> * md)

<span class="kw">def</span> <span class="fn">calc_rsi</span>(close, period=<span class="nu">6</span>):
    <span class="st">"""RSIç›¸å¯¹å¼ºå¼±æŒ‡æ ‡: æ¶¨å¹…å‡å€¼/(æ¶¨å¹…å‡å€¼+è·Œå¹…å‡å€¼)*100"""</span>
    delta = close.diff()
    gain = delta.clip(lower=<span class="nu">0</span>).ewm(alpha=<span class="nu">1</span>/period, adjust=<span class="kw">False</span>).mean()
    loss = (-delta.clip(upper=<span class="nu">0</span>)).ewm(alpha=<span class="nu">1</span>/period, adjust=<span class="kw">False</span>).mean()
    <span class="kw">return</span> <span class="nu">100</span> - <span class="nu">100</span> / (<span class="nu">1</span> + gain / loss)</code></pre>
            </div>

            <div class="code-section">
                <div class="code-header">
                    <span class="code-file">indicators.py</span>
                    <span>è¾…åŠ©å‡½æ•°: æ³¢å³°æ³¢è°· / è¶‹åŠ¿åˆ†æ®µ / MACDæŸ±å †è¯†åˆ«</span>
                </div>
                <pre><code><span class="kw">def</span> <span class="fn">find_swing_highs</span>(series, order=<span class="nu">5</span>):
    <span class="st">"""å¯»æ‰¾å±€éƒ¨é«˜ç‚¹(æ³¢å³°), order=å‰åå„5æ ¹Kçº¿èŒƒå›´"""</span>
    highs = []
    <span class="kw">for</span> i <span class="kw">in</span> range(order, len(series) - order):
        <span class="kw">if</span> all(series.iloc[i] >= series.iloc[i-j] <span class="kw">for</span> j <span class="kw">in</span> range(<span class="nu">1</span>, order+<span class="nu">1</span>)) \
           <span class="kw">and</span> all(series.iloc[i] >= series.iloc[i+j] <span class="kw">for</span> j <span class="kw">in</span> range(<span class="nu">1</span>, order+<span class="nu">1</span>)):
            highs.append(i)
    <span class="kw">return</span> highs

<span class="kw">def</span> <span class="fn">identify_bar_groups</span>(bar: pd.Series):
    <span class="st">"""è¯†åˆ«MACDæŸ±å †: è¿ç»­çº¢æŸ±(>0)æˆ–ç»¿æŸ±(<0)ä¸ºä¸€å †"""</span>
    groups = []
    current_sign = <span class="kw">None</span>
    start_idx = <span class="nu">0</span>
    <span class="kw">for</span> i, v <span class="kw">in</span> enumerate(bar):
        sign = <span class="st">'red'</span> <span class="kw">if</span> v >= <span class="nu">0</span> <span class="kw">else</span> <span class="st">'green'</span>
        <span class="kw">if</span> sign != current_sign:
            <span class="kw">if</span> current_sign <span class="kw">is not None</span>:
                groups.append({<span class="st">'type'</span>: current_sign, <span class="st">'start'</span>: start_idx, <span class="st">'end'</span>: i-<span class="nu">1</span>})
            current_sign = sign
            start_idx = i
    groups.append({<span class="st">'type'</span>: current_sign, <span class="st">'start'</span>: start_idx, <span class="st">'end'</span>: len(bar)-<span class="nu">1</span>})
    <span class="kw">return</span> groups</code></pre>
            </div>
        </div>

        <!-- ====== ä»£ç : å‡ ä½•å½¢æ€èƒŒç¦» ====== -->
        <div class="page" id="code-pattern">
            <div class="page-title">ç¬¬äºŒç«  Â· å‡ ä½•å½¢æ€èƒŒç¦»</div>
            <div class="page-subtitle">pattern_divergence.py Â· 5ç§å½¢æ€èƒŒç¦»æ£€æµ‹</div>

            <div class="code-section">
                <div class="code-header">
                    <span class="code-file">divergence/pattern_divergence.py</span>
                    <span>è¶‹åŠ¿Kçº¿èƒŒç¦»</span>
                </div>
                <pre><code><span class="kw">def</span> <span class="fn">detect_kline_divergence</span>(<span class="kw">self</span>, lookback=<span class="nu">20</span>, body_ratio=<span class="nu">0.02</span>):
    <span class="st">"""æ£€æµ‹è¶‹åŠ¿ä¸­å‡ºç°çš„åå‘å¤§Kçº¿
    ä¸Šæ¶¨è¶‹åŠ¿ä¸­çš„å¤§é˜´çº¿(å®ä½“>=2%), æˆ–ä¸‹è·Œè¶‹åŠ¿ä¸­çš„å¤§é˜³çº¿"""</span>
    signals = []
    <span class="kw">for</span> i <span class="kw">in</span> range(lookback, len(df)):
        body = abs(df[<span class="st">'close'</span>].iloc[i] - df[<span class="st">'open'</span>].iloc[i])
        body_pct = body / df[<span class="st">'open'</span>].iloc[i]
        <span class="kw">if</span> body_pct < body_ratio:
            <span class="kw">continue</span>
        <span class="cm"># åˆ¤æ–­è¿‘æœŸè¶‹åŠ¿æ–¹å‘ (ç”¨MAæ–œç‡)</span>
        trend = df[<span class="st">'close'</span>].iloc[i-lookback:i].mean() - df[<span class="st">'close'</span>].iloc[i-lookback]
        is_bearish = df[<span class="st">'close'</span>].iloc[i] < df[<span class="st">'open'</span>].iloc[i]
        <span class="kw">if</span> trend > <span class="nu">0</span> <span class="kw">and</span> is_bearish:   <span class="cm"># ä¸Šæ¶¨ä¸­å¤§é˜´çº¿</span>
            signals.append({<span class="st">'type'</span>: <span class="st">'top'</span>, <span class="st">'idx'</span>: i, <span class="st">'severity'</span>: body_pct})
        <span class="kw">elif</span> trend < <span class="nu">0</span> <span class="kw">and not</span> is_bearish:  <span class="cm"># ä¸‹è·Œä¸­å¤§é˜³çº¿</span>
            signals.append({<span class="st">'type'</span>: <span class="st">'bottom'</span>, <span class="st">'idx'</span>: i})
    <span class="kw">return</span> signals</code></pre>
            </div>

            <div class="code-section">
                <div class="code-header">
                    <span class="code-file">divergence/pattern_divergence.py</span>
                    <span>è¶‹åŠ¿å¹…åº¦ & æ—¶é—´åº¦èƒŒç¦»</span>
                </div>
                <pre><code><span class="kw">def</span> <span class="fn">detect_amplitude_divergence</span>(<span class="kw">self</span>, order=<span class="nu">5</span>, shrink_ratio=<span class="nu">0.7</span>):
    <span class="st">"""æ£€æµ‹è¶‹åŠ¿å¹…åº¦è¡°å‡: åä¸€æ®µæ¶¨/è·Œå¹… < å‰ä¸€æ®µ Ã— shrink_ratio"""</span>
    up_segs, down_segs = identify_trend_segments(df, order)
    signals = []
    <span class="kw">for</span> i <span class="kw">in</span> range(<span class="nu">1</span>, len(up_segs)):
        prev_amp = up_segs[i-<span class="nu">1</span>][<span class="st">'amplitude'</span>]
        curr_amp = up_segs[i][<span class="st">'amplitude'</span>]
        <span class="kw">if</span> curr_amp < prev_amp * shrink_ratio:
            signals.append({<span class="st">'type'</span>: <span class="st">'top'</span>, <span class="st">'ratio'</span>: curr_amp/prev_amp})
    <span class="kw">return</span> signals

<span class="kw">def</span> <span class="fn">detect_time_divergence</span>(<span class="kw">self</span>, order=<span class="nu">5</span>, shrink_ratio=<span class="nu">0.7</span>):
    <span class="st">"""æ£€æµ‹æ—¶é—´åº¦è¡°å‡: åä¸€æ®µæŒç»­Kçº¿æ•° < å‰ä¸€æ®µ Ã— shrink_ratio"""</span>
    <span class="cm"># é€»è¾‘ç±»ä¼¼å¹…åº¦èƒŒç¦», æ¯”è¾ƒ segment['duration'] å³Kçº¿æ•°</span></code></pre>
            </div>

            <div class="code-section">
                <div class="code-header">
                    <span class="code-file">divergence/pattern_divergence.py</span>
                    <span>å‡çº¿ç›¸äº¤é¢ç§¯èƒŒç¦»</span>
                </div>
                <pre><code><span class="kw">def</span> <span class="fn">detect_ma_area_divergence</span>(<span class="kw">self</span>, short_period=<span class="nu">5</span>, long_period=<span class="nu">30</span>):
    <span class="st">"""çŸ­æœŸå‡çº¿ä¸é•¿æœŸå‡çº¿ä¹‹é—´çš„é¢ç§¯é€æ¸ç¼©å° -> è¶‹åŠ¿å‡å¼±"""</span>
    ma_short = df[<span class="st">'close'</span>].rolling(short_period).mean()
    ma_long  = df[<span class="st">'close'</span>].rolling(long_period).mean()
    diff = ma_short - ma_long           <span class="cm"># MAå·®å€¼åºåˆ—</span>
    <span class="cm"># å°†è¿ç»­æ­£å€¼/è´Ÿå€¼åŒºé—´è¯†åˆ«ä¸ºä¸€ä¸ª"é¢ç§¯æ®µ"</span>
    <span class="cm"># æ¯”è¾ƒç›¸é‚»åŒå‘é¢ç§¯æ®µ: åæ®µé¢ç§¯ < å‰æ®µé¢ç§¯ Ã— shrink_ratio</span></code></pre>
            </div>
        </div>

        <!-- ====== ä»£ç : MACDèƒŒç¦» ====== -->
        <div class="page" id="code-macd">
            <div class="page-title">ç¬¬ä¸‰ç«  Â· MACD æŠ€æœ¯æŒ‡æ ‡èƒŒç¦»</div>
            <div class="page-subtitle">macd_divergence.py Â· ä¹¦ä¸­æœ€æ ¸å¿ƒçš„èƒŒç¦»æ£€æµ‹</div>

            <div class="code-section">
                <div class="code-header">
                    <span class="code-file">divergence/macd_divergence.py</span>
                    <span>é»„ç™½çº¿(DIF/DEA)èƒŒç¦»</span>
                </div>
                <pre><code><span class="kw">def</span> <span class="fn">detect_dif_dea_divergence</span>(<span class="kw">self</span>, order=<span class="nu">5</span>):
    <span class="st">"""ä»·æ ¼åˆ›æ–°é«˜ä½†DIF/DEAæœªåˆ›æ–°é«˜ = é¡¶èƒŒç¦»
    ä»·æ ¼åˆ›æ–°ä½ä½†DIF/DEAæœªåˆ›æ–°ä½ = åº•èƒŒç¦»"""</span>
    price_highs = find_swing_highs(df[<span class="st">'high'</span>], order)
    dif_at_highs = [df[<span class="st">'DIF'</span>].iloc[h] <span class="kw">for</span> h <span class="kw">in</span> price_highs]

    <span class="kw">for</span> i <span class="kw">in</span> range(<span class="nu">1</span>, len(price_highs)):
        <span class="cm"># ä»·æ ¼æ–°é«˜ä½†DIFæœªæ–°é«˜ -> é¡¶èƒŒç¦»</span>
        <span class="kw">if</span> df[<span class="st">'high'</span>].iloc[price_highs[i]] > df[<span class="st">'high'</span>].iloc[price_highs[i-<span class="nu">1</span>]] \
           <span class="kw">and</span> dif_at_highs[i] < dif_at_highs[i-<span class="nu">1</span>] * <span class="nu">0.9</span>:
            signals.append({<span class="st">'type'</span>: <span class="st">'top'</span>, <span class="st">'subtype'</span>: <span class="st">'dif_dea'</span>, ...})</code></pre>
            </div>

            <div class="code-section">
                <div class="code-header">
                    <span class="code-file">divergence/macd_divergence.py</span>
                    <span>å½©æŸ±çº¿é•¿åº¦èƒŒç¦» (å½“å †/é‚»å †/éš”å †)</span>
                </div>
                <pre><code><span class="kw">def</span> <span class="fn">detect_bar_length_divergence</span>(<span class="kw">self</span>, order=<span class="nu">5</span>):
    <span class="st">"""MACDæŸ±çº¿é•¿åº¦èƒŒç¦» â€” ä¸‰ç§å­ç±»å‹"""</span>
    groups = identify_bar_groups(df[<span class="st">'MACD_BAR'</span>])

    <span class="cm"># 1. å½“å †èƒŒç¦»: åŒä¸€å †å†…åé¢æŸ±å­çš„æœ€å¤§å€¼å¼€å§‹ç¼©å°</span>
    <span class="kw">for</span> g <span class="kw">in</span> groups:
        bars = df[<span class="st">'MACD_BAR'</span>].iloc[g[<span class="st">'start'</span>]:g[<span class="st">'end'</span>]+<span class="nu">1</span>]
        peak_idx = bars.abs().idxmax()
        <span class="cm"># å¦‚æœå³°å€¼å‡ºç°åœ¨å †çš„å‰åŠéƒ¨åˆ†, ååŠéƒ¨åˆ†æŒç»­ç¼©å° -> å½“å †èƒŒç¦»</span>

    <span class="cm"># 2. é‚»å †èƒŒç¦»: ç›¸é‚»ä¸¤ä¸ªåŒè‰²å †çš„æœ€å¤§æŸ±å­å¯¹æ¯”</span>
    red_groups = [g <span class="kw">for</span> g <span class="kw">in</span> groups <span class="kw">if</span> g[<span class="st">'type'</span>] == <span class="st">'red'</span>]
    <span class="kw">for</span> i <span class="kw">in</span> range(<span class="nu">1</span>, len(red_groups)):
        <span class="kw">if</span> max_bar(red_groups[i]) < max_bar(red_groups[i-<span class="nu">1</span>]) * <span class="nu">0.7</span>:
            <span class="cm"># é‚»å †èƒŒç¦» (å¦‚æœä¸¤å †ç›¸é‚») æˆ– éš”å †èƒŒç¦» (å¦‚æœä¸­é—´éš”äº†å…¶ä»–å †)</span>

    <span class="cm"># 3. éš”å †èƒŒç¦» (æœ€é‡è¦! åˆ¤æ–­èƒŒé©°çš„æ ¸å¿ƒä¾æ®)</span></code></pre>
            </div>

            <div class="code-section">
                <div class="code-header">
                    <span class="code-file">divergence/macd_divergence.py</span>
                    <span>å½©æŸ±çº¿é¢ç§¯èƒŒç¦» & é‡‘å‰æ­»å‰åˆ†æ</span>
                </div>
                <pre><code><span class="kw">def</span> <span class="fn">detect_bar_area_divergence</span>(<span class="kw">self</span>, order=<span class="nu">5</span>):
    <span class="st">"""æŸ±å †é¢ç§¯(æ‰€æœ‰æŸ±å­ç»å¯¹å€¼ä¹‹å’Œ)èƒŒç¦»"""</span>
    groups = identify_bar_groups(df[<span class="st">'MACD_BAR'</span>])
    <span class="kw">for</span> g <span class="kw">in</span> groups:
        g[<span class="st">'area'</span>] = df[<span class="st">'MACD_BAR'</span>].iloc[g[<span class="st">'start'</span>]:g[<span class="st">'end'</span>]+<span class="nu">1</span>].abs().sum()
    <span class="cm"># æ¯”è¾ƒåŒè‰²ç›¸é‚»/éš”å †çš„é¢ç§¯å˜åŒ–</span>

<span class="kw">def</span> <span class="fn">analyze_macd_crosses</span>(<span class="kw">self</span>):
    <span class="st">"""é‡‘å‰: DIFä¸Šç©¿DEA (ä¹°å…¥ä¿¡å·)
    æ­»å‰: DIFä¸‹ç©¿DEA (å–å‡ºä¿¡å·)
    é›¶è½´ä¸Šæ–¹é‡‘å‰æ›´å¼º, é›¶è½´ä¸‹æ–¹æ­»å‰æ›´å¼±"""</span>
    crosses = find_macd_crosses(df[<span class="st">'DIF'</span>], df[<span class="st">'DEA'</span>])
    <span class="kw">for</span> c <span class="kw">in</span> crosses:
        c[<span class="st">'above_zero'</span>] = df[<span class="st">'DIF'</span>].iloc[c[<span class="st">'idx'</span>]] > <span class="nu">0</span>
    <span class="kw">return</span> crosses</code></pre>
            </div>
        </div>

        <!-- ====== ä»£ç : èƒŒç¦»ä¸èƒŒé©° ====== -->
        <div class="page" id="code-exhaustion">
            <div class="page-title">ç¬¬å››ç«  Â· èƒŒç¦»ä¸èƒŒé©°</div>
            <div class="page-subtitle">exhaustion.py Â· å…¨ä¹¦æœ€æ ¸å¿ƒçš„æ“ä½œç­–ç•¥</div>

            <div class="principle-grid">
                <div class="principle-card sell">
                    <h3>å–ç‚¹ç”¨èƒŒç¦» (å®æ—©å‹¿æ™š)</h3>
                    <p>MACDéš”å †èƒŒç¦»ä¸€æ¬¡ + DIFè¿”å›é›¶è½´ â†’ å³è€ƒè™‘å–å‡º<br>
                    æˆ–: ä¸¤æ¬¡ä»¥ä¸Šéš”å †èƒŒç¦» â†’ æ— è®ºæ˜¯å¦è¿”å›é›¶è½´éƒ½è€ƒè™‘å–å‡º</p>
                </div>
                <div class="principle-card buy">
                    <h3>ä¹°ç‚¹ç”¨èƒŒé©° (å®è¿Ÿå‹¿æ—©)</h3>
                    <p>äºŒæ¬¡ä»¥ä¸Šéš”å †èƒŒç¦» + DIFä¸¤æ¬¡è¿”å›é›¶è½´åå†åº¦åº•èƒŒç¦» â†’ æ‰è€ƒè™‘ä¹°å…¥<br>
                    æ¡ä»¶æ›´ä¸¥æ ¼, å‡å°‘æŠ„åº•é£é™©</p>
                </div>
            </div>

            <div class="code-section">
                <div class="code-header">
                    <span class="code-file">divergence/exhaustion.py</span>
                    <span>èƒŒé©°æ£€æµ‹æ ¸å¿ƒé€»è¾‘</span>
                </div>
                <pre><code><span class="kw">class</span> <span class="cl">ExhaustionAnalyzer</span>:
    <span class="st">"""èƒŒé©°åˆ†æå™¨ â€” è¶‹åŠ¿çš„æœ€åä¸€æ¬¡èƒŒç¦»"""</span>

    <span class="kw">def</span> <span class="fn">_count_zero_returns</span>(<span class="kw">self</span>, direction=<span class="st">'top'</span>):
        <span class="st">"""è®¡ç®—MACD DIFçº¿è¿”å›é›¶è½´çš„æ¬¡æ•°
        é¡¶èƒŒé©°: DIFä»æ­£å€¼åŒºåŸŸå›åˆ°0é™„è¿‘å†å›å‡çš„æ¬¡æ•°
        åº•èƒŒé©°: DIFä»è´Ÿå€¼åŒºåŸŸå›åˆ°0é™„è¿‘å†å›è½çš„æ¬¡æ•°"""</span>
        dif = <span class="kw">self</span>.df[<span class="st">'DIF'</span>]
        zero_threshold = dif.abs().mean() * <span class="nu">0.1</span>  <span class="cm"># æ¥è¿‘é›¶è½´çš„é˜ˆå€¼</span>
        <span class="cm"># éå†DIFåºåˆ—, æ£€æµ‹ "è¿œç¦»é›¶è½´ -> æ¥è¿‘é›¶è½´ -> å†æ¬¡è¿œç¦»" çš„æ¨¡å¼</span>
        returns = []
        <span class="cm">...</span>
        <span class="kw">return</span> returns

    <span class="kw">def</span> <span class="fn">_count_separated_divergences</span>(<span class="kw">self</span>, direction=<span class="st">'top'</span>):
        <span class="st">"""è®¡ç®—éš”å †èƒŒç¦»æ¬¡æ•°(æœ€å…³é”®çš„èƒŒé©°åˆ¤æ®)"""</span>
        <span class="cm"># ä½¿ç”¨ MACDDivergenceAnalyzer è·å–éš”å †èƒŒç¦»ä¿¡å·</span>
        bar_divs = <span class="kw">self</span>.macd_analyzer.detect_bar_length_divergence()
        separated = [d <span class="kw">for</span> d <span class="kw">in</span> bar_divs
                     <span class="kw">if</span> d.get(<span class="st">'subtype'</span>) == <span class="st">'separated'</span>
                     <span class="kw">and</span> d[<span class="st">'type'</span>] == direction]
        <span class="kw">return</span> separated

    <span class="kw">def</span> <span class="fn">detect_exhaustion</span>(<span class="kw">self</span>):
        <span class="st">"""ç»¼åˆåˆ¤æ–­èƒŒé©°"""</span>
        results = []

        <span class="cm"># é¡¶èƒŒé©° (å–å‡ºæ¡ä»¶å®½æ¾)</span>
        top_sep = <span class="kw">self</span>._count_separated_divergences(<span class="st">'top'</span>)
        top_zeros = <span class="kw">self</span>._count_zero_returns(<span class="st">'top'</span>)
        <span class="kw">if</span> len(top_sep) >= <span class="nu">1</span> <span class="kw">and</span> len(top_zeros) >= <span class="nu">1</span>:
            results.append({<span class="st">'type'</span>: <span class="st">'top_exhaustion'</span>, <span class="st">'confidence'</span>: <span class="st">'high'</span>})
        <span class="kw">elif</span> len(top_sep) >= <span class="nu">2</span>:
            results.append({<span class="st">'type'</span>: <span class="st">'top_exhaustion'</span>, <span class="st">'confidence'</span>: <span class="st">'medium'</span>})

        <span class="cm"># åº•èƒŒé©° (ä¹°å…¥æ¡ä»¶ä¸¥æ ¼)</span>
        bot_sep = <span class="kw">self</span>._count_separated_divergences(<span class="st">'bottom'</span>)
        bot_zeros = <span class="kw">self</span>._count_zero_returns(<span class="st">'bottom'</span>)
        <span class="kw">if</span> len(bot_sep) >= <span class="nu">2</span> <span class="kw">and</span> len(bot_zeros) >= <span class="nu">2</span>:
            results.append({<span class="st">'type'</span>: <span class="st">'bottom_exhaustion'</span>, <span class="st">'confidence'</span>: <span class="st">'high'</span>})

        <span class="kw">return</span> results</code></pre>
            </div>
        </div>

        <!-- ====== ä»£ç : å…¶ä»–æŒ‡æ ‡ ====== -->
        <div class="page" id="code-other">
            <div class="page-title">ç¬¬äº”ç«  Â· å…¶ä»–æŒ‡æ ‡èƒŒç¦»</div>
            <div class="page-subtitle">KDJ / CCI / RSI / é‡ä»·èƒŒç¦»</div>

            <div class="code-section">
                <div class="code-header">
                    <span class="code-file">divergence/kdj_divergence.py</span>
                    <span>KDJæŒ‡æ ‡èƒŒç¦»</span>
                </div>
                <pre><code><span class="kw">class</span> <span class="cl">KDJDivergenceAnalyzer</span>:
    <span class="kw">def</span> <span class="fn">detect_top_divergence</span>(<span class="kw">self</span>, order=<span class="nu">5</span>):
        <span class="st">"""ä»·æ ¼åˆ›æ–°é«˜ + Kå€¼åœ¨è¶…ä¹°åŒº(>80) + Kå€¼æœªåˆ›æ–°é«˜ = KDJé¡¶èƒŒç¦»"""</span>
        price_highs = find_swing_highs(df[<span class="st">'high'</span>], order)
        <span class="kw">for</span> i <span class="kw">in</span> range(<span class="nu">1</span>, len(price_highs)):
            k_val = df[<span class="st">'K'</span>].iloc[price_highs[i]]
            <span class="kw">if</span> k_val > <span class="nu">80</span> <span class="kw">and</span> k_val < df[<span class="st">'K'</span>].iloc[price_highs[i-<span class="nu">1</span>]]:
                signals.append({<span class="st">'type'</span>: <span class="st">'top'</span>, <span class="st">'indicator'</span>: <span class="st">'KDJ'</span>})

    <span class="kw">def</span> <span class="fn">detect_bottom_divergence</span>(<span class="kw">self</span>, order=<span class="nu">5</span>):
        <span class="st">"""ä»·æ ¼åˆ›æ–°ä½ + Kå€¼åœ¨è¶…å–åŒº(<20) + Kå€¼æœªåˆ›æ–°ä½ = KDJåº•èƒŒç¦»"""</span></code></pre>
            </div>

            <div class="code-section">
                <div class="code-header">
                    <span class="code-file">divergence/cci_divergence.py Â· divergence/rsi_divergence.py</span>
                    <span>CCI & RSI èƒŒç¦»</span>
                </div>
                <pre><code><span class="cm"># CCI: å¤©çº¿+100, åœ°çº¿-100</span>
<span class="kw">class</span> <span class="cl">CCIDivergenceAnalyzer</span>:
    <span class="kw">def</span> <span class="fn">detect_top_divergence</span>(<span class="kw">self</span>):
        <span class="st">"""ä»·æ ¼æ–°é«˜ + CCIåœ¨+100ä»¥ä¸Š + CCIæœªæ–°é«˜"""</span>
    <span class="kw">def</span> <span class="fn">detect_spring_autumn_crosses</span>(<span class="kw">self</span>):
        <span class="st">"""CCIç©¿è¶Šå¤©çº¿+100(åšå¤š) / è·Œç ´åœ°çº¿-100(åšç©º)"""</span>

<span class="cm"># RSI: è¶…ä¹°>80, è¶…å–<20</span>
<span class="kw">class</span> <span class="cl">RSIDivergenceAnalyzer</span>:
    <span class="kw">def</span> <span class="fn">detect_top_divergence</span>(<span class="kw">self</span>):
        <span class="st">"""ä»·æ ¼æ–°é«˜ + RSI>80 + RSIæœªæ–°é«˜"""</span>
    <span class="kw">def</span> <span class="fn">detect_bottom_divergence</span>(<span class="kw">self</span>):
        <span class="st">"""ä»·æ ¼æ–°ä½ + RSI<20 + RSIæœªæ–°ä½"""</span></code></pre>
            </div>

            <div class="code-section">
                <div class="code-header">
                    <span class="code-file">divergence/volume_price_divergence.py</span>
                    <span>é‡ä»·èƒŒç¦»</span>
                </div>
                <pre><code><span class="kw">class</span> <span class="cl">VolumePriceDivergenceAnalyzer</span>:
    <span class="kw">def</span> <span class="fn">detect_price_up_volume_down</span>(<span class="kw">self</span>):
        <span class="st">"""ä»·å‡é‡å‡: ä»·æ ¼ä¸Šæ¶¨ä½†æˆäº¤é‡ä¸‹é™, ä¸Šæ¶¨è¶‹åŠ¿å¯èƒ½è¡°ç«­"""</span>
        <span class="cm"># æ¯”è¾ƒç›¸é‚»ä¸Šæ¶¨æ®µçš„æˆäº¤é‡: åæ®µé‡ < å‰æ®µé‡</span>

    <span class="kw">def</span> <span class="fn">detect_price_down_volume_up</span>(<span class="kw">self</span>):
        <span class="st">"""ä»·è·Œé‡å¢: ä»·æ ¼ä¸‹è·Œä½†æˆäº¤é‡å¢åŠ , å¯èƒ½æ˜¯ææ…ŒæŠ›å”®"""</span>

    <span class="kw">def</span> <span class="fn">detect_ground_volume</span>(<span class="kw">self</span>):
        <span class="st">"""åœ°é‡åœ°ä»·: æˆäº¤é‡æä½+ä»·æ ¼ä½ä½, å¯èƒ½æ˜¯åº•éƒ¨ä¿¡å·
        é‡ < è¿‘æœŸå‡é‡çš„30% -> åœ°é‡"""</span></code></pre>
            </div>
        </div>

        <!-- ====== å…¨å±€æœ€ä¼˜ç­–ç•¥ ====== -->
        <div class="page" id="global-strategy">
            <div class="page-title">å…¨å±€å¤šå‘¨æœŸèåˆç­–ç•¥</div>
            <div class="page-subtitle">åˆå§‹é…ç½® 100,000 USDT + ä»·å€¼ 100,000 USDT çš„ ETH Â· 9ä¸ªå‘¨æœŸåŠ æƒä¿¡å·èåˆ</div>

            <div id="gs-loading" class="loading">
                <div class="spinner"></div>
                æ­£åœ¨åŠ è½½å…¨å±€ç­–ç•¥æ•°æ®...
            </div>

            <div id="gs-content" style="display:none;">
                <!-- æ‘˜è¦ç»Ÿè®¡ -->
                <div class="stats-grid" id="gs-stats"></div>

                <!-- ç­–ç•¥è¯´æ˜ -->
                <div class="card">
                    <div class="card-title">ç­–ç•¥è¯´æ˜</div>
                    <div class="principle-grid">
                        <div class="principle-card sell">
                            <h3>å–å‡ºé€»è¾‘ (å®æ—©å‹¿æ™š)</h3>
                            <p>
                                â€¢ å¤šå‘¨æœŸèƒŒé©°å–å‡ºä¿¡å· â†’ å–å‡º60%ä»“ä½<br>
                                â€¢ åŠ æƒé¡¶èƒŒç¦»â‰¥35 ä¸”ä»“ä½>30% â†’ å–å‡º30~40%<br>
                                â€¢ å¼ºé¡¶èƒŒç¦»â‰¥50 ä¸”ä»“ä½>20% â†’ å–å‡º40~60%<br>
                                â€¢ ETHæµ®äºè¶…12% â†’ æ­¢æŸå‡ä»“50%
                            </p>
                        </div>
                        <div class="principle-card buy">
                            <h3>ä¹°å…¥é€»è¾‘ (å®è¿Ÿå‹¿æ—©)</h3>
                            <p>
                                â€¢ å¤šå‘¨æœŸèƒŒé©°ä¹°å…¥ä¿¡å· â†’ ä¹°å…¥50%å¯ç”¨èµ„é‡‘<br>
                                â€¢ åŠ æƒåº•èƒŒç¦»â‰¥45 ä¸”ä»“ä½<50% â†’ ä¹°å…¥30%<br>
                                â€¢ å¼ºåº•èƒŒç¦»â‰¥60 ä¸”ä»“ä½<60% â†’ ä¹°å…¥50%<br>
                                â€¢ å†·å´æœŸ: 8å°æ—¶
                            </p>
                        </div>
                    </div>
                    <div style="margin-top:16px;">
                        <div class="card-title" style="font-size:14px;">å„å‘¨æœŸæƒé‡</div>
                        <div id="gs-weights" style="display:flex;gap:10px;flex-wrap:wrap;margin-top:8px;"></div>
                    </div>
                </div>

                <!-- èµ„äº§æ›²çº¿ -->
                <div class="chart-container">
                    <div class="chart-toolbar">
                        <h3>æ€»èµ„äº§æ›²çº¿</h3>
                        <span style="font-size:12px;color:var(--text-muted);">è“çº¿=ç­–ç•¥æ€»èµ„äº§ | ç°è™šçº¿=ä¹°å…¥æŒæœ‰</span>
                    </div>
                    <div id="gs-equity-chart" style="width:100%;height:350px;"></div>
                </div>

                <!-- ä»“ä½å˜åŒ– -->
                <div class="chart-container">
                    <div class="chart-toolbar">
                        <h3>ETHä»“ä½æ¯”ä¾‹å˜åŒ–</h3>
                        <span style="font-size:12px;color:var(--text-muted);">ETHå æ€»èµ„äº§çš„æ¯”ä¾‹</span>
                    </div>
                    <div id="gs-ratio-chart" style="width:100%;height:200px;"></div>
                </div>

                <!-- äº¤æ˜“æ˜ç»†è¡¨ -->
                <div class="card">
                    <div class="card-title">å…¨éƒ¨äº¤æ˜“æ˜ç»† <span class="badge" id="gs-trade-count"></span></div>
                    <div class="trade-table-wrap" style="max-height:600px;">
                        <table id="gs-trades-table">
                            <thead>
                                <tr>
                                    <th>#</th>
                                    <th>æ—¶é—´</th>
                                    <th>æ“ä½œ</th>
                                    <th>ç±»å‹</th>
                                    <th>ETHä»·æ ¼</th>
                                    <th>æ•°é‡(ETH)</th>
                                    <th>é‡‘é¢(USDT)</th>
                                    <th>æ‰‹ç»­è´¹</th>
                                    <th>USDTä½™é¢</th>
                                    <th>ETHæŒä»“</th>
                                    <th>æ€»èµ„äº§</th>
                                    <th>åŸå› </th>
                                    <th>å„å‘¨æœŸä¿¡å·</th>
                                </tr>
                            </thead>
                            <tbody id="gs-trades-body"></tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>

        <!-- ====== åˆçº¦åšç©ºç­–ç•¥ ====== -->
        <div class="page" id="strategy-futures">
            <div class="page-title">åˆçº¦åšç©ºç­–ç•¥</div>
            <div class="page-subtitle">å…è®¸åšç©º Â· USDTæ°¸ç»­åˆçº¦ Â· é€ä»“æ¨¡å¼ Â· å¤šç§ç­–ç•¥å¯¹æ¯”</div>

            <div class="card" id="ft-intro">
                <div class="card-title">åˆçº¦äº¤æ˜“è§„åˆ™</div>
                <div style="display:grid;grid-template-columns:repeat(4,1fr);gap:12px;margin-bottom:16px;">
                    <div style="background:var(--bg-hover);border-radius:8px;padding:12px;text-align:center;">
                        <div style="font-size:12px;color:var(--text-muted);margin-bottom:4px;">ä¿è¯é‡‘æ¨¡å¼</div>
                        <div style="font-size:16px;font-weight:700;color:var(--accent-blue);">é€ä»“ Isolated</div>
                    </div>
                    <div style="background:var(--bg-hover);border-radius:8px;padding:12px;text-align:center;">
                        <div style="font-size:12px;color:var(--text-muted);margin-bottom:4px;">æ‰‹ç»­è´¹</div>
                        <div style="font-size:16px;font-weight:700;color:var(--accent-yellow);">Taker 0.05%</div>
                    </div>
                    <div style="background:var(--bg-hover);border-radius:8px;padding:12px;text-align:center;">
                        <div style="font-size:12px;color:var(--text-muted);margin-bottom:4px;">èµ„é‡‘è´¹ç‡</div>
                        <div style="font-size:16px;font-weight:700;color:var(--accent-purple);">Â±0.01%/8h</div>
                    </div>
                    <div style="background:var(--bg-hover);border-radius:8px;padding:12px;text-align:center;">
                        <div style="font-size:12px;color:var(--text-muted);margin-bottom:4px;">é£æ§ä¸Šé™</div>
                        <div style="font-size:16px;font-weight:700;color:var(--accent-red);">10%ä¿è¯é‡‘</div>
                    </div>
                </div>
                <div style="font-size:13px;color:var(--text-secondary);line-height:1.8;">
                    <b>åˆå§‹é…ç½®:</b> 100,000 USDT + ä»·å€¼100,000 USDTçš„ETH<br>
                    <b>æ æ†ä¸Šé™:</b> æœ€é«˜3x Â· å•ç¬”ä¿è¯é‡‘â‰¤æ€»èµ„äº§5% Â· ç´¯è®¡ä¿è¯é‡‘ååâ‰¤åˆå§‹150%<br>
                    <b>åšç©ºæœºåˆ¶:</b> é¡¶èƒŒç¦»/èƒŒé©°ä¿¡å·â†’å¼€ç©ºä»“å¯¹å†²æˆ–åšç©ºè·åˆ© Â· åº•ä¿¡å·â†’å¹³ç©º<br>
                    <b>æ»‘ç‚¹æ¨¡å‹:</b> 0.1%åŒå‘æ»‘ç‚¹(å«å¸‚åœºå†²å‡»)
                </div>
            </div>

            <!-- ç­–ç•¥è¯´æ˜å¡ç‰‡ -->
            <div class="card">
                <div class="card-title">5ç§åˆçº¦ç­–ç•¥ + 1ä¸ªçº¯ç°è´§å¯¹ç…§</div>
                <div style="display:grid;grid-template-columns:repeat(3,1fr);gap:12px;margin-bottom:20px;" id="ft-strategy-cards"></div>
            </div>

            <!-- æŸ±çŠ¶å›¾å¯¹æ¯” -->
            <div class="card">
                <div class="card-title">æ”¶ç›Šä¸è¶…é¢æ”¶ç›Šå¯¹æ¯”</div>
                <div id="ft-bar-chart" style="width:100%;min-height:350px;"></div>
            </div>

            <!-- æ•°æ®è¡¨æ ¼ -->
            <div class="card">
                <div class="card-title">è¯¦ç»†æŒ‡æ ‡å¯¹æ¯”</div>
                <div class="trade-table-wrap" style="max-height:none;">
                    <table id="ft-table">
                        <thead><tr id="ft-table-head"></tr></thead>
                        <tbody id="ft-table-body"></tbody>
                    </table>
                </div>
            </div>

            <!-- èµ„äº§æ›²çº¿ -->
            <div class="card">
                <div class="card-title">èµ„äº§æ›²çº¿å¯¹æ¯”</div>
                <div id="ft-equity-chart" style="width:100%;height:400px;"></div>
            </div>

            <!-- æœ€ä½³ç­–ç•¥äº¤æ˜“æ˜ç»† -->
            <div class="card">
                <div class="card-title">æœ€ä½³ç­–ç•¥äº¤æ˜“æ˜ç»† <span class="badge green" id="ft-trade-count"></span></div>
                <div class="trade-table-wrap" style="max-height:500px;">
                    <table id="ft-trades-table">
                        <thead>
                            <tr>
                                <th>#</th><th>æ—¶é—´</th><th>æ“ä½œ</th><th>æ–¹å‘</th><th>ä»·æ ¼</th>
                                <th>æ•°é‡</th><th>åä¹‰ä»·å€¼</th><th>æ æ†</th>
                                <th>USDTä½™é¢</th><th>å†»ç»“ä¿è¯é‡‘</th><th>æ€»èµ„äº§</th><th>åŸå› </th>
                            </tr>
                        </thead>
                        <tbody id="ft-trades-body"></tbody>
                    </table>
                </div>
            </div>

            <!-- ç»“è®º -->
            <div class="card" id="ft-conclusion"></div>

            <!-- ====== Phase 2: è¿›é˜¶ä¼˜åŒ– ====== -->
            <div id="ft2-section" style="display:none;">
                <div class="card" style="margin-top:24px;">
                    <div class="card-title">Phase 2 Â· åŸºäºä¹¦ä¸­æ ¸å¿ƒåŸåˆ™è¿›é˜¶ä¼˜åŒ–
                        <span class="badge" style="background:rgba(168,85,247,0.15);color:var(--accent-purple);">NEW</span>
                    </div>
                    <div class="page-subtitle" style="margin-bottom:16px;">
                        åˆ†æPhase 1ç­–ç•¥Pçš„ä¸è¶³ â†’ 6ç§åŸºäºä¹¦ä¸­æ ¸å¿ƒåŸåˆ™çš„æ–°ç­–ç•¥
                    </div>
                    <div style="display:grid;grid-template-columns:repeat(3,1fr);gap:12px;margin-bottom:16px;" id="ft2-strategy-cards"></div>
                </div>

                <div class="card">
                    <div class="card-title">Phase 2 æ”¶ç›Šå¯¹æ¯”</div>
                    <div id="ft2-bar-chart" style="width:100%;min-height:350px;"></div>
                </div>

                <div class="card">
                    <div class="card-title">Phase 2 è¯¦ç»†å¯¹æ¯”</div>
                    <div class="trade-table-wrap" style="max-height:none;">
                        <table id="ft2-table">
                            <thead><tr id="ft2-table-head"></tr></thead>
                            <tbody id="ft2-table-body"></tbody>
                        </table>
                    </div>
                </div>

                <div class="card">
                    <div class="card-title">Phase 2 èµ„äº§æ›²çº¿</div>
                    <div id="ft2-equity-chart" style="width:100%;height:400px;"></div>
                </div>

                <div class="card">
                    <div class="card-title">æœ€ä½³ç­–ç•¥äº¤æ˜“æ˜ç»† <span class="badge green" id="ft2-trade-count"></span></div>
                    <div class="trade-table-wrap" style="max-height:500px;">
                        <table id="ft2-trades-table">
                            <thead>
                                <tr>
                                    <th>#</th><th>æ—¶é—´</th><th>æ“ä½œ</th><th>æ–¹å‘</th><th>ä»·æ ¼</th>
                                    <th>æ•°é‡</th><th>åä¹‰ä»·å€¼</th><th>æ æ†</th>
                                    <th>USDTä½™é¢</th><th>å†»ç»“ä¿è¯é‡‘</th><th>æ€»èµ„äº§</th><th>åŸå› </th>
                                </tr>
                            </thead>
                            <tbody id="ft2-trades-body"></tbody>
                        </table>
                    </div>
                </div>

                <div class="card" id="ft2-conclusion"></div>
            </div>

            <!-- ====== Phase 3: æ·±åº¦ä¼˜åŒ– ====== -->
            <div id="ft3-section" style="display:none;">
                <div class="card" style="margin-top:24px;">
                    <div class="card-title">Phase 3 Â· Sç­–ç•¥æ·±åº¦ä¼˜åŒ–
                        <span class="badge" style="background:rgba(255,107,107,0.15);color:var(--accent-red);">DEEP DIVE</span>
                    </div>
                    <div class="page-subtitle" style="margin-bottom:12px;">
                        æ ¸å¿ƒå‘ç°ï¼šSç­–ç•¥63ç¬”ç©ºä»“å‡€äº$738(èƒœç‡2%)ï¼Œåˆ©æ¶¦å…¨éƒ¨æ¥è‡ªç°è´§å‡ä»“æ‹©æ—¶
                    </div>
                    <div style="background:rgba(255,107,107,0.08);border-radius:8px;padding:14px 18px;margin-bottom:16px;border-left:3px solid var(--accent-red);">
                        <div style="font-weight:600;color:var(--accent-red);margin-bottom:6px;">å…³é”®æ´å¯Ÿ</div>
                        <div style="font-size:13px;color:var(--text-secondary);line-height:1.7;">
                            <b>ç©ºä»“ä»·å€¼å¯¹æ¯”</b>: S0(æœ‰ç©ºä»“) vs S1(çº¯ç°è´§å‡ä»“) â†’ é‡åŒ–ç©ºä»“çš„çœŸå®è´¡çŒ®<br>
                            <b>ä¼˜åŒ–æ€è·¯</b>: â‘  é™ä½åšç©ºé—¨æ§› vs æé«˜é€‰æ‹©æ€§ â‘¡ è¿½è¸ªæ­¢ç›ˆæ›¿ä»£å›ºå®šæ­¢ç›ˆ â‘¢ 4hçº§è”ç¡®è®¤ â‘£ æå€¼åŒºç²¾å‡†åšç©º â‘¤ é•¿æŒå®½æ­¢æŸ â‘¥ å‚æ•°ç½‘æ ¼æœç´¢
                        </div>
                    </div>
                    <div style="display:grid;grid-template-columns:repeat(auto-fit,minmax(220px,1fr));gap:12px;margin-bottom:16px;" id="ft3-strategy-cards"></div>
                </div>

                <div class="card">
                    <div class="card-title">Phase 3 æ”¶ç›Šå¯¹æ¯”</div>
                    <div id="ft3-bar-chart" style="width:100%;min-height:400px;"></div>
                </div>

                <div class="card">
                    <div class="card-title">Phase 3 è¯¦ç»†å¯¹æ¯”</div>
                    <div class="trade-table-wrap" style="max-height:none;">
                        <table id="ft3-table">
                            <thead><tr id="ft3-table-head"></tr></thead>
                            <tbody id="ft3-table-body"></tbody>
                        </table>
                    </div>
                </div>

                <div class="card">
                    <div class="card-title">Phase 3 èµ„äº§æ›²çº¿</div>
                    <div id="ft3-equity-chart" style="width:100%;height:400px;"></div>
                </div>

                <div class="card">
                    <div class="card-title">æœ€ä½³ç­–ç•¥äº¤æ˜“æ˜ç»† <span class="badge green" id="ft3-trade-count"></span></div>
                    <div class="trade-table-wrap" style="max-height:500px;">
                        <table id="ft3-trades-table">
                            <thead>
                                <tr>
                                    <th>#</th><th>æ—¶é—´</th><th>æ“ä½œ</th><th>æ–¹å‘</th><th>ä»·æ ¼</th>
                                    <th>æ•°é‡</th><th>åä¹‰ä»·å€¼</th><th>æ æ†</th>
                                    <th>USDTä½™é¢</th><th>å†»ç»“ä¿è¯é‡‘</th><th>æ€»èµ„äº§</th><th>åŸå› </th>
                                </tr>
                            </thead>
                            <tbody id="ft3-trades-body"></tbody>
                        </table>
                    </div>
                </div>

                <div class="card" id="ft3-conclusion"></div>
            </div>

            <!-- ====== Phase 4: å¼•æ“ä¿®æ­£ + çœŸå®ä¼˜åŒ– ====== -->
            <div id="ft4-section" style="display:none;">
                <div class="card" style="margin-top:24px;">
                    <div class="card-title">Phase 4 Â· å¼•æ“ä¿®æ­£ + çœŸå®ä¼˜åŒ–
                        <span class="badge" style="background:rgba(239,68,68,0.15);color:#ef4444;">BUG FIX</span>
                    </div>
                    <div style="background:rgba(239,68,68,0.08);border-radius:8px;padding:14px 18px;margin-bottom:16px;border-left:3px solid #ef4444;">
                        <div style="font-weight:600;color:#ef4444;margin-bottom:6px;">å…³é”®ä¿®å¤ï¼šä¿è¯é‡‘åŒé‡è®¡ç®—Bug</div>
                        <div style="font-size:13px;color:var(--text-secondary);line-height:1.7;">
                            å‘ç°close_short/close_longå­˜åœ¨ä¿è¯é‡‘é‡å¤å…¥è´¦ç¼ºé™·â€”â€”ä¿è¯é‡‘åœ¨usdtä¸­ä»æœªæ‰£é™¤,ä½†å¹³ä»“æ—¶è¢«åŠ å›ã€‚<br>
                            <b>å½±å“</b>: æ­¤å‰æ¯ç¬”åšç©ºround-tripè™šå¢~$5,000, 63ç¬”ç´¯è®¡è™šå¢~$300,000<br>
                            <b>ä¿®æ­£å</b>: æ‰€æœ‰ç­–ç•¥æ”¶ç›Šå›å½’çœŸå®æ°´å¹³, Phase 1-3æ•°æ®å·²åŒæ­¥æ›´æ–°
                        </div>
                    </div>
                    <div class="page-subtitle" style="margin-bottom:12px;">
                        æ ¸å¿ƒç­–ç•¥ï¼šæ›´æ—©æ›´å¤§é‡å–å‡ºETH + æå°‘é‡é«˜ç¡®ä¿¡åº¦é•¿æŒåšç©º
                    </div>
                    <div style="display:grid;grid-template-columns:repeat(auto-fit,minmax(220px,1fr));gap:12px;margin-bottom:16px;" id="ft4-strategy-cards"></div>
                </div>
                <div class="card"><div class="card-title">Phase 4 æ”¶ç›Šå¯¹æ¯”</div><div id="ft4-bar-chart" style="width:100%;min-height:380px;"></div></div>
                <div class="card"><div class="card-title">Phase 4 è¯¦ç»†å¯¹æ¯”</div>
                    <div class="trade-table-wrap" style="max-height:none;"><table id="ft4-table"><thead><tr id="ft4-table-head"></tr></thead><tbody id="ft4-table-body"></tbody></table></div>
                </div>
                <div class="card"><div class="card-title">Phase 4 èµ„äº§æ›²çº¿</div><div id="ft4-equity-chart" style="width:100%;height:400px;"></div></div>
                <div class="card"><div class="card-title">æœ€ä½³ç­–ç•¥äº¤æ˜“æ˜ç»† <span class="badge green" id="ft4-trade-count"></span></div>
                    <div class="trade-table-wrap" style="max-height:500px;"><table id="ft4-trades-table"><thead><tr><th>#</th><th>æ—¶é—´</th><th>æ“ä½œ</th><th>æ–¹å‘</th><th>ä»·æ ¼</th><th>æ•°é‡</th><th>åä¹‰ä»·å€¼</th><th>æ æ†</th><th>USDTä½™é¢</th><th>å†»ç»“ä¿è¯é‡‘</th><th>æ€»èµ„äº§</th><th>åŸå› </th></tr></thead><tbody id="ft4-trades-body"></tbody></table></div>
                </div>
                <div class="card" id="ft4-conclusion"></div>
            </div>

            <!-- ====== Phase 5: ç»ˆæä¼˜åŒ– ====== -->
            <div id="ft5-section" style="display:none;">
                <div class="card" style="margin-top:24px;">
                    <div class="card-title">Phase 5 Â· ç»ˆæä¼˜åŒ–
                        <span class="badge" style="background:rgba(16,185,129,0.15);color:#10b981;">FINAL</span>
                    </div>
                    <div class="page-subtitle" style="margin-bottom:12px;">
                        åŸºäºA3(å·¨é¢ç©ºä»“)çš„æè‡´å¼ºåŒ–ï¼šæ»¡ä»“ä¿è¯é‡‘ + æ—©é¸Ÿå‡ä»“ + åŒç©ºä»“ + åº•éƒ¨åšå¤š
                    </div>
                    <div style="display:grid;grid-template-columns:repeat(auto-fit,minmax(220px,1fr));gap:12px;margin-bottom:16px;" id="ft5-strategy-cards"></div>
                </div>
                <div class="card"><div class="card-title">Phase 5 æ”¶ç›Šå¯¹æ¯”</div><div id="ft5-bar-chart" style="width:100%;min-height:380px;"></div></div>
                <div class="card"><div class="card-title">Phase 5 è¯¦ç»†å¯¹æ¯”</div>
                    <div class="trade-table-wrap" style="max-height:none;"><table id="ft5-table"><thead><tr id="ft5-table-head"></tr></thead><tbody id="ft5-table-body"></tbody></table></div>
                </div>
                <div class="card"><div class="card-title">Phase 5 èµ„äº§æ›²çº¿</div><div id="ft5-equity-chart" style="width:100%;height:400px;"></div></div>
                <div class="card"><div class="card-title">æœ€ä½³ç­–ç•¥äº¤æ˜“æ˜ç»† <span class="badge green" id="ft5-trade-count"></span></div>
                    <div class="trade-table-wrap" style="max-height:500px;"><table id="ft5-trades-table"><thead><tr><th>#</th><th>æ—¶é—´</th><th>æ“ä½œ</th><th>æ–¹å‘</th><th>ä»·æ ¼</th><th>æ•°é‡</th><th>åä¹‰ä»·å€¼</th><th>æ æ†</th><th>USDTä½™é¢</th><th>å†»ç»“ä¿è¯é‡‘</th><th>æ€»èµ„äº§</th><th>åŸå› </th></tr></thead><tbody id="ft5-trades-body"></tbody></table></div>
                </div>
                <div class="card" id="ft5-conclusion"></div>
            </div>

            <!-- ====== ç»ˆæä¼˜åŒ–: æ¶ˆé™¤äº‹ååå·® ====== -->
            <div id="ftfinal-section" style="display:none;">
                <div class="card" style="margin-top:24px;">
                    <div class="card-title">ç»ˆæç‰ˆ Â· æ¶ˆé™¤äº‹ååå·®çš„çœŸå®å›æµ‹
                        <span class="badge" style="background:rgba(59,130,246,0.15);color:#3b82f6;">HONEST</span>
                    </div>
                    <div style="background:rgba(239,68,68,0.06);border-radius:8px;padding:14px 18px;margin-bottom:16px;border-left:3px solid #ef4444;">
                        <div style="font-weight:600;color:#ef4444;margin-bottom:6px;">å·²æ¶ˆé™¤çš„äº‹ååå·®</div>
                        <div style="font-size:13px;color:var(--text-secondary);line-height:1.7;">
                            <s>holdâˆ (æ°¸ä¸å¹³ä»“)</s> â†’ æ”¹ä¸ºä¿¡å·+æ­¢æŸ+è¶…æ—¶é€€å‡º<br>
                            <s>bs_close=9999 (ç¦ç”¨åº•éƒ¨ä¿¡å·)</s> â†’ æ”¹ä¸ºBSâ‰¥35ç†è®ºé˜ˆå€¼<br>
                            <s>single_pct=80% (æç«¯ä»“ä½)</s> â†’ æ”¹ä¸º15-30%æ ‡å‡†ä»“ä½<br>
                            <s>åœ¨æµ‹è¯•é›†ä¸Šä¼˜åŒ–å‚æ•°</s> â†’ Walk-Forwardæ ·æœ¬å¤–éªŒè¯
                        </div>
                    </div>
                    <div class="page-subtitle" style="margin-bottom:12px;">
                        ä¸‰ç§éªŒè¯æ–¹æ³•: ä¹¦æœ¬ç†è®º(é›¶ä¼˜åŒ–) + Walk-Forward(ç›²æµ‹) + å‚æ•°æ•æ„Ÿæ€§(é²æ£’æ€§)
                    </div>
                    <div style="display:grid;grid-template-columns:repeat(auto-fit,minmax(220px,1fr));gap:12px;margin-bottom:16px;" id="ftfinal-strategy-cards"></div>
                </div>
                <div class="card"><div class="card-title">æ–¹æ³•A: ä¹¦æœ¬ç†è®ºç­–ç•¥å¯¹æ¯”</div><div id="ftfinal-bar-chart" style="width:100%;min-height:300px;"></div></div>
                <div class="card"><div class="card-title">ç­–ç•¥è¯¦ç»†å¯¹æ¯”</div>
                    <div class="trade-table-wrap" style="max-height:none;"><table id="ftfinal-table"><thead><tr id="ftfinal-table-head"></tr></thead><tbody id="ftfinal-table-body"></tbody></table></div>
                </div>
                <div class="card"><div class="card-title">æœ€ä½³ç­–ç•¥èµ„äº§æ›²çº¿</div><div id="ftfinal-equity-chart" style="width:100%;height:400px;"></div></div>
                <div class="card"><div class="card-title">æœ€ä½³ç­–ç•¥äº¤æ˜“æ˜ç»† <span class="badge" style="background:rgba(59,130,246,0.15);color:#3b82f6;" id="ftfinal-trade-count"></span></div>
                    <div class="trade-table-wrap" style="max-height:500px;"><table id="ftfinal-trades-table"><thead><tr><th>#</th><th>æ—¶é—´</th><th>æ“ä½œ</th><th>æ–¹å‘</th><th>ä»·æ ¼</th><th>æ•°é‡</th><th>åä¹‰ä»·å€¼</th><th>æ æ†</th><th>USDTä½™é¢</th><th>å†»ç»“ä¿è¯é‡‘</th><th>æ€»èµ„äº§</th><th>å†³ç­–ä¾æ®</th></tr></thead><tbody id="ftfinal-trades-body"></tbody></table></div>
                </div>
                <div class="card" id="ftfinal-wf-section">
                    <div class="card-title">æ–¹æ³•B: Walk-Forward æ ·æœ¬å¤–éªŒè¯</div>
                    <div id="ftfinal-wf-content"></div>
                </div>
                <div class="card" id="ftfinal-sensitivity-section">
                    <div class="card-title">æ–¹æ³•C: å‚æ•°æ•æ„Ÿæ€§åˆ†æ</div>
                    <div id="ftfinal-sensitivity-content"></div>
                </div>
                <div class="card" id="ftfinal-conclusion"></div>
            </div>

            <!-- ====== å¤šæ—¶é—´å‘¨æœŸä¿¡å·ä»·å€¼åˆ†æ ====== -->
            <div id="tf-analysis-section" style="display:none;">
                <div class="card" style="margin-top:24px;">
                    <div class="card-title">å¤šæ—¶é—´å‘¨æœŸä¿¡å·ä»·å€¼åˆ†æ
                        <span class="badge" style="background:rgba(168,85,247,0.15);color:#a855f7;">TIMEFRAME</span>
                    </div>
                    <div style="background:rgba(168,85,247,0.06);border-radius:8px;padding:14px 18px;margin-bottom:16px;border-left:3px solid #a855f7;">
                        <div style="font-weight:600;color:#a855f7;margin-bottom:6px;">æ ¸å¿ƒé—®é¢˜: 10åˆ†é’Ÿ/15åˆ†é’Ÿ/30åˆ†é’Ÿä¿¡å·æ˜¯å¦æœ‰ç”¨?</div>
                        <div style="font-size:13px;color:var(--text-secondary);line-height:1.7;">
                            å½“å‰ç³»ç»Ÿä½¿ç”¨ 1h~8h äº”ä¸ªå‘¨æœŸ, æƒé‡: 4h=1.0 > 6h=0.85 > 2h=0.7 > 8h=0.5 > 1h=0.3<br>
                            æœ¬åˆ†ææµ‹è¯• 15m~8h æ‰€æœ‰å‘¨æœŸçš„å•ç‹¬æ•ˆæœå’Œç»„åˆæ•ˆæœ, æ‰¾å‡ºæœ€æœ‰ä»·å€¼çš„ä¿¡å·æ¥æº
                        </div>
                    </div>
                </div>

                <!-- å•ä¸€å‘¨æœŸæ•ˆæœ -->
                <div class="card">
                    <div class="card-title">å„å•ä¸€å‘¨æœŸä¿¡å·çš„ç‹¬ç«‹æ•ˆæœ</div>
                    <div id="tf-single-bar" style="width:100%;min-height:300px;"></div>
                    <div class="trade-table-wrap" style="max-height:none;margin-top:16px;">
                        <table id="tf-single-table"><thead><tr><th>å‘¨æœŸ</th><th>Î±(%)</th><th>ç­–ç•¥æ”¶ç›Š(%)</th><th>æœ€å¤§å›æ’¤(%)</th><th>äº¤æ˜“ç¬”æ•°</th><th>ä¿¡å·ç‚¹æ•°</th><th>è´¹ç”¨($)</th></tr></thead><tbody id="tf-single-body"></tbody></table>
                    </div>
                </div>

                <!-- å‘¨æœŸç»„åˆæ’å -->
                <div class="card">
                    <div class="card-title">ä¸åŒå‘¨æœŸç»„åˆçš„Î±æ’å</div>
                    <div id="tf-combo-bar" style="width:100%;min-height:400px;"></div>
                    <div class="trade-table-wrap" style="max-height:none;margin-top:16px;">
                        <table id="tf-combo-table"><thead><tr><th>æ’å</th><th>ç»„åˆåç§°</th><th>Î±(%)</th><th>ç­–ç•¥æ”¶ç›Š(%)</th><th>æœ€å¤§å›æ’¤(%)</th><th>äº¤æ˜“ç¬”æ•°</th></tr></thead><tbody id="tf-combo-body"></tbody></table>
                    </div>
                </div>

                <!-- ä¿¡å·æ—¶é—´çº¿ -->
                <div class="card">
                    <div class="card-title">ä¿¡å·æ£€æµ‹é€Ÿåº¦ (å„å‘¨æœŸä½•æ—¶æ£€æµ‹åˆ°ETHé¡¶éƒ¨)</div>
                    <div id="tf-timing-chart" style="width:100%;min-height:280px;"></div>
                    <div id="tf-timing-detail" style="margin-top:12px;"></div>
                </div>

                <!-- ä¿¡å·å€¼çŸ©é˜µçƒ­åŠ›å›¾ -->
                <div class="card">
                    <div class="card-title">ä¿¡å·å€¼çŸ©é˜µ (å…³é”®æ—¶é—´ç‚¹å„å‘¨æœŸä¿¡å·å¼ºåº¦)</div>
                    <div id="tf-matrix-content"></div>
                </div>

                <!-- æ ¸å¿ƒå‘ç° -->
                <div class="card">
                    <div class="card-title">æ ¸å¿ƒå‘ç°ä¸å»ºè®®</div>
                    <div id="tf-findings-content"></div>
                </div>

                <!-- æœ€ä½³ç­–ç•¥äº¤æ˜“æ˜ç»† -->
                <div class="card">
                    <div class="card-title">æœ€ä½³ç»„åˆçš„äº¤æ˜“æ˜ç»†</div>
                    <div class="trade-table-wrap" style="max-height:500px;">
                        <table id="tf-trades-table"><thead><tr><th>#</th><th>æ—¶é—´</th><th>æ“ä½œ</th><th>æ–¹å‘</th><th>ä»·æ ¼($)</th><th>å†³ç­–ä¾æ®</th></tr></thead><tbody id="tf-trades-body"></tbody></table>
                    </div>
                </div>

                <div class="card" id="tf-conclusion"></div>
            </div>

            <!-- ====== 15åˆ†é’ŸåŒå‘å›æµ‹ ====== -->
            <div id="s15m-section" style="display:none;">
                <div class="card" style="margin-top:24px;">
                    <div class="card-title" id="s15m-title">15åˆ†é’ŸåŒå‘å›æµ‹ Â· åšå¤š+åšç©º
                        <span class="badge" style="background:rgba(249,115,22,0.15);color:#f97316;">15M BIDIRECTIONAL</span>
                    </div>
                    <div style="background:rgba(249,115,22,0.06);border-radius:8px;padding:14px 18px;margin-bottom:16px;border-left:3px solid #f97316;">
                        <div style="font-weight:600;color:#f97316;margin-bottom:6px;">ç­–ç•¥è¯´æ˜</div>
                        <div style="font-size:13px;color:var(--text-secondary);line-height:1.7;" id="s15m-desc">
                            ä¸»ä¿¡å·: 15åˆ†é’ŸKçº¿ + 1h/8hè¾…åŠ©<br>
                            æ–¹å‘: é¡¶èƒŒç¦»â†’å–å‡º+å¼€ç©º | åº•èƒŒç¦»â†’ä¹°å…¥+å¼€å¤š<br>
                            åˆå§‹: 10ä¸‡USDT + ä»·å€¼10ä¸‡USDT ETH | æ‰‹ç»­è´¹: 0.05% + 0.1%æ»‘ç‚¹ + èµ„é‡‘è´¹ç‡
                        </div>
                    </div>
                    <div style="display:grid;grid-template-columns:repeat(auto-fit,minmax(200px,1fr));gap:12px;margin-bottom:16px;" id="s15m-cards"></div>
                </div>
                <div class="card">
                    <div class="card-title">ç­–ç•¥Î±å¯¹æ¯”</div>
                    <div id="s15m-bar" style="width:100%;min-height:300px;"></div>
                </div>
                <div class="card">
                    <div class="card-title">ç­–ç•¥è¯¦ç»†å¯¹æ¯”</div>
                    <div class="trade-table-wrap" style="max-height:none;">
                        <table id="s15m-table"><thead><tr><th>æ’å</th><th>ç­–ç•¥</th><th>Î±(%)</th><th>ç­–ç•¥æ”¶ç›Š(%)</th><th>BHæ”¶ç›Š(%)</th><th>å›æ’¤(%)</th><th>äº¤æ˜“</th><th>å¼ºå¹³</th><th>è´¹ç”¨($)</th></tr></thead><tbody id="s15m-body"></tbody></table>
                    </div>
                </div>
                <div class="card">
                    <div class="card-title">æœ€ä½³ç­–ç•¥èµ„äº§æ›²çº¿</div>
                    <div id="s15m-equity" style="width:100%;height:400px;"></div>
                </div>
                <div class="card">
                    <div class="card-title">æœ€ä½³ç­–ç•¥äº¤æ˜“æ˜ç»† <span class="badge" style="background:rgba(249,115,22,0.15);color:#f97316;" id="s15m-trade-count"></span></div>
                    <div class="trade-table-wrap" style="max-height:500px;">
                        <table><thead><tr><th>#</th><th>æ—¶é—´</th><th>æ“ä½œ</th><th>æ–¹å‘</th><th>ä»·æ ¼</th><th>æ æ†</th><th>æ€»èµ„äº§</th><th>å†³ç­–ä¾æ®</th></tr></thead><tbody id="s15m-trades"></tbody></table>
                    </div>
                </div>
                <div class="card">
                    <div class="card-title">è´¹ç”¨æ˜ç»†</div>
                    <div id="s15m-fees"></div>
                </div>
                <!-- S3ç­–ç•¥è¯¦è§£ -->
                <div class="card" id="s15m-strategy-detail">
                    <div style="display:flex;gap:8px;margin-bottom:16px;border-bottom:1px solid rgba(255,255,255,0.08);padding-bottom:12px;flex-wrap:wrap;">
                        <button class="s15m-tab active" onclick="switch15mTab(this,'s15m-tab-overview')" style="padding:8px 16px;border-radius:8px;border:none;cursor:pointer;font-size:13px;font-weight:600;background:rgba(249,115,22,0.15);color:#f97316;">ç­–ç•¥æ€»è§ˆ</button>
                        <button class="s15m-tab" onclick="switch15mTab(this,'s15m-tab-signals')" style="padding:8px 16px;border-radius:8px;border:none;cursor:pointer;font-size:13px;font-weight:600;background:var(--bg-hover);color:var(--text-secondary);">ä¿¡å·ç³»ç»Ÿ</button>
                        <button class="s15m-tab" onclick="switch15mTab(this,'s15m-tab-risk')" style="padding:8px 16px;border-radius:8px;border:none;cursor:pointer;font-size:13px;font-weight:600;background:var(--bg-hover);color:var(--text-secondary);">é£æ§è§„åˆ™</button>
                        <button class="s15m-tab" onclick="switch15mTab(this,'s15m-tab-params')" style="padding:8px 16px;border-radius:8px;border:none;cursor:pointer;font-size:13px;font-weight:600;background:var(--bg-hover);color:var(--text-secondary);">å…¨éƒ¨å‚æ•°</button>
                        <button class="s15m-tab" onclick="switch15mTab(this,'s15m-tab-flow')" style="padding:8px 16px;border-radius:8px;border:none;cursor:pointer;font-size:13px;font-weight:600;background:var(--bg-hover);color:var(--text-secondary);">å†³ç­–æµç¨‹</button>
                    </div>

                    <!-- Tab 1: ç­–ç•¥æ€»è§ˆ -->
                    <div id="s15m-tab-overview" class="s15m-tab-content">
                        <div class="card-title">S3: æ¿€è¿›åšç©º Â· ç­–ç•¥è¯¦è§£</div>
                        <div style="display:grid;grid-template-columns:repeat(auto-fit,minmax(300px,1fr));gap:16px;margin-bottom:16px;">
                            <div style="background:rgba(249,115,22,0.06);border-radius:10px;padding:16px;border-left:3px solid #f97316;">
                                <div style="font-weight:700;color:#f97316;font-size:15px;margin-bottom:8px;">æ ¸å¿ƒæ€è·¯</div>
                                <div style="font-size:13px;color:var(--text-secondary);line-height:1.8;">
                                    åŸºäºä¹¦ä¸­<b>èƒŒç¦»æŠ€æœ¯åˆ†æ</b>ç†è®ºï¼Œåœ¨15åˆ†é’ŸKçº¿ä¸Šæ£€æµ‹<b>é¡¶èƒŒç¦»</b>(ä»·æ ¼åˆ›æ–°é«˜ä½†MACDæŸ±ç¼©çŸ­)æ—¶ï¼ŒåŒæ—¶åšä¸¤ä»¶äº‹:<br>
                                    <span style="color:#ef4444;">â¶ å–å‡ºç°è´§ETH</span> â€” é”å®šåˆ©æ¶¦ï¼Œé™ä½æŒä»“é£é™©<br>
                                    <span style="color:#ef4444;">â· å¼€ç©ºåˆçº¦(5xæ æ†)</span> â€” åˆ©ç”¨ä¸‹è·Œèµšå–é¢å¤–æ”¶ç›Š<br><br>
                                    å½“æ£€æµ‹åˆ°<b>åº•èƒŒç¦»</b>æ—¶:<br>
                                    <span style="color:#22c55e;">â¶ ä¹°å…¥ç°è´§ETH</span> â€” ä½ä½è¡¥ä»“<br>
                                    <span style="color:#22c55e;">â· å¼€å¤šåˆçº¦(5xæ æ†)</span> â€” åˆ©ç”¨åå¼¹èµšå–é¢å¤–æ”¶ç›Š
                                </div>
                            </div>
                            <div style="background:rgba(34,197,94,0.06);border-radius:10px;padding:16px;border-left:3px solid #22c55e;">
                                <div style="font-weight:700;color:#22c55e;font-size:15px;margin-bottom:8px;">ä¸ºä»€ä¹ˆå«"æ¿€è¿›"?</div>
                                <div style="font-size:13px;color:var(--text-secondary);line-height:1.8;">
                                    å¯¹æ¯”ä¹¦æœ¬æ ‡å‡†ç­–ç•¥(S1)ï¼ŒS3åšäº†ä»¥ä¸‹è°ƒæ•´:<br><br>
                                    <b>â‘  å¼€ç©ºé˜ˆå€¼æ›´ä½:</b> TSâ‰¥15å³å¯å¼€ç©º (S1è¦æ±‚TSâ‰¥22)<br>
                                    â†’ æ›´æ—©å…¥åœºï¼Œæ•æ‰æ›´å¤šæœºä¼š<br><br>
                                    <b>â‘¡ æ æ†æ›´é«˜:</b> 5x (S1ä¸º3x)<br>
                                    â†’ åŒæ ·çš„ä¿è¯é‡‘ï¼Œæ”¶ç›Šæ”¾å¤§2.5å€<br><br>
                                    <b>â‘¢ ä»“ä½æ›´å¤§:</b> å•ç¬”20%ã€æ€»æ•å£50% (S1ä¸º15%/40%)<br>
                                    â†’ æ›´å¤šèµ„é‡‘å‚ä¸åˆçº¦äº¤æ˜“<br><br>
                                    <b>â‘£ æ­¢æŸæ›´å®½:</b> -35% (S1ä¸º-25%)<br>
                                    â†’ å®¹å¿æ›´å¤§æ³¢åŠ¨ï¼Œé¿å…è¢«çŸ­æš‚åå¼¹æ´—å‡º
                                </div>
                            </div>
                        </div>
                        <div style="background:var(--bg-hover);border-radius:10px;padding:16px;">
                            <div style="font-weight:700;color:var(--text-primary);margin-bottom:10px;">å®ç›˜äº¤æ˜“æ—¶é—´çº¿ (30å¤©12ç¬”äº¤æ˜“)</div>
                            <div style="position:relative;padding-left:24px;">
                                <div style="position:absolute;left:8px;top:0;bottom:0;width:2px;background:rgba(255,255,255,0.1);"></div>
                                <div style="margin-bottom:14px;position:relative;">
                                    <div style="position:absolute;left:-20px;top:4px;width:10px;height:10px;border-radius:50%;background:#ef4444;"></div>
                                    <div style="font-size:13px;"><b style="color:#ef4444;">1/15 04:45</b> â€” ETH@$3,305 Â· TS=128(åŒéš”å †+é¢ç§¯èƒŒç¦»)</div>
                                    <div style="font-size:12px;color:var(--text-muted);margin-top:2px;">å–å‡º50%ç°è´§ â†’ åŒæ—¶å¼€ç©º 5x Â· 15m MACDæ£€æµ‹åˆ°å¼ºé¡¶èƒŒç¦»</div>
                                </div>
                                <div style="margin-bottom:14px;position:relative;">
                                    <div style="position:absolute;left:-20px;top:4px;width:10px;height:10px;border-radius:50%;background:#ef4444;"></div>
                                    <div style="font-size:13px;"><b style="color:#ef4444;">1/15~1/16</b> â€” è¿ç»­3æ¬¡å–å‡ºç°è´§</div>
                                    <div style="font-size:12px;color:var(--text-muted);margin-top:2px;">ä¿¡å·æŒç»­å¼ºåŠ¿(TS=85~128)ï¼Œæ¯12å°æ—¶å–å‡ºä¸€æ¬¡ï¼Œé€æ­¥æ¸…ä»“</div>
                                </div>
                                <div style="margin-bottom:14px;position:relative;">
                                    <div style="position:absolute;left:-20px;top:4px;width:10px;height:10px;border-radius:50%;background:#f59e0b;"></div>
                                    <div style="font-size:13px;"><b style="color:#f59e0b;">1/17 04:30</b> â€” è¶…æ—¶å¹³ä»“ç©ºå¤´ PnL=+$454</div>
                                    <div style="font-size:12px;color:var(--text-muted);margin-top:2px;">æŒä»“48å°æ—¶åˆ°æœŸï¼Œå°èµšå¹³ä»“</div>
                                </div>
                                <div style="margin-bottom:14px;position:relative;">
                                    <div style="position:absolute;left:-20px;top:4px;width:10px;height:10px;border-radius:50%;background:#ef4444;"></div>
                                    <div style="font-size:13px;"><b style="color:#ef4444;">1/17 05:30</b> â€” äºŒæ¬¡å¼€ç©º @$3,294 Â· TS=88</div>
                                    <div style="font-size:12px;color:var(--text-muted);margin-top:2px;">1/18åº•éƒ¨ä¿¡å·(BS=31)è§¦å‘å¹³ä»“, PnL=-$1,324 (å”¯ä¸€äºæŸ)</div>
                                </div>
                                <div style="margin-bottom:14px;position:relative;">
                                    <div style="position:absolute;left:-20px;top:4px;width:10px;height:10px;border-radius:50%;background:#6b7280;"></div>
                                    <div style="font-size:13px;"><b style="color:#6b7280;">1/18~2/05</b> â€” ä¿¡å·å†²çªæœŸï¼Œä¸äº¤æ˜“</div>
                                    <div style="font-size:12px;color:var(--text-muted);margin-top:2px;">TSå’ŒBSåŒæ—¶è¾ƒé«˜(å†²çª)ï¼Œç­–ç•¥è‡ªåŠ¨è·³è¿‡ Â· ETHä»$3,300è·Œåˆ°$1,930</div>
                                </div>
                                <div style="margin-bottom:14px;position:relative;">
                                    <div style="position:absolute;left:-20px;top:4px;width:10px;height:10px;border-radius:50%;background:#22c55e;"></div>
                                    <div style="font-size:13px;"><b style="color:#22c55e;">2/06 01:45</b> â€” ETH@$1,932 Â· BS=81(å¼ºåº•éƒ¨ä¿¡å·)</div>
                                    <div style="font-size:12px;color:var(--text-muted);margin-top:2px;">ä¹°å…¥ç°è´§ + å¼€å¤š 5x Â· åº•èƒŒç¦»+å¤šæŒ‡æ ‡å…±æŒ¯</div>
                                </div>
                                <div style="position:relative;">
                                    <div style="position:absolute;left:-20px;top:4px;width:12px;height:12px;border-radius:50%;background:#22c55e;border:2px solid #fff;"></div>
                                    <div style="font-size:13px;"><b style="color:#22c55e;">2/06 20:30</b> â€” å¹³å¤š @$2,068 Â· PnL=<b>+$10,905</b></div>
                                    <div style="font-size:12px;color:var(--text-muted);margin-top:2px;">é¡¶éƒ¨ä¿¡å·(TS=37)è§¦å‘å¹³ä»“ Â· æŒä»“19å°æ—¶, ETHæ¶¨7%, 5xæ æ†æ”¾å¤§ä¸º35%æ”¶ç›Š Â· <b>è´¡çŒ®äº†ç­–ç•¥ç»å¤§éƒ¨åˆ†åˆ©æ¶¦</b></div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Tab 2: ä¿¡å·ç³»ç»Ÿ -->
                    <div id="s15m-tab-signals" class="s15m-tab-content" style="display:none;">
                        <div class="card-title">ä¿¡å·ç³»ç»Ÿ Â· åŸºäºä¹¦æœ¬çš„å¤šæŒ‡æ ‡èåˆ</div>
                        <div style="margin-bottom:16px;">
                            <div style="font-weight:700;color:#ef4444;font-size:14px;margin-bottom:8px;">é¡¶éƒ¨ä¿¡å·(TS) â€” è§¦å‘å–å‡º/å¼€ç©º</div>
                            <div style="background:var(--bg-hover);border-radius:8px;padding:14px;font-size:13px;line-height:1.8;">
                                TSæ˜¯å¤šä¸ªæŒ‡æ ‡çš„<b>åŠ æƒç»¼åˆè¯„åˆ†</b>ï¼Œæ»¡åˆ†çº¦150+ï¼š<br><br>
                                <div style="display:grid;grid-template-columns:repeat(auto-fit,minmax(250px,1fr));gap:12px;">
                                    <div>
                                        <b>MACDèƒŒç¦» (æœ€é«˜48åˆ†)</b><br>
                                        Â· åŒéš”å †èƒŒç¦»: +30åˆ†<br>
                                        Â· å•éš”å †èƒŒç¦»: +18åˆ†<br>
                                        Â· æŸ±é¢ç§¯èƒŒç¦»: +12åˆ†<br>
                                        Â· DIF/DEAèƒŒç¦»: +8åˆ†
                                    </div>
                                    <div>
                                        <b>èƒŒé©°ä¿¡å· (+28åˆ†)</b><br>
                                        Â· ä¹¦ä¸­"å–ç‚¹èƒŒé©°": +18åˆ†<br>
                                        Â· é›¶è½´å›å½’: +10åˆ†<br>
                                        Â· é€šç”¨é¡¶éƒ¨è¯„åˆ†: TOPÃ—0.2
                                    </div>
                                </div>
                                <div style="margin-top:8px;">
                                    <b>è¶‹åŠ¿åŠ æˆ:</b> 1h/4hç¡®è®¤ä¸‹é™è¶‹åŠ¿ â†’ æ€»åˆ†Ã—1.3å€<br>
                                    <b>å®æ—¶æŒ‡æ ‡:</b> KDJ>80 / RSI>70 / CCI>100 â†’ å¢åŠ å¯ä¿¡åº¦
                                </div>
                            </div>
                        </div>
                        <div style="margin-bottom:16px;">
                            <div style="font-weight:700;color:#22c55e;font-size:14px;margin-bottom:8px;">åº•éƒ¨ä¿¡å·(BS) â€” è§¦å‘ä¹°å…¥/å¼€å¤š/å¹³ç©º</div>
                            <div style="background:var(--bg-hover);border-radius:8px;padding:14px;font-size:13px;line-height:1.8;">
                                BSæ˜¯åº•éƒ¨æŒ‡æ ‡çš„ç»¼åˆè¯„åˆ†:<br><br>
                                <div style="display:grid;grid-template-columns:repeat(auto-fit,minmax(250px,1fr));gap:12px;">
                                    <div>
                                        <b>MACDåº•èƒŒç¦» (æœ€é«˜45åˆ†)</b><br>
                                        Â· åŒéš”å †åº•èƒŒç¦»: +30åˆ†<br>
                                        Â· å•éš”å †åº•èƒŒç¦»: +15åˆ†<br>
                                        Â· é¢ç§¯åº•èƒŒç¦»: +10åˆ†
                                    </div>
                                    <div>
                                        <b>å…¶ä»–ä¿¡å·</b><br>
                                        Â· ä¹°ç‚¹èƒŒé©°: +18åˆ†<br>
                                        Â· é€šç”¨åº•éƒ¨è¯„åˆ†: BOTÃ—0.15<br>
                                        Â· ä¸Šå‡è¶‹åŠ¿åŠ æˆ: Ã—1.2å€
                                    </div>
                                </div>
                                <div style="margin-top:8px;">
                                    <b>å®æ—¶è¾…åŠ©:</b> KDJ&lt;20 / RSI&lt;30 / CCI&lt;-100 â†’ å¢åŠ åº•éƒ¨ç¡®è®¤
                                </div>
                            </div>
                        </div>
                        <div>
                            <div style="font-weight:700;color:#f59e0b;font-size:14px;margin-bottom:8px;">å¤šå‘¨æœŸèåˆæƒé‡</div>
                            <div style="background:var(--bg-hover);border-radius:8px;padding:14px;font-size:13px;line-height:1.8;">
                                <b>15m (ä¸»ä¿¡å·): æƒé‡1.0</b> â€” ä¸»è¦å†³ç­–ä¾æ®ï¼Œ2880æ ¹Kçº¿è¦†ç›–30å¤©<br>
                                <b>1h (è¾…åŠ©): æƒé‡0.4</b> â€” è¿‡æ»¤15må™ªå£°ï¼Œç¡®è®¤ä¸­æœŸè¶‹åŠ¿<br>
                                <b>8h (è¾…åŠ©): æƒé‡0.3</b> â€” å¤§çº§åˆ«ä¿¡å·ç¡®è®¤(8hæœ€æ—©æ£€æµ‹åˆ°é¡¶éƒ¨ï¼Œæ¯”å®é™…é¡¶éƒ¨æ—©36å°æ—¶)<br><br>
                                æœ€ç»ˆ: TS = 15m_topÃ—1.0 + 1h_topÃ—0.4 + 8h_topÃ—0.3 &nbsp;|&nbsp; BSåŒç†
                            </div>
                        </div>
                    </div>

                    <!-- Tab 3: é£æ§è§„åˆ™ -->
                    <div id="s15m-tab-risk" class="s15m-tab-content" style="display:none;">
                        <div class="card-title">é£æ§è§„åˆ™ Â· 5å±‚ä¿æŠ¤æœºåˆ¶</div>
                        <div style="display:grid;grid-template-columns:repeat(auto-fit,minmax(300px,1fr));gap:16px;">
                            <div>
                                <div style="font-weight:700;color:#ef4444;margin-bottom:10px;">åšç©ºé£æ§</div>
                                <div style="background:var(--bg-hover);border-radius:8px;padding:14px;font-size:13px;line-height:2.0;">
                                    <b>â‘  ç¡¬æ­¢æŸ:</b> -35% <span style="color:var(--text-muted);">(äºæŸè¶…ä¿è¯é‡‘35%ç«‹å³å¹³ä»“)</span><br>
                                    <b>â‘¡ ç¡¬æ­¢ç›ˆ:</b> +80% <span style="color:var(--text-muted);">(ç›ˆåˆ©è¾¾ä¿è¯é‡‘80%ç«‹å³é”å®š)</span><br>
                                    <b>â‘¢ è¿½è¸ªæ­¢ç›ˆ:</b> å¯åŠ¨+30%, ä¿ç•™60% <span style="color:var(--text-muted);">(æµ®ç›ˆå›æ’¤40%åˆ™å¹³ä»“)</span><br>
                                    <b>â‘£ åº•éƒ¨ä¿¡å·:</b> BSâ‰¥30 <span style="color:var(--text-muted);">(åº•éƒ¨èƒŒç¦»å‡ºç°ï¼Œå°Šé‡ä¿¡å·ç«‹å³å¹³ä»“)</span><br>
                                    <b>â‘¤ è¶…æ—¶å¹³ä»“:</b> 48å°æ—¶ <span style="color:var(--text-muted);">(æœ€é•¿æŒä»“2å¤©)</span>
                                </div>
                            </div>
                            <div>
                                <div style="font-weight:700;color:#22c55e;margin-bottom:10px;">åšå¤šé£æ§</div>
                                <div style="background:var(--bg-hover);border-radius:8px;padding:14px;font-size:13px;line-height:2.0;">
                                    <b>â‘  ç¡¬æ­¢æŸ:</b> -20% <span style="color:var(--text-muted);">(å¤šä»“æ­¢æŸæ›´ç´§ï¼Œé£é™©é›†ä¸­)</span><br>
                                    <b>â‘¡ ç¡¬æ­¢ç›ˆ:</b> +60% <span style="color:var(--text-muted);">(ç›ˆåˆ©è¾¾ä¿è¯é‡‘60%é”å®š)</span><br>
                                    <b>â‘¢ è¿½è¸ªæ­¢ç›ˆ:</b> å¯åŠ¨+25%, ä¿ç•™60% <span style="color:var(--text-muted);">(æµ®ç›ˆå›æ’¤åˆ™é”å®šåˆ©æ¶¦)</span><br>
                                    <b>â‘£ é¡¶éƒ¨ä¿¡å·:</b> TSâ‰¥30 <span style="color:var(--text-muted);">(é¡¶éƒ¨èƒŒç¦»å‡ºç°ï¼Œå¹³æ‰å¤šä»“)</span><br>
                                    <b>â‘¤ è¶…æ—¶å¹³ä»“:</b> 48å°æ—¶ <span style="color:var(--text-muted);">(æœ€é•¿æŒä»“2å¤©)</span>
                                </div>
                            </div>
                        </div>
                        <div style="margin-top:16px;background:rgba(249,115,22,0.06);border-radius:8px;padding:14px;border-left:3px solid #f97316;">
                            <div style="font-weight:700;color:#f97316;margin-bottom:6px;">é˜²è¿‡åº¦äº¤æ˜“æœºåˆ¶</div>
                            <div style="font-size:13px;color:var(--text-secondary);line-height:1.8;">
                                <b>ä¿¡å·å†²çªè¿‡æ»¤:</b> å½“TSâ‰¥15ä¸”BSâ‰¥15åŒæ—¶å‡ºç° â†’ ä¿¡å·çŸ›ç›¾ï¼Œä¸åšç°è´§äº¤æ˜“<br>
                                <b>ç»Ÿä¸€å†·å´:</b> æ¯æ¬¡ç°è´§äº¤æ˜“å12å°æ—¶å†…ä¸å†äº¤æ˜“(ä¹°å–å…±ç”¨å†·å´)<br>
                                <b>åˆçº¦å†·å´:</b> å¹³ä»“åè‡³å°‘1å°æ—¶æ‰èƒ½é‡æ–°å¼€ä»“<br>
                                <b>ä¸ºä»€ä¹ˆé‡è¦:</b> æ²¡æœ‰è¿™äº›æœºåˆ¶ï¼Œ15mä¿¡å·æŒç»­æœŸé—´æ¯ä¸ªbaréƒ½äº¤æ˜“ï¼Œè´¹ç”¨ä»$1,735æš´æ¶¨åˆ°$155,000
                            </div>
                        </div>
                    </div>

                    <!-- Tab 4: å…¨éƒ¨å‚æ•° -->
                    <div id="s15m-tab-params" class="s15m-tab-content" style="display:none;">
                        <div class="card-title">S3: æ¿€è¿›åšç©º Â· å…¨éƒ¨å‚æ•°</div>
                        <div class="trade-table-wrap" style="max-height:none;">
                            <table style="font-size:13px;">
                                <thead><tr><th>å‚æ•°</th><th>S3å€¼</th><th>S1åŸºå‡†</th><th>è¯´æ˜</th></tr></thead>
                                <tbody>
                                    <tr style="background:rgba(249,115,22,0.06);"><td colspan="4" style="font-weight:700;color:#f97316;">ä¿¡å·é˜ˆå€¼</td></tr>
                                    <tr><td>ts_sell</td><td>15</td><td>15</td><td>ç°è´§å–å‡ºçš„é¡¶éƒ¨ä¿¡å·é˜ˆå€¼</td></tr>
                                    <tr><td><b>ts_short</b></td><td><b style="color:#f97316;">15</b></td><td>22</td><td>å¼€ç©ºä»“çš„é¡¶éƒ¨ä¿¡å·é˜ˆå€¼ (æ¯”S1ä½30%)</td></tr>
                                    <tr><td>bs_buy</td><td>15</td><td>15</td><td>ç°è´§ä¹°å…¥çš„åº•éƒ¨ä¿¡å·é˜ˆå€¼</td></tr>
                                    <tr><td>bs_long</td><td>22</td><td>22</td><td>å¼€å¤šä»“çš„åº•éƒ¨ä¿¡å·é˜ˆå€¼</td></tr>
                                    <tr><td>bs_close</td><td>30</td><td>30</td><td>åº•éƒ¨ä¿¡å·è§¦å‘å¹³ç©ºé˜ˆå€¼</td></tr>
                                    <tr><td>ts_close</td><td>30</td><td>30</td><td>é¡¶éƒ¨ä¿¡å·è§¦å‘å¹³å¤šé˜ˆå€¼</td></tr>
                                    <tr><td>conflict_threshold</td><td>15</td><td>15</td><td>TSå’ŒBSåŒæ—¶é«˜äºæ­¤å€¼=ä¿¡å·å†²çª</td></tr>
                                    <tr style="background:rgba(249,115,22,0.06);"><td colspan="4" style="font-weight:700;color:#f97316;">ä»“ä½ç®¡ç†</td></tr>
                                    <tr><td><b>lev</b></td><td><b style="color:#f97316;">5x</b></td><td>3x</td><td>æ æ†å€æ•° (æ¯”S1é«˜67%)</td></tr>
                                    <tr><td><b>single_pct</b></td><td><b style="color:#f97316;">20%</b></td><td>15%</td><td>å•ç¬”æœ€å¤§ä¿è¯é‡‘(å æ€»èµ„äº§%)</td></tr>
                                    <tr><td><b>total_pct</b></td><td><b style="color:#f97316;">50%</b></td><td>40%</td><td>æ€»åˆçº¦æ•å£ä¸Šé™(å æ€»èµ„äº§%)</td></tr>
                                    <tr><td><b>margin_use</b></td><td><b style="color:#f97316;">80%</b></td><td>60%</td><td>å¯ç”¨ä¿è¯é‡‘ä½¿ç”¨æ¯”ä¾‹</td></tr>
                                    <tr><td>sell_pct</td><td>50%</td><td>50%</td><td>æ¯æ¬¡ç°è´§å–å‡ºæ¯”ä¾‹</td></tr>
                                    <tr><td>buy_pct</td><td>30%</td><td>30%</td><td>æ¯æ¬¡ä¹°å…¥ä½¿ç”¨USDTæ¯”ä¾‹</td></tr>
                                    <tr style="background:rgba(249,115,22,0.06);"><td colspan="4" style="font-weight:700;color:#f97316;">é£æ§å‚æ•°</td></tr>
                                    <tr><td><b>short_sl</b></td><td><b style="color:#f97316;">-35%</b></td><td>-25%</td><td>ç©ºä»“æ­¢æŸ (æ¯”S1å®½40%)</td></tr>
                                    <tr><td>short_tp</td><td>+80%</td><td>+80%</td><td>ç©ºä»“æ­¢ç›ˆ</td></tr>
                                    <tr><td>short_trail</td><td>+30%</td><td>+30%</td><td>ç©ºä»“è¿½è¸ªæ­¢ç›ˆå¯åŠ¨ç‚¹</td></tr>
                                    <tr><td>short_max_hold</td><td>48h</td><td>48h</td><td>ç©ºä»“æœ€å¤§æŒä»“æ—¶é—´</td></tr>
                                    <tr><td>long_sl</td><td>-20%</td><td>-20%</td><td>å¤šä»“æ­¢æŸ</td></tr>
                                    <tr><td>long_tp</td><td>+60%</td><td>+60%</td><td>å¤šä»“æ­¢ç›ˆ</td></tr>
                                    <tr><td>spot_cooldown</td><td>12h</td><td>12h</td><td>ç°è´§äº¤æ˜“ç»Ÿä¸€å†·å´æ—¶é—´</td></tr>
                                    <tr><td>cooldown</td><td>1h</td><td>1h</td><td>åˆçº¦å¼€ä»“å†·å´æ—¶é—´</td></tr>
                                    <tr style="background:rgba(249,115,22,0.06);"><td colspan="4" style="font-weight:700;color:#f97316;">æ‰‹ç»­è´¹æ¨¡å‹</td></tr>
                                    <tr><td>taker_fee</td><td colspan="2">0.05%</td><td>å¸å®‰æ ‡å‡†Takerè´¹ç‡</td></tr>
                                    <tr><td>slippage</td><td colspan="2">0.10%</td><td>æ»‘ç‚¹(å«å¸‚åœºå†²å‡»)</td></tr>
                                    <tr><td>funding_rate</td><td colspan="2">0.01%/8h</td><td>èµ„é‡‘è´¹ç‡(30%æ¦‚ç‡åå‘)</td></tr>
                                    <tr><td>liquidation_fee</td><td colspan="2">0.50%</td><td>å¼ºå¹³æ¸…ç®—æ‰‹ç»­è´¹</td></tr>
                                </tbody>
                            </table>
                        </div>
                        <div style="margin-top:12px;font-size:12px;color:var(--text-muted);">
                            <b style="color:#f97316;">æ©™è‰²</b>æ ‡è®°çš„æ˜¯S3ä¸S1ä¸åŒçš„å‚æ•°ã€‚æ ¸å¿ƒè°ƒæ•´: æ›´ä½çš„å¼€ç©ºé˜ˆå€¼ + æ›´é«˜æ æ† + æ›´å¤§ä»“ä½ + æ›´å®½æ­¢æŸã€‚
                        </div>
                    </div>

                    <!-- Tab 5: å†³ç­–æµç¨‹ -->
                    <div id="s15m-tab-flow" class="s15m-tab-content" style="display:none;">
                        <div class="card-title">ç­–ç•¥å†³ç­–æµç¨‹</div>
                        <div style="background:var(--bg-hover);border-radius:10px;padding:20px;font-size:13px;overflow-x:auto;">
                            <pre style="font-family:monospace;color:var(--text-secondary);line-height:2;margin:0;white-space:pre-wrap;"><b style="color:var(--text-primary);">æ¯15åˆ†é’Ÿæ‰§è¡Œä¸€æ¬¡:</b>

<b style="color:#a855f7;">1. è·å–ä¿¡å·</b>
   â”œâ”€ è®¡ç®—15mä¿¡å·(ä¸»): MACDèƒŒç¦» + KDJ + CCI + RSI + é‡ä»· + å‡ ä½•å½¢æ€
   â”œâ”€ è·å–1hä¿¡å·(è¾…): æƒé‡0.4
   â”œâ”€ è·å–8hä¿¡å·(è¾…): æƒé‡0.3
   â””â”€ èåˆ: TS = Î£(å„å‘¨æœŸtop Ã— æƒé‡), BS = Î£(å„å‘¨æœŸbottom Ã— æƒé‡)

<b style="color:#ef4444;">2. åˆ¤æ–­å–å‡º/å¼€ç©º</b>
   â”œâ”€ TS â‰¥ 15? â”€â”€å¦â”€â”€â†’ è·³è¿‡
   â”œâ”€ å†·å´ä¸­? â”€â”€æ˜¯â”€â”€â†’ è·³è¿‡
   â”œâ”€ TSâ‰¥15 ä¸” BSâ‰¥15? â”€â”€æ˜¯â”€â”€â†’ <b style="color:#f59e0b;">ä¿¡å·å†²çª, è·³è¿‡ç°è´§</b>
   â”œâ”€ <span style="color:#ef4444;">å–å‡º50%ç°è´§ETH</span> (å†·å´12å°æ—¶)
   â””â”€ æ— ç©ºä»“ ä¸” BS&lt;20?
      â””â”€ <span style="color:#ef4444;">å¼€ç©º 5x</span> (å†·å´1å°æ—¶)

<b style="color:#22c55e;">3. åˆ¤æ–­ä¹°å…¥/å¼€å¤š</b>
   â”œâ”€ BS â‰¥ 15? â”€â”€å¦â”€â”€â†’ è·³è¿‡
   â”œâ”€ å†·å´ä¸­? â”€â”€æ˜¯â”€â”€â†’ è·³è¿‡
   â”œâ”€ TSâ‰¥15 ä¸” BSâ‰¥15? â”€â”€æ˜¯â”€â”€â†’ <b style="color:#f59e0b;">ä¿¡å·å†²çª, è·³è¿‡ç°è´§</b>
   â”œâ”€ <span style="color:#22c55e;">ä¹°å…¥ç°è´§(30%å¯ç”¨USDT)</span> (å†·å´12å°æ—¶)
   â””â”€ æ— å¤šä»“ ä¸” TS&lt;20?
      â””â”€ <span style="color:#22c55e;">å¼€å¤š 5x</span> (å†·å´1å°æ—¶)

<b style="color:#f59e0b;">4. ç®¡ç†æŒä»“ (æ¯ä¸ªbaréƒ½æ£€æŸ¥)</b>
   â”œâ”€ <b>ç©ºä»“:</b>
   â”‚   â”œâ”€ PnL â‰¥ +80%? â†’ æ­¢ç›ˆ
   â”‚   â”œâ”€ æµ®ç›ˆæ›¾è¾¾+30%ä¸”å›æ’¤&gt;40%? â†’ è¿½è¸ªæ­¢ç›ˆ
   â”‚   â”œâ”€ BS â‰¥ 30? â†’ åº•éƒ¨ä¿¡å·å¹³ä»“
   â”‚   â”œâ”€ PnL â‰¤ -35%? â†’ ç¡¬æ­¢æŸ
   â”‚   â””â”€ æŒä»“ â‰¥ 48h? â†’ è¶…æ—¶å¹³ä»“
   â””â”€ <b>å¤šä»“:</b>
       â”œâ”€ PnL â‰¥ +60%? â†’ æ­¢ç›ˆ
       â”œâ”€ æµ®ç›ˆæ›¾è¾¾+25%ä¸”å›æ’¤&gt;40%? â†’ è¿½è¸ªæ­¢ç›ˆ
       â”œâ”€ TS â‰¥ 30? â†’ é¡¶éƒ¨ä¿¡å·å¹³ä»“
       â”œâ”€ PnL â‰¤ -20%? â†’ ç¡¬æ­¢æŸ
       â””â”€ æŒä»“ â‰¥ 48h? â†’ è¶…æ—¶å¹³ä»“</pre>
                        </div>
                    </div>
                </div>

                <div class="card" id="s15m-conclusion"></div>
            </div>
        </div>

        <!-- ====== å‡çº¿æŠ€æœ¯åˆ†æ ====== -->
        <div class="page" id="ma-strategy">
            <div class="page-title">å‡çº¿æŠ€æœ¯åˆ†æ</div>
            <div class="page-subtitle">ã€Šå‡çº¿æŠ€æœ¯åˆ†æã€‹é‚±ç«‹æ³¢è‘— Â· è‘›å—ç»´å…«å¤§æ³•åˆ™ + å‡çº¿æ’åˆ— + 17ç§ç‰¹æ®Šå½¢æ€ Â· ETH/USDTå›æµ‹</div>

            <div id="ma-loading" class="loading">
                <div class="spinner"></div>
                æ­£åœ¨åŠ è½½å‡çº¿ç­–ç•¥æ•°æ®...
            </div>

            <div id="ma-content" style="display:none;">
                <!-- ä¹¦ç±å¤§çº² -->
                <div class="card" id="ma-outline">
                    <div class="card-title">ä¹¦ç±å¤§çº²
                        <span class="badge" style="background:rgba(59,130,246,0.15);color:#3b82f6;">4ç«  Â· 364é¡µ</span>
                    </div>
                    <div id="ma-outline-content"></div>
                </div>

                <!-- ä¿¡å·ç»Ÿè®¡ -->
                <div class="card" id="ma-signal-stats">
                    <div class="card-title">ä¿¡å·ç»Ÿè®¡
                        <span class="badge" style="background:rgba(168,85,247,0.15);color:#a855f7;">SIGNAL ANALYSIS</span>
                    </div>
                    <div id="ma-signal-content"></div>
                </div>

                <!-- ç­–ç•¥å¡ç‰‡ -->
                <div class="card">
                    <div class="card-title" id="ma-strat-title">8ç§å‡çº¿ç­–ç•¥å¯¹æ¯”</div>
                    <div style="background:rgba(59,130,246,0.06);border-radius:8px;padding:14px 18px;margin-bottom:16px;border-left:3px solid #3b82f6;">
                        <div style="font-weight:600;color:#3b82f6;margin-bottom:6px;">ç­–ç•¥è¯´æ˜</div>
                        <div style="font-size:13px;color:var(--text-secondary);line-height:1.7;" id="ma-desc"></div>
                    </div>
                    <div style="display:grid;grid-template-columns:repeat(auto-fit,minmax(220px,1fr));gap:12px;margin-bottom:16px;" id="ma-cards"></div>
                </div>

                <!-- Alphaå¯¹æ¯”å›¾ -->
                <div class="card">
                    <div class="card-title">ç­–ç•¥Alphaå¯¹æ¯”</div>
                    <div id="ma-alpha-chart" style="height:300px;"></div>
                </div>

                <!-- ç­–ç•¥è¯¦æƒ…è¡¨æ ¼ -->
                <div class="card">
                    <div class="card-title">ç­–ç•¥è¯¦ç»†å¯¹æ¯”</div>
                    <div style="overflow-x:auto;">
                        <table class="data-table" id="ma-table">
                            <thead><tr>
                                <th>æ’å</th><th>ç­–ç•¥</th><th>Î±%</th>
                                <th>ç­–ç•¥æ”¶ç›Š</th><th>BHæ”¶ç›Š</th><th>æœ€å¤§å›æ’¤</th>
                                <th>äº¤æ˜“æ•°</th><th>å¼ºå¹³</th><th>æ€»è´¹ç”¨</th>
                            </tr></thead>
                            <tbody></tbody>
                        </table>
                    </div>
                </div>

                <!-- æœ€ä½³ç­–ç•¥äº¤æ˜“æ˜ç»† -->
                <div class="card">
                    <div class="card-title" id="ma-best-title">æœ€ä½³ç­–ç•¥äº¤æ˜“æ˜ç»†</div>
                    <div style="overflow-x:auto;">
                        <table class="data-table" id="ma-trades-table">
                            <thead><tr>
                                <th>æ—¶é—´</th><th>æ“ä½œ</th><th>æ–¹å‘</th>
                                <th>ä»·æ ¼</th><th>æ æ†</th><th>æ€»èµ„äº§</th><th>åŸå› </th>
                            </tr></thead>
                            <tbody></tbody>
                        </table>
                    </div>
                </div>

                <!-- ç»“è®º -->
                <div class="card" id="ma-conclusion"></div>
            </div>
        </div>

        <!-- ====== ç­–ç•¥ä¼˜åŒ–å¯¹æ¯” ====== -->
        <div class="page" id="strategy-compare">
            <div class="page-title">ç­–ç•¥ä¼˜åŒ–å¯¹æ¯”å®éªŒ</div>
            <div class="page-subtitle">6ç§ç­–ç•¥æ€è·¯ + 12ç§å‚æ•°å˜ä½“ Â· å¯»æ‰¾æœ€ä¼˜ç­–ç•¥é…ç½®</div>

            <div id="sc-loading" class="loading">
                <div class="spinner"></div>
                æ­£åœ¨åŠ è½½ç­–ç•¥å¯¹æ¯”æ•°æ®...
            </div>

            <div id="sc-content" style="display:none;">
                <!-- ç¬¬ä¸€éƒ¨åˆ†: 6å¤§ç­–ç•¥å¯¹æ¯” -->
                <div class="card">
                    <div class="card-title">6å¤§ç­–ç•¥æ€è·¯å¯¹æ¯” <span class="badge purple">Phase 1</span></div>
                    <div class="page-subtitle" style="margin-bottom:16px;">ç›¸åŒæ•°æ®ã€ç›¸åŒåˆå§‹èµ„é‡‘(10ä¸‡USDT+10ä¸‡ETH)ï¼Œæµ‹è¯•6ç§ä¸åŒç­–ç•¥é€»è¾‘</div>

                    <!-- ç­–ç•¥è¯´æ˜å¡ç‰‡ -->
                    <div style="display:grid;grid-template-columns:repeat(3,1fr);gap:12px;margin-bottom:20px;" id="sc-strategy-cards"></div>

                    <!-- è¶…é¢æ”¶ç›Šå¯¹æ¯”æŸ±çŠ¶å›¾ -->
                    <div id="sc-bar-chart" style="width:100%;min-height:320px;margin-bottom:20px;"></div>

                    <!-- å¯¹æ¯”è¡¨æ ¼ -->
                    <div class="trade-table-wrap" style="max-height:none;">
                        <table id="sc-table">
                            <thead><tr id="sc-table-head"></tr></thead>
                            <tbody id="sc-table-body"></tbody>
                        </table>
                    </div>
                </div>

                <!-- ç¬¬äºŒéƒ¨åˆ†: æœ€ä¼˜ç­–ç•¥å‚æ•°è°ƒä¼˜ -->
                <div class="card">
                    <div class="card-title">æœ€ä¼˜ç­–ç•¥å‚æ•°è°ƒä¼˜ <span class="badge green">Phase 2</span></div>
                    <div class="page-subtitle" style="margin-bottom:16px;">åŸºäºæœ€ä¼˜ç­–ç•¥(æ¸è¿›å‡ä»“)ï¼Œæµ‹è¯•12ç§å‚æ•°ç»„åˆå¯»æ‰¾æœ€ä¼˜é…ç½®</div>

                    <!-- ä¼˜åŒ–å˜ä½“æŸ±çŠ¶å›¾ -->
                    <div id="sc-opt-bar" style="width:100%;min-height:360px;margin-bottom:20px;"></div>

                    <!-- ä¼˜åŒ–å˜ä½“è¡¨æ ¼ -->
                    <div class="trade-table-wrap" style="max-height:none;">
                        <table id="sc-opt-table">
                            <thead><tr id="sc-opt-head"></tr></thead>
                            <tbody id="sc-opt-body"></tbody>
                        </table>
                    </div>
                </div>

                <!-- èµ„äº§æ›²çº¿å¯¹æ¯” -->
                <div class="card">
                    <div class="card-title">TOPç­–ç•¥èµ„äº§æ›²çº¿å¯¹æ¯”</div>
                    <div id="sc-equity-chart" style="width:100%;height:380px;"></div>
                </div>

                <!-- æœ€ç»ˆç»“è®º -->
                <div class="card" id="sc-conclusion"></div>

                <!-- ç¬¬ä¸‰éƒ¨åˆ†: æ·±åº¦æŒ‡æ ‡å¢å¼º -->
                <div id="se-section" style="display:none;">
                    <div class="card">
                        <div class="card-title">æ·±åº¦æŒ‡æ ‡å¢å¼ºç­–ç•¥ <span class="badge" style="background:rgba(255,77,106,0.15);color:var(--accent-red);">Phase 3 Â· å…¨æŒ‡æ ‡</span></div>
                        <div class="page-subtitle" style="margin-bottom:16px;">
                            å……åˆ†åˆ©ç”¨ä¹¦ä¸­ç¬¬äºŒ~äº”ç« çš„æ‰€æœ‰ç»†ç²’åº¦æŒ‡æ ‡ï¼šMACDé‡‘å‰æ­»å‰ã€KDJè¶…ä¹°è¶…å–ã€CCIå¤©åœ°çº¿ã€RSIæå€¼ã€é‡ä»·èƒŒç¦»ã€å‡ ä½•å½¢æ€
                        </div>

                        <!-- ç­–ç•¥è¯´æ˜ -->
                        <div style="display:grid;grid-template-columns:repeat(3,1fr);gap:12px;margin-bottom:20px;" id="se-strategy-cards"></div>

                        <!-- æŸ±çŠ¶å›¾ -->
                        <div id="se-bar-chart" style="width:100%;min-height:320px;margin-bottom:20px;"></div>

                        <!-- è¡¨æ ¼ -->
                        <div class="trade-table-wrap" style="max-height:none;">
                            <table id="se-table">
                                <thead><tr id="se-table-head"></tr></thead>
                                <tbody id="se-table-body"></tbody>
                            </table>
                        </div>
                    </div>

                    <!-- èµ„äº§æ›²çº¿å¯¹æ¯” -->
                    <div class="card">
                        <div class="card-title">å¢å¼ºç­–ç•¥èµ„äº§æ›²çº¿</div>
                        <div id="se-equity-chart" style="width:100%;height:380px;"></div>
                    </div>

                    <!-- æœ€ä½³ç­–ç•¥äº¤æ˜“æ˜ç»† -->
                    <div class="card">
                        <div class="card-title">æœ€ä½³ç­–ç•¥äº¤æ˜“æ˜ç»† <span class="badge green" id="se-trade-count"></span></div>
                        <div class="trade-table-wrap" style="max-height:500px;">
                            <table id="se-trades-table">
                                <thead>
                                    <tr>
                                        <th>#</th><th>æ—¶é—´</th><th>æ“ä½œ</th><th>ä»·æ ¼</th>
                                        <th>æ•°é‡</th><th>é‡‘é¢</th><th>æ‰‹ç»­è´¹</th>
                                        <th>USDTä½™é¢</th><th>ETHæŒä»“</th><th>æ€»èµ„äº§</th><th>åŸå› </th>
                                    </tr>
                                </thead>
                                <tbody id="se-trades-body"></tbody>
                            </table>
                        </div>
                    </div>

                    <!-- ç»ˆæç»“è®º -->
                    <div class="card" id="se-conclusion"></div>
                </div>
            </div>
        </div>

        <!-- ====== åŒä¹¦èåˆç­–ç•¥ ====== -->
        <div class="page" id="combined-strategy">
            <div class="page-title">åŒä¹¦èåˆç­–ç•¥</div>
            <div class="page-subtitle">ã€ŠèƒŒç¦»æŠ€æœ¯åˆ†æã€‹Ã— ã€Šå‡çº¿æŠ€æœ¯åˆ†æã€‹ Â· èƒŒç¦»æ‹ç‚¹ + å‡çº¿è¶‹åŠ¿ Â· ä¿¡å·å…±æŒ¯å‡å°‘å‡ä¿¡å·</div>

            <div id="cs-loading" class="loading">
                <div class="spinner"></div>
                <p>åŠ è½½èåˆç­–ç•¥æ•°æ®...</p>
            </div>

            <div id="cs-content" style="display:none">
                <!-- èåˆåŸç† -->
                <div class="card">
                    <div class="card-header">
                        <h3>èåˆåŸç†</h3>
                    </div>
                    <div style="padding:20px;line-height:1.8;color:var(--text-secondary)">
                        <div style="display:grid;grid-template-columns:1fr 1fr;gap:24px;margin-bottom:20px">
                            <div style="background:var(--bg-secondary);border-radius:12px;padding:20px;border-left:4px solid var(--accent-red)">
                                <div style="font-weight:700;color:var(--accent-red);margin-bottom:8px">ã€ŠèƒŒç¦»æŠ€æœ¯åˆ†æã€‹â€” æ•æ‰æ‹ç‚¹</div>
                                <div style="font-size:13px">MACDéš”å †èƒŒç¦»ã€é¢ç§¯èƒŒç¦»ã€DIFèƒŒç¦»ã€èƒŒé©°ã€KDJ/CCI/RSIæå€¼ã€é‡ä»·åˆ†æ</div>
                                <div style="font-size:12px;color:var(--text-muted);margin-top:6px">æ ¸å¿ƒèƒ½åŠ›: æ£€æµ‹ä»·æ ¼ä¸æŒ‡æ ‡çš„ä¸ä¸€è‡´, é¢„åˆ¤åè½¬</div>
                            </div>
                            <div style="background:var(--bg-secondary);border-radius:12px;padding:20px;border-left:4px solid var(--accent-blue)">
                                <div style="font-weight:700;color:var(--accent-blue);margin-bottom:8px">ã€Šå‡çº¿æŠ€æœ¯åˆ†æã€‹â€” ç¡®è®¤è¶‹åŠ¿</div>
                                <div style="font-size:13px">è‘›å—ç»´å…«å¤§æ³•åˆ™ã€é‡‘å‰æ­»å‰ã€å¤šç©ºæ’åˆ—ã€é“¶å±±è°·/é‡‘å±±è°·/æ­»äº¡è°·ã€å‡çº¿ç²˜åˆçªç ´</div>
                                <div style="font-size:12px;color:var(--text-muted);margin-top:6px">æ ¸å¿ƒèƒ½åŠ›: ç¡®è®¤è¶‹åŠ¿æ–¹å‘å’Œå¼ºåº¦, è¿‡æ»¤å™ªéŸ³</div>
                            </div>
                        </div>
                        <div style="background:var(--bg-secondary);border-radius:12px;padding:20px;border-left:4px solid var(--accent-purple)">
                            <div style="font-weight:700;color:var(--accent-purple);margin-bottom:8px">èåˆé€»è¾‘ â€” ä¸¤ç§æŠ€æœ¯äº’è¡¥</div>
                            <div style="font-size:13px">
                                <b>åŠ æƒèåˆ:</b> ä¸¤ç³»ç»Ÿä¿¡å·æŒ‰æƒé‡å åŠ  Â· <b>å…±æŒ¯ç¡®è®¤:</b> ä¸¤ç³»ç»ŸåŒæ—¶è§¦å‘æ‰äº¤æ˜“(é«˜ç¡®ä¿¡åº¦) Â· 
                                <b>å‡çº¿è¿‡æ»¤èƒŒç¦»:</b> èƒŒç¦»äº§ç”Ÿä¿¡å·, å‡çº¿ç¡®è®¤æ–¹å‘ Â· <b>èƒŒç¦»è¿‡æ»¤å‡çº¿:</b> å‡çº¿äº§ç”Ÿä¿¡å·, èƒŒç¦»ç¡®è®¤æ‹ç‚¹
                            </div>
                        </div>
                    </div>
                </div>

                <!-- ä¿¡å·ç»Ÿè®¡ -->
                <div class="card">
                    <div class="card-header">
                        <h3>ä¿¡å·ç»Ÿè®¡</h3>
                    </div>
                    <div id="cs-signal-stats" style="padding:20px;display:grid;grid-template-columns:repeat(4,1fr);gap:16px"></div>
                </div>

                <!-- ç­–ç•¥å¡ç‰‡ -->
                <div class="card">
                    <div class="card-header">
                        <h3>8ç§èåˆç­–ç•¥å¯¹æ¯”</h3>
                    </div>
                    <div id="cs-strategy-cards" style="padding:20px;display:grid;grid-template-columns:repeat(4,1fr);gap:16px"></div>
                </div>

                <!-- Alphaå¯¹æ¯”æŸ±çŠ¶å›¾ -->
                <div class="card">
                    <div class="card-header">
                        <h3>Alphaå¯¹æ¯”</h3>
                    </div>
                    <div id="cs-alpha-chart" style="padding:20px;height:280px;display:flex;align-items:flex-end;gap:12px;justify-content:center"></div>
                </div>

                <!-- æ’åè¡¨æ ¼ -->
                <div class="card">
                    <div class="card-header">
                        <h3>ç­–ç•¥æ’å</h3>
                    </div>
                    <div style="padding:0;overflow-x:auto">
                        <table class="data-table">
                            <thead>
                                <tr>
                                    <th>#</th><th>ç­–ç•¥</th><th>èåˆæ¨¡å¼</th>
                                    <th>Alpha</th><th>ç­–ç•¥æ”¶ç›Š</th><th>ä¹°æŒæ”¶ç›Š</th>
                                    <th>æœ€å¤§å›æ’¤</th><th>äº¤æ˜“æ¬¡æ•°</th><th>å¼ºå¹³</th>
                                    <th>æ€»è´¹ç”¨</th><th>æœ€ç»ˆèµ„äº§</th>
                                </tr>
                            </thead>
                            <tbody id="cs-ranking-body"></tbody>
                        </table>
                    </div>
                </div>

                <!-- æœ€ä½³ç­–ç•¥è¯¦æƒ… -->
                <div class="card">
                    <div class="card-header">
                        <h3 id="cs-best-title">æœ€ä½³ç­–ç•¥äº¤æ˜“è®°å½•</h3>
                    </div>
                    <div style="padding:0;overflow-x:auto">
                        <table class="data-table" style="font-size:12px">
                            <thead>
                                <tr>
                                    <th>æ—¶é—´</th><th>æ“ä½œ</th><th>ä»·æ ¼</th>
                                    <th>æ æ†</th><th>æ€»èµ„äº§</th><th>åŸå› </th>
                                </tr>
                            </thead>
                            <tbody id="cs-trades-body"></tbody>
                        </table>
                    </div>
                </div>

                <!-- è·¨ç­–ç•¥å¯¹æ¯” -->
                <div class="card">
                    <div class="card-header">
                        <h3>è·¨ç­–ç•¥å¯¹æ¯”: èåˆ vs å•ç‹¬</h3>
                    </div>
                    <div id="cs-cross-compare" style="padding:20px"></div>
                </div>

                <!-- ç»“è®º -->
                <div class="card" id="cs-conclusion"></div>
            </div>
        </div>

        <!-- ====== å¤šå‘¨æœŸå¯¹æ¯” ====== -->
        <div class="page" id="multi-compare">
            <div class="page-title">12å‘¨æœŸå›æµ‹å¯¹æ¯”</div>
            <div class="page-subtitle">ETH/USDT Â· 10åˆ†é’Ÿ ~ 32å°æ—¶ Â· èƒŒç¦»/èƒŒé©°ç­–ç•¥åœ¨ä¸åŒæ—¶é—´æ¡†æ¶ä¸‹çš„è¡¨ç°</div>

            <div id="multi-loading" class="loading">
                <div class="spinner"></div>
                æ­£åœ¨åŠ è½½å¤šå‘¨æœŸå›æµ‹æ•°æ®...
            </div>

            <div id="multi-content" style="display:none;">
                <!-- è¶…é¢æ”¶ç›ŠæŸ±çŠ¶å›¾ -->
                <div class="card">
                    <div class="card-title">è¶…é¢æ”¶ç›Šå¯¹æ¯” <span class="badge green">ç­–ç•¥æ”¶ç›Š - ä¹°å…¥æŒæœ‰æ”¶ç›Š</span></div>
                    <div id="alpha-bar-chart" style="width:100%;height:320px;"></div>
                </div>

                <!-- æ ¸å¿ƒæŒ‡æ ‡å¯¹æ¯”è¡¨ -->
                <div class="card">
                    <div class="card-title">æ ¸å¿ƒæŒ‡æ ‡å¯¹æ¯”è¡¨</div>
                    <div class="trade-table-wrap" style="max-height:none;">
                        <table id="multi-table">
                            <thead><tr id="multi-table-head"></tr></thead>
                            <tbody id="multi-table-body"></tbody>
                        </table>
                    </div>
                </div>

                <!-- èµ„äº§æ›²çº¿å åŠ å›¾ -->
                <div class="card">
                    <div class="card-title">èµ„äº§æ›²çº¿å åŠ  <span class="badge">ç‚¹å‡»å›¾ä¾‹åˆ‡æ¢æ˜¾ç¤º</span></div>
                    <div id="multi-equity-chart" style="width:100%;height:380px;"></div>
                </div>

                <!-- ç»“è®º -->
                <div class="card" id="multi-conclusion"></div>
            </div>
        </div>

        <!-- ====== å›æµ‹æ‘˜è¦ ====== -->
        <div class="page" id="backtest-summary">
            <div class="page-title">ETH/USDT å›æµ‹æ‘˜è¦</div>
            <div class="page-subtitle">10åˆ†é’ŸKçº¿ Â· å¸å®‰ç°è´§ Â· èƒŒç¦»/èƒŒé©°ç­–ç•¥</div>

            <div id="summary-loading" class="loading">
                <div class="spinner"></div>
                æ­£åœ¨åŠ è½½å›æµ‹æ•°æ®...
            </div>

            <div id="summary-content" style="display:none;">
                <div class="stats-grid" id="stats-grid"></div>

                <div class="card">
                    <div class="card-title">ç­–ç•¥è¯´æ˜</div>
                    <div class="principle-grid">
                        <div class="principle-card sell">
                            <h3>å–å‡ºä¿¡å·</h3>
                            <p>
                                â€¢ ç»¼åˆé¡¶èƒŒç¦»è¯„åˆ† â‰¥ 45<br>
                                â€¢ èƒŒé©°å–å‡ºä¿¡å· (æœ€é«˜ä¼˜å…ˆçº§)<br>
                                â€¢ æ­¢æŸ: -5% / æ­¢ç›ˆ: +8%<br>
                                â€¢ éµå¾ª "å–ç‚¹ç”¨èƒŒç¦», å®æ—©å‹¿æ™š"
                            </p>
                        </div>
                        <div class="principle-card buy">
                            <h3>ä¹°å…¥ä¿¡å·</h3>
                            <p>
                                â€¢ ç»¼åˆåº•èƒŒç¦»è¯„åˆ† â‰¥ 65<br>
                                â€¢ èƒŒé©°ä¹°å…¥ä¿¡å· (æœ€é«˜ä¼˜å…ˆçº§)<br>
                                â€¢ å†·å´æœŸ: 30æ ¹Kçº¿ (5å°æ—¶)<br>
                                â€¢ éµå¾ª "ä¹°ç‚¹ç”¨èƒŒé©°, å®è¿Ÿå‹¿æ—©"
                            </p>
                        </div>
                    </div>
                </div>

                <div class="chart-container">
                    <div class="chart-toolbar">
                        <h3>èµ„äº§æ›²çº¿</h3>
                        <span style="font-size:12px;color:var(--text-muted);">è“çº¿=ç­–ç•¥å‡€å€¼ | åŸºå‡†=ETHä¹°å…¥æŒæœ‰</span>
                    </div>
                    <div id="equity-chart"></div>
                </div>
            </div>
        </div>

        <!-- ====== Kçº¿å›¾ ====== -->
        <div class="page" id="backtest-chart">
            <div class="page-title">Kçº¿å›¾ä¸äº¤æ˜“ä¿¡å·</div>
            <div class="page-subtitle">ETH/USDT 10åˆ†é’ŸKçº¿ Â· ä¹°å–ç‚¹æ ‡æ³¨</div>

            <div id="chart-loading" class="loading">
                <div class="spinner"></div>
                æ­£åœ¨åŠ è½½å›¾è¡¨æ•°æ®...
            </div>

            <div id="chart-content" style="display:none;">
                <div class="chart-container">
                    <div class="chart-toolbar">
                        <h3>ETH/USDT Â· 10åˆ†é’Ÿ</h3>
                    </div>
                    <div id="kline-chart"></div>
                </div>
            </div>
        </div>

        <!-- ====== äº¤æ˜“æ˜ç»† ====== -->
        <div class="page" id="backtest-trades">
            <div class="page-title">äº¤æ˜“æ˜ç»†</div>
            <div class="page-subtitle">å®Œæ•´äº¤æ˜“è®°å½• (ä¹°å…¥-å–å‡ºé…å¯¹)</div>

            <div id="trades-loading" class="loading">
                <div class="spinner"></div>
                æ­£åœ¨åŠ è½½äº¤æ˜“æ•°æ®...
            </div>

            <div id="trades-content" style="display:none;">
                <div class="stats-grid" id="trade-stats"></div>
                <div class="card">
                    <div class="card-title">äº¤æ˜“è®°å½•</div>
                    <div class="trade-table-wrap">
                        <table id="trades-table">
                            <thead>
                                <tr>
                                    <th>#</th>
                                    <th>ä¹°å…¥æ—¶é—´</th>
                                    <th>ä¹°å…¥ä»·</th>
                                    <th>å–å‡ºæ—¶é—´</th>
                                    <th>å–å‡ºä»·</th>
                                    <th>ç›ˆäº(USDT)</th>
                                    <th>ç›ˆäº%</th>
                                    <th>ä¹°å…¥åŸå› </th>
                                    <th>å–å‡ºåŸå› </th>
                                </tr>
                            </thead>
                            <tbody></tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>

    </div>

    <script>
    // ===== Constants =====
    const INTERVALS = ['10m','15m','30m','1h','2h','3h','4h','6h','8h','16h','24h','32h'];
    const INTERVAL_LABELS = {'10m':'10åˆ†é’Ÿ','15m':'15åˆ†é’Ÿ','30m':'30åˆ†é’Ÿ','1h':'1å°æ—¶','2h':'2å°æ—¶','3h':'3å°æ—¶','4h':'4å°æ—¶','6h':'6å°æ—¶','8h':'8å°æ—¶','16h':'16å°æ—¶','24h':'24å°æ—¶','32h':'32å°æ—¶'};
    const COLORS = ['#4a9eff','#ff4d6a','#00d68f','#ffaa00','#a855f7','#06b6d4','#f43f5e','#84cc16','#ec4899','#f97316','#8b5cf6','#14b8a6'];

    // ===== Navigation =====
    document.querySelectorAll('.nav-item').forEach(item => {
        item.addEventListener('click', () => {
            document.querySelectorAll('.nav-item').forEach(i => i.classList.remove('active'));
            document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
            item.classList.add('active');
            const pageId = item.dataset.page;
            document.getElementById(pageId).classList.add('active');

            if (pageId === 'global-strategy' && !window._gsLoaded) loadGlobalStrategy();
                if (pageId === 'strategy-compare' && !window._scLoaded) loadStrategyCompare();
                if (pageId === 'strategy-futures' && !window._ftLoaded) loadFuturesStrategy();
                if (pageId === 'ma-strategy' && !window._maLoaded) loadMAStrategy();
                if (pageId === 'combined-strategy' && !window._csLoaded) loadCombinedStrategy();
                if (pageId === 'multi-compare' && !window._multiLoaded) loadMultiData();
                if (pageId.startsWith('backtest') && !window._backtestLoaded) loadBacktestData();
        });
    });

    // ========================================
    //   Global Strategy
    // ========================================
    let gsData = null;

    async function loadGlobalStrategy() {
        if (window._gsLoaded) return;
        try {
            const resp = await fetch('/api/global_strategy');
            if (!resp.ok) throw new Error('No data');
            gsData = await resp.json();
            window._gsLoaded = true;
            renderGS();
            document.getElementById('gs-loading').style.display = 'none';
            document.getElementById('gs-content').style.display = 'block';
        } catch (e) {
            document.getElementById('gs-loading').innerHTML =
                '<span style="color:var(--accent-red)">æœªæ‰¾åˆ°å…¨å±€ç­–ç•¥æ•°æ®ã€‚è¯·å…ˆè¿è¡Œ: python global_strategy.py</span>';
        }
    }

    function renderGS() {
        const s = gsData.summary;
        const trades = gsData.trades || [];

        // Stats
        document.getElementById('gs-stats').innerHTML = [
            {label:'åˆå§‹æ€»èµ„äº§', value:'$'+s.initial_total.toLocaleString(), cls:''},
            {label:'æœ€ç»ˆæ€»èµ„äº§', value:'$'+s.final_total.toLocaleString(), cls: s.final_total >= s.initial_total ? 'positive' : 'negative'},
            {label:'ç­–ç•¥æ”¶ç›Š', value: s.strategy_return+'%', cls: s.strategy_return >= 0 ? 'positive' : 'negative'},
            {label:'ä¹°å…¥æŒæœ‰æ”¶ç›Š', value: s.buy_hold_return+'%', cls: s.buy_hold_return >= 0 ? 'positive' : 'negative'},
            {label:'è¶…é¢æ”¶ç›Š', value: (s.alpha >= 0 ? '+' : '') + s.alpha + '%', cls: s.alpha >= 0 ? 'positive' : 'negative'},
            {label:'æœ€å¤§å›æ’¤', value: s.max_drawdown+'%', cls:'negative'},
            {label:'ETHä»·æ ¼å˜åŒ–', value: s.eth_price_change+'%', cls: s.eth_price_change >= 0 ? 'positive' : 'negative'},
            {label:'ä¹°å…¥/å–å‡ºæ¬¡æ•°', value: s.total_buy_trades + 'ä¹° / ' + s.total_sell_trades + 'å–', cls:''},
            {label:'æœ€ç»ˆUSDT', value: '$'+s.final_usdt.toLocaleString(), cls:''},
            {label:'æœ€ç»ˆETHæŒä»“', value: s.final_eth_qty + ' ETH', cls:'', note: '$' + s.final_eth_value.toLocaleString()},
        ].map(item => `
            <div class="stat-card">
                <div class="stat-label">${item.label}</div>
                <div class="stat-value ${item.cls}" style="font-size:${item.value.length > 12 ? '18' : '24'}px;">${item.value}</div>
                ${item.note ? '<div class="stat-note">' + item.note + '</div>' : ''}
            </div>
        `).join('');

        // Weights
        const weights = gsData.tf_weights || {};
        document.getElementById('gs-weights').innerHTML = Object.entries(weights)
            .sort((a,b) => b[1] - a[1])
            .map(([tf, w]) => {
                const pct = Math.round(w * 100);
                const hue = pct > 70 ? 142 : pct > 50 ? 45 : 220;
                return `<div style="padding:6px 12px;border-radius:8px;border:1px solid var(--border);font-size:12px;">
                    <strong>${INTERVAL_LABELS[tf] || tf}</strong>
                    <span style="color:hsl(${hue},70%,60%);margin-left:4px;">${pct}%</span>
                    <div style="height:3px;margin-top:4px;border-radius:2px;background:var(--border);width:80px;">
                        <div style="height:100%;width:${pct}%;background:hsl(${hue},70%,60%);border-radius:2px;"></div>
                    </div>
                </div>`;
            }).join('');

        // Trade count badge
        document.getElementById('gs-trade-count').textContent = trades.length + 'ç¬”äº¤æ˜“';

        // Equity chart
        renderGSEquity();

        // Ratio chart
        renderGSRatio();

        // Trades table
        renderGSTrades();
    }

    function renderGSEquity() {
        const container = document.getElementById('gs-equity-chart');
        const ph = gsData.portfolio_history || [];
        if (!ph.length) return;

        const chart = LightweightCharts.createChart(container, {
            width: container.clientWidth, height: 350,
            layout: { background: { color: '#1e2130' }, textColor: '#8b8fa3' },
            grid: { vertLines: { color: '#2a2d3e' }, horzLines: { color: '#2a2d3e' } },
            crosshair: { mode: 0 },
            timeScale: { timeVisible: true, secondsVisible: false },
        });

        // Strategy total
        const stLine = chart.addLineSeries({ color: '#4a9eff', lineWidth: 2, title: 'ç­–ç•¥æ€»èµ„äº§' });
        stLine.setData(ph.map(p => ({
            time: Math.floor(new Date(p.time).getTime() / 1000),
            value: p.total,
        })));

        // Buy & hold baseline
        const initTotal = gsData.summary.initial_total;
        const firstEthP = ph[0].eth_price;
        const bhLine = chart.addLineSeries({ color: '#5c6078', lineWidth: 1, lineStyle: 2, title: 'ä¹°å…¥æŒæœ‰' });
        bhLine.setData(ph.map(p => ({
            time: Math.floor(new Date(p.time).getTime() / 1000),
            value: 100000 + (100000 / firstEthP) * p.eth_price,
        })));

        // Buy/sell markers on equity
        const markers = (gsData.trades || []).map(t => ({
            time: Math.floor(new Date(t.time).getTime() / 1000),
            position: t.action === 'BUY' ? 'belowBar' : 'aboveBar',
            color: t.action === 'BUY' ? '#00d68f' : '#ff4d6a',
            shape: t.action === 'BUY' ? 'arrowUp' : 'arrowDown',
            text: t.action === 'BUY' ? 'B' : 'S',
        }));
        stLine.setMarkers(markers);

        chart.timeScale().fitContent();
        new ResizeObserver(() => chart.applyOptions({ width: container.clientWidth })).observe(container);
    }

    function renderGSRatio() {
        const container = document.getElementById('gs-ratio-chart');
        const ph = gsData.portfolio_history || [];
        if (!ph.length) return;

        const chart = LightweightCharts.createChart(container, {
            width: container.clientWidth, height: 200,
            layout: { background: { color: '#1e2130' }, textColor: '#8b8fa3' },
            grid: { vertLines: { color: '#2a2d3e' }, horzLines: { color: '#2a2d3e' } },
            crosshair: { mode: 0 },
            timeScale: { timeVisible: true, secondsVisible: false },
            rightPriceScale: { autoScale: true },
        });

        const areaS = chart.addAreaSeries({
            topColor: 'rgba(74,158,255,0.3)',
            bottomColor: 'rgba(74,158,255,0.02)',
            lineColor: '#4a9eff',
            lineWidth: 1,
            title: 'ETHä»“ä½%',
        });
        areaS.setData(ph.map(p => ({
            time: Math.floor(new Date(p.time).getTime() / 1000),
            value: p.eth_ratio,
        })));

        chart.timeScale().fitContent();
        new ResizeObserver(() => chart.applyOptions({ width: container.clientWidth })).observe(container);
    }

    function renderGSTrades() {
        const trades = gsData.trades || [];
        const tbody = document.getElementById('gs-trades-body');

        tbody.innerHTML = trades.map((t, i) => {
            const isBuy = t.action === 'BUY';
            const actionCls = isBuy ? 'pnl-pos' : 'pnl-neg';
            const typeBg = t.type === 'æ­¢æŸå‡ä»“' ? 'background:rgba(255,77,106,0.08);' : '';
            const dt = new Date(t.time);
            const timeStr = `${dt.getMonth()+1}/${dt.getDate()} ${String(dt.getHours()).padStart(2,'0')}:${String(dt.getMinutes()).padStart(2,'0')}`;

            return `<tr style="${typeBg}">
                <td>${i+1}</td>
                <td style="white-space:nowrap;">${timeStr}</td>
                <td class="${actionCls}" style="font-weight:700;">${t.action}</td>
                <td>${t.type}</td>
                <td>$${t.price.toLocaleString()}</td>
                <td>${t.quantity.toFixed(4)}</td>
                <td>$${t.value.toLocaleString()}</td>
                <td>$${t.fee.toFixed(2)}</td>
                <td>$${t.usdt_after.toLocaleString()}</td>
                <td>${t.eth_after.toFixed(4)}</td>
                <td>$${t.total_assets.toLocaleString()}</td>
                <td style="max-width:140px;overflow:hidden;text-overflow:ellipsis;white-space:nowrap;" title="${t.reason}">${t.reason}</td>
                <td style="max-width:200px;overflow:hidden;text-overflow:ellipsis;white-space:nowrap;font-size:11px;color:var(--text-muted);" title="${t.signal_tf||''}">${t.signal_tf||'â€”'}</td>
            </tr>`;
        }).join('');
    }

    // ========================================
    //   Strategy Compare & Optimize
    // ========================================
    let scData = null;
    let scOptData = null;

    async function loadStrategyCompare() {
        if (window._scLoaded) return;
        try {
            const [r1, r2] = await Promise.all([
                fetch('/api/strategy_compare'),
                fetch('/api/strategy_optimize'),
            ]);
            if (!r1.ok || !r2.ok) throw new Error('No data');
            scData = await r1.json();
            scOptData = await r2.json();
            window._scLoaded = true;
            renderSCPage();
            document.getElementById('sc-loading').style.display = 'none';
            document.getElementById('sc-content').style.display = 'block';
            // Also load enhanced strategies
            loadEnhancedStrategy();
        } catch (e) {
            document.getElementById('sc-loading').innerHTML =
                '<span style="color:var(--accent-red)">æœªæ‰¾åˆ°ç­–ç•¥å¯¹æ¯”æ•°æ®ã€‚è¯·å…ˆè¿è¡Œ python strategy_compare.py && python strategy_optimize.py</span>';
        }
    }

    function renderSCPage() {
        renderSCCards();
        renderSCBarChart();
        renderSCTable();
        renderSCOptBar();
        renderSCOptTable();
        renderSCEquity();
        renderSCConclusion();
    }

    function renderSCCards() {
        const strategies = scData.strategies || [];
        const descriptions = {
            'A: å¤šå‘¨æœŸèåˆ (baseline)': { icon: 'ğŸ”€', desc: 'å¤šå‘¨æœŸä¿¡å·åŠ æƒèåˆï¼Œç»¼åˆå¤šä¸ªæ—¶é—´æ¡†æ¶çš„èƒŒç¦»/èƒŒé©°ä¿¡å·åšå†³ç­–', color: '#4a9eff' },
            'B: 4hä¸“æ³¨ç­–ç•¥': { icon: 'ğŸ¯', desc: 'åªä½¿ç”¨4hå‘¨æœŸä¿¡å·ï¼Œæœ€ä¼˜å•å‘¨æœŸä¸“æ³¨æ“ä½œï¼Œé«˜é˜ˆå€¼+é•¿å†·å´æœŸ', color: '#a855f7' },
            'C: è¶‹åŠ¿è·Ÿéšé˜²å¾¡': { icon: 'ğŸ“‰', desc: 'MA50åˆ¤æ–­è¶‹åŠ¿æ–¹å‘ï¼Œä¸‹è·Œåªå–ä¸ä¹°ï¼Œä¸Šæ¶¨è¶‹åŠ¿ä¸­æ‰è€ƒè™‘ä¹°å…¥', color: '#f97316' },
            'D: ä¿å®ˆé«˜é˜ˆå€¼': { icon: 'ğŸ›¡ï¸', desc: 'æé«˜ä¿¡å·é˜ˆå€¼(å…±æŒ¯å¾—åˆ†â‰¥55/60)ï¼Œ36å°æ—¶å†·å´æœŸï¼Œåªåšç¡®å®šæ€§æœ€é«˜çš„äº¤æ˜“', color: '#06b6d4' },
            'E: æ¸è¿›å‡ä»“': { icon: 'â¬‡ï¸', desc: 'æ ¹æ®èƒŒç¦»å¼ºåº¦é€æ­¥å–å‡ºETHï¼Œä¿ç•™10%åº•ä»“ï¼Œåªåœ¨å¼ºèƒŒé©°ä¿¡å·ä¹°å›', color: '#00d68f' },
            'F: åŠ¨æ€å†å¹³è¡¡': { icon: 'âš–ï¸', desc: 'æ ¹æ®èƒŒç¦»ä¿¡å·åŠ¨æ€è°ƒæ•´ETHç›®æ ‡æ¯”ä¾‹(10%~70%)ï¼Œåå·®>8%æ—¶å†å¹³è¡¡', color: '#ffaa00' },
        };

        const container = document.getElementById('sc-strategy-cards');
        container.innerHTML = strategies.map(s => {
            const d = descriptions[s.name] || { icon: 'ğŸ“Š', desc: '', color: '#4a9eff' };
            const alpha = s.summary.alpha;
            const alphaColor = alpha >= 0 ? 'var(--accent-green)' : 'var(--accent-red)';
            return `<div style="padding:16px;border-radius:10px;border:1px solid var(--border);border-top:3px solid ${d.color};">
                <div style="font-size:20px;margin-bottom:8px;">${d.icon}</div>
                <div style="font-weight:600;font-size:14px;margin-bottom:6px;">${s.name}</div>
                <div style="font-size:12px;color:var(--text-secondary);line-height:1.5;margin-bottom:10px;">${d.desc}</div>
                <div style="display:flex;justify-content:space-between;align-items:center;">
                    <span style="font-size:12px;color:var(--text-muted);">${s.summary.total_trades}ç¬”äº¤æ˜“</span>
                    <span style="font-size:16px;font-weight:700;color:${alphaColor};">${alpha >= 0 ? '+' : ''}${alpha.toFixed(2)}%</span>
                </div>
            </div>`;
        }).join('');
    }

    function renderSCBarChart() {
        const strategies = (scData.strategies || []).sort((a, b) => b.summary.alpha - a.summary.alpha);
        const container = document.getElementById('sc-bar-chart');
        const maxAbs = Math.max(...strategies.map(s => Math.abs(s.summary.alpha)), 1);
        const barColors = ['#00d68f', '#06b6d4', '#ffaa00', '#a855f7', '#4a9eff', '#ff4d6a'];

        const barH = 220;
        let html = '<div style="position:relative;height:' + (barH + 60) + 'px;display:flex;align-items:center;">';
        html += '<div style="display:flex;flex-direction:column;justify-content:space-between;height:' + barH + 'px;padding-right:8px;font-size:11px;color:var(--text-muted);width:50px;text-align:right;">';
        html += '<span>+' + maxAbs.toFixed(0) + '%</span><span>0%</span><span>-' + maxAbs.toFixed(0) + '%</span></div>';
        html += '<div style="flex:1;display:flex;align-items:center;height:' + barH + 'px;position:relative;">';
        html += '<div style="position:absolute;top:50%;left:0;right:0;height:1px;background:var(--text-muted);opacity:0.3;"></div>';
        html += '<div style="display:flex;align-items:center;height:100%;width:100%;justify-content:space-around;">';

        strategies.forEach((s, i) => {
            const alpha = s.summary.alpha;
            const h = Math.abs(alpha / maxAbs) * (barH / 2 - 10);
            const isPos = alpha >= 0;
            const color = barColors[i % barColors.length];
            const valColor = isPos ? 'var(--accent-green)' : 'var(--accent-red)';
            const shortName = s.name.split(':')[1] || s.name;

            html += '<div style="display:flex;flex-direction:column;align-items:center;flex:1;max-width:130px;height:100%;justify-content:center;position:relative;">';
            if (isPos) {
                html += '<div style="display:flex;flex-direction:column;align-items:center;justify-content:flex-end;height:50%;">';
                html += '<span style="font-size:12px;font-weight:700;color:' + valColor + ';margin-bottom:3px;">' + (alpha >= 0 ? '+' : '') + alpha.toFixed(2) + '%</span>';
                html += '<div style="width:48px;height:' + h + 'px;background:' + color + ';border-radius:6px 6px 0 0;opacity:0.85;"></div>';
                html += '</div><div style="height:50%;"></div>';
            } else {
                html += '<div style="height:50%;"></div>';
                html += '<div style="display:flex;flex-direction:column;align-items:center;justify-content:flex-start;height:50%;">';
                html += '<div style="width:48px;height:' + h + 'px;background:' + color + ';border-radius:0 0 6px 6px;opacity:0.85;"></div>';
                html += '<span style="font-size:12px;font-weight:700;color:' + valColor + ';margin-top:3px;">' + alpha.toFixed(2) + '%</span>';
                html += '</div>';
            }
            html += '<div style="position:absolute;bottom:-28px;font-size:11px;color:var(--text-muted);white-space:nowrap;text-align:center;">' + shortName.trim() + '</div>';
            html += '</div>';
        });

        html += '</div></div></div>';
        container.innerHTML = html;
    }

    function renderSCTable() {
        const strategies = (scData.strategies || []).sort((a, b) => b.summary.alpha - a.summary.alpha);

        let headHtml = '<th style="text-align:left;">æ’å</th><th style="text-align:left;">ç­–ç•¥</th>';
        headHtml += '<th>ç­–ç•¥æ”¶ç›Š</th><th>ä¹°å…¥æŒæœ‰</th><th>è¶…é¢æ”¶ç›Š</th><th>æœ€å¤§å›æ’¤</th><th>äº¤æ˜“æ•°</th><th>æœ€ç»ˆèµ„äº§</th>';
        document.getElementById('sc-table-head').innerHTML = headHtml;

        const tbody = document.getElementById('sc-table-body');
        tbody.innerHTML = strategies.map((s, i) => {
            const sm = s.summary;
            const isBest = i === 0;
            const rowStyle = isBest ? 'background:rgba(0,214,143,0.05);' : '';
            const rankBadge = i < 3 ? `<span class="rank-badge rank-${i+1}">${i+1}</span>` : `<span style="padding:0 8px;color:var(--text-muted);">${i+1}</span>`;
            const alphaColor = sm.alpha >= 0 ? 'var(--accent-green)' : 'var(--accent-red)';
            const retColor = sm.strategy_return >= 0 ? 'var(--accent-green)' : 'var(--accent-red)';
            return `<tr style="${rowStyle}">
                <td>${rankBadge}</td>
                <td style="text-align:left;font-weight:${isBest?'700':'500'};">${s.name}${isBest?' â˜…':''}</td>
                <td style="color:${retColor};font-weight:600;">${sm.strategy_return >= 0 ? '+' : ''}${sm.strategy_return}%</td>
                <td style="color:var(--text-muted);">${sm.buy_hold_return}%</td>
                <td style="color:${alphaColor};font-weight:700;">${sm.alpha >= 0 ? '+' : ''}${sm.alpha}%</td>
                <td style="color:var(--accent-red);">${sm.max_drawdown}%</td>
                <td>${sm.total_trades}</td>
                <td style="font-weight:600;">$${sm.final_total.toLocaleString()}</td>
            </tr>`;
        }).join('');
    }

    function renderSCOptBar() {
        const results = (scOptData.optimization_results || []).sort((a, b) => b.summary.alpha - a.summary.alpha);
        const container = document.getElementById('sc-opt-bar');
        const maxAbs = Math.max(...results.map(r => Math.abs(r.summary.alpha)), 1);

        const barH = 260;
        let html = '<div style="position:relative;height:' + (barH + 70) + 'px;display:flex;align-items:center;">';
        html += '<div style="display:flex;flex-direction:column;justify-content:space-between;height:' + barH + 'px;padding-right:8px;font-size:11px;color:var(--text-muted);width:50px;text-align:right;">';
        html += '<span>+' + maxAbs.toFixed(0) + '%</span><span>0%</span><span>-' + maxAbs.toFixed(0) + '%</span></div>';
        html += '<div style="flex:1;display:flex;align-items:center;height:' + barH + 'px;position:relative;overflow-x:auto;">';
        html += '<div style="position:absolute;top:50%;left:0;right:0;height:1px;background:var(--text-muted);opacity:0.3;"></div>';
        html += '<div style="display:flex;align-items:center;height:100%;min-width:100%;justify-content:space-around;">';

        const optColors = results.map((r, i) => {
            const a = r.summary.alpha;
            if (a >= 8) return '#00d68f';
            if (a >= 5) return '#06b6d4';
            if (a >= 2) return '#4a9eff';
            if (a >= 0) return '#ffaa00';
            return '#ff4d6a';
        });

        results.forEach((r, i) => {
            const alpha = r.summary.alpha;
            const h = Math.abs(alpha / maxAbs) * (barH / 2 - 15);
            const isPos = alpha >= 0;
            const color = optColors[i];
            const valColor = isPos ? 'var(--accent-green)' : 'var(--accent-red)';
            const label = r.name.split(':')[0];

            html += '<div style="display:flex;flex-direction:column;align-items:center;flex:1;min-width:55px;max-width:80px;height:100%;justify-content:center;position:relative;">';
            if (isPos) {
                html += '<div style="display:flex;flex-direction:column;align-items:center;justify-content:flex-end;height:50%;">';
                html += '<span style="font-size:10px;font-weight:700;color:' + valColor + ';margin-bottom:2px;">' + (alpha >= 0 ? '+' : '') + alpha.toFixed(1) + '%</span>';
                html += '<div style="width:28px;height:' + h + 'px;background:' + color + ';border-radius:4px 4px 0 0;opacity:0.85;"></div>';
                html += '</div><div style="height:50%;"></div>';
            } else {
                html += '<div style="height:50%;"></div>';
                html += '<div style="display:flex;flex-direction:column;align-items:center;justify-content:flex-start;height:50%;">';
                html += '<div style="width:28px;height:' + h + 'px;background:' + color + ';border-radius:0 0 4px 4px;opacity:0.85;"></div>';
                html += '<span style="font-size:10px;font-weight:700;color:' + valColor + ';margin-top:2px;">' + alpha.toFixed(1) + '%</span>';
                html += '</div>';
            }
            html += '<div style="position:absolute;bottom:-34px;font-size:10px;color:var(--text-muted);white-space:nowrap;text-align:center;transform:rotate(-15deg);">' + label + '</div>';
            html += '</div>';
        });

        html += '</div></div></div>';
        container.innerHTML = html;
    }

    function renderSCOptTable() {
        const results = (scOptData.optimization_results || []).sort((a, b) => b.summary.alpha - a.summary.alpha);

        let headHtml = '<th style="text-align:left;">#</th><th style="text-align:left;">å˜ä½“</th>';
        headHtml += '<th>ç­–ç•¥æ”¶ç›Š</th><th>è¶…é¢æ”¶ç›Š</th><th>æœ€å¤§å›æ’¤</th><th>äº¤æ˜“æ•°</th><th>æœ€ç»ˆèµ„äº§</th>';
        document.getElementById('sc-opt-head').innerHTML = headHtml;

        const tbody = document.getElementById('sc-opt-body');
        tbody.innerHTML = results.map((r, i) => {
            const sm = r.summary;
            const isBest = i === 0;
            const rowStyle = isBest ? 'background:rgba(0,214,143,0.05);' : (i < 3 ? 'background:rgba(74,158,255,0.03);' : '');
            const alphaColor = sm.alpha >= 0 ? 'var(--accent-green)' : 'var(--accent-red)';
            const retColor = sm.strategy_return >= 0 ? 'var(--accent-green)' : 'var(--accent-red)';
            const medal = i === 0 ? ' ğŸ¥‡' : i === 1 ? ' ğŸ¥ˆ' : i === 2 ? ' ğŸ¥‰' : '';
            return `<tr style="${rowStyle}">
                <td style="font-weight:600;color:var(--text-muted);">${i+1}</td>
                <td style="text-align:left;font-weight:${isBest?'700':'400'};font-size:12px;">${r.name}${medal}</td>
                <td style="color:${retColor};">${sm.strategy_return >= 0 ? '+' : ''}${sm.strategy_return}%</td>
                <td style="color:${alphaColor};font-weight:700;">${sm.alpha >= 0 ? '+' : ''}${sm.alpha}%</td>
                <td style="color:var(--accent-red);">${sm.max_drawdown}%</td>
                <td>${sm.total_trades}</td>
                <td style="font-weight:500;">$${sm.final_total.toLocaleString()}</td>
            </tr>`;
        }).join('');
    }

    function renderSCEquity() {
        const container = document.getElementById('sc-equity-chart');

        const chart = LightweightCharts.createChart(container, {
            width: container.clientWidth, height: 380,
            layout: { background: { color: '#1e2130' }, textColor: '#8b8fa3' },
            grid: { vertLines: { color: '#2a2d3e' }, horzLines: { color: '#2a2d3e' } },
            crosshair: { mode: 0 },
            timeScale: { timeVisible: true, secondsVisible: false },
        });

        // Show top 6 optimization variants
        const results = (scOptData.optimization_results || []).sort((a, b) => b.summary.alpha - a.summary.alpha);
        const topN = results.slice(0, 6);
        const eqColors = ['#00d68f', '#06b6d4', '#4a9eff', '#ffaa00', '#a855f7', '#f43f5e'];

        topN.forEach((r, i) => {
            const hist = r.history || [];
            if (hist.length < 2) return;
            const line = chart.addLineSeries({
                color: eqColors[i],
                lineWidth: i === 0 ? 3 : 1,
                title: r.name.split(':')[0],
            });
            line.setData(hist.map(h => ({
                time: Math.floor(new Date(h.time).getTime() / 1000),
                value: h.total,
            })));
        });

        // Also show strategies from phase 1
        const strategies = (scData.strategies || []).sort((a, b) => b.summary.alpha - a.summary.alpha);
        if (strategies.length > 0) {
            const bestS = strategies[0];
            const hist = bestS.history || [];
            if (hist.length >= 2) {
                const line = chart.addLineSeries({
                    color: '#5c6078', lineWidth: 1, lineStyle: 2,
                    title: 'ä¹°å…¥æŒæœ‰(å‚è€ƒ)',
                });
                // Approximate buy-hold using first and last points
                const initT = bestS.summary.initial_total;
                const bhRet = bestS.summary.buy_hold_return / 100;
                const startV = initT;
                const endV = initT * (1 + bhRet);
                const startTime = Math.floor(new Date(hist[0].time).getTime() / 1000);
                const endTime = Math.floor(new Date(hist[hist.length-1].time).getTime() / 1000);
                line.setData(hist.map((h, idx) => {
                    const t = Math.floor(new Date(h.time).getTime() / 1000);
                    const progress = (t - startTime) / (endTime - startTime || 1);
                    return { time: t, value: startV + (endV - startV) * progress };
                }));
            }
        }

        chart.timeScale().fitContent();
        new ResizeObserver(() => chart.applyOptions({ width: container.clientWidth })).observe(container);
    }

    function renderSCConclusion() {
        const strategies = (scData.strategies || []).sort((a, b) => b.summary.alpha - a.summary.alpha);
        const optResults = (scOptData.optimization_results || []).sort((a, b) => b.summary.alpha - a.summary.alpha);

        const bestStrategy = strategies[0];
        const bestOpt = optResults[0];
        const worstOpt = optResults[optResults.length - 1];

        let html = '<div class="conclusion-title">ğŸ”¬ ç­–ç•¥ä¼˜åŒ–ç»“è®º</div>';
        html += '<div class="conclusion-grid">';

        // Finding 1: Best strategy type
        html += '<div class="conclusion-item" style="border-color:var(--accent-green);">';
        html += '<h4 style="color:var(--accent-green);">æœ€ä¼˜ç­–ç•¥æ€è·¯</h4>';
        html += '<p>';
        html += '<strong>' + bestStrategy.name + '</strong> ä»¥è¶…é¢æ”¶ç›Š <strong style="color:var(--accent-green);">' + (bestStrategy.summary.alpha >= 0 ? '+' : '') + bestStrategy.summary.alpha + '%</strong> é¢†å…ˆå…¶ä»–5ç§ç­–ç•¥ã€‚';
        html += '<br><br>';
        html += 'æ ¸å¿ƒé€»è¾‘: åœ¨ä¸‹è·Œè¶‹åŠ¿ä¸­<strong>é€æ­¥å‡ä»“</strong>è€Œéä¸€æ¬¡æ€§æ“ä½œï¼Œ';
        html += 'ä¿ç•™æœ€ä½åº•ä»“(10%)é˜²æ­¢è¸ç©ºï¼Œåªåœ¨å¼ºèƒŒé©°ä¿¡å·å‡ºç°æ—¶æ‰ä¹°å›ã€‚';
        html += '</p></div>';

        // Finding 2: Best optimized variant
        html += '<div class="conclusion-item" style="border-color:var(--accent-blue);">';
        html += '<h4 style="color:var(--accent-blue);">æœ€ä¼˜å‚æ•°é…ç½®</h4>';
        html += '<p>';
        html += '<strong>' + bestOpt.name + '</strong> è¿›ä¸€æ­¥å°†è¶…é¢æ”¶ç›Šæå‡è‡³ <strong style="color:var(--accent-green);">' + (bestOpt.summary.alpha >= 0 ? '+' : '') + bestOpt.summary.alpha + '%</strong>';
        html += 'ï¼Œæœ€å¤§å›æ’¤ <strong>' + bestOpt.summary.max_drawdown + '%</strong> (ä¼˜äºåŸºå‡†)ã€‚';
        html += '<br><br>';
        html += 'å…³é”®å‘ç°: åœ¨ä¸‹è·Œè¡Œæƒ…ä¸­ï¼Œ<strong>"åªå–ä¸ä¹°"</strong>ç­–ç•¥åè€Œè¡¨ç°æœ€å¥½â€”â€”å‡å°‘ä¸ç¡®å®šæ€§ä¹°å…¥ï¼Œè®©åˆ©æ¶¦è‡ªç„¶ç§¯ç´¯ã€‚';
        html += '</p></div>';

        // Finding 3: What doesn't work
        html += '<div class="conclusion-item" style="border-color:var(--accent-red);">';
        html += '<h4 style="color:var(--accent-red);">å¤±æ•ˆç­–ç•¥è­¦ç¤º</h4>';
        html += '<p>';
        const worst = strategies[strategies.length - 1];
        html += '<strong>' + worst.name + '</strong> è¡¨ç°æœ€å·®(è¶…é¢ ' + worst.summary.alpha + '%)ã€‚';
        html += '<br><br>';
        html += 'è¿‡äºé¢‘ç¹çš„å¤šå‘¨æœŸä¿¡å·èåˆåœ¨éœ‡è¡è¡Œæƒ…ä¸­äº§ç”Ÿå¤§é‡<strong>å‡ä¿¡å·</strong>ï¼Œå¯¼è‡´é¢‘ç¹äº¤æ˜“å’Œæ‰‹ç»­è´¹æŸè€—ã€‚';
        html += '<br>æé«˜å–å‡ºé˜ˆå€¼(â‰¥30)æˆ–è¿‡åº¦ä¾èµ–4hå•å‘¨æœŸåŒæ ·æ•ˆæœä¸ä½³ã€‚';
        html += '</p></div>';

        // Finding 4: Actionable insight
        html += '<div class="conclusion-item" style="border-color:var(--accent-yellow);">';
        html += '<h4 style="color:var(--accent-yellow);">å®æ“å»ºè®®</h4>';
        html += '<p>';
        html += 'ğŸ“Œ <strong>ç†Šå¸‚</strong>: æ¸è¿›å‡ä»“ç­–ç•¥(E)æœ€ä¼˜ï¼Œé™ä½æœ€ä½ä»“ä½è‡³5%ï¼Œå–å‡ºå†·å´æœŸ5h';
        html += '<br>ğŸ“Œ <strong>éœ‡è¡å¸‚</strong>: åŠ¨æ€å†å¹³è¡¡(F)æˆ–è¶‹åŠ¿è·Ÿéš(C)æ›´ç¨³å¥';
        html += '<br>ğŸ“Œ <strong>ç‰›å¸‚</strong>: éœ€åå‘ä¼˜åŒ–â€”â€”æ¸è¿›åŠ ä»“ã€é«˜é˜ˆå€¼æ‰å–å‡º';
        html += '<br><br>';
        html += '<span style="color:var(--text-muted);font-size:12px;">âš ï¸ ä»¥ä¸Šç»“è®ºåŸºäºæœ€è¿‘30å¤©ä¸‹è·Œè¡Œæƒ…ï¼Œä¸åŒå¸‚åœºç¯å¢ƒéœ€é‡æ–°éªŒè¯</span>';
        html += '</p></div>';

        html += '</div>';
        document.getElementById('sc-conclusion').innerHTML = html;
    }

    // ========================================
    //   Enhanced Strategy (Phase 3)
    // ========================================
    let seData = null;

    async function loadEnhancedStrategy() {
        try {
            const resp = await fetch('/api/strategy_enhanced');
            if (!resp.ok) return;
            seData = await resp.json();
            document.getElementById('se-section').style.display = 'block';
            renderSEPage();
        } catch (e) { /* silently fail if not available */ }
    }

    function renderSEPage() {
        renderSECards();
        renderSEBarChart();
        renderSETable();
        renderSEEquity();
        renderSETrades();
        renderSEConclusion();
    }

    function renderSECards() {
        const results = seData.enhanced_results || [];
        const descriptions = {
            'G: æŒ‡æ ‡å…±æŒ¯': { icon: 'ğŸ””', desc: 'KDJ/CCI/RSI/MACDå¤šæŒ‡æ ‡åŒæ—¶ç¡®è®¤(â‰¥3ä¸ª)æ‰æ“ä½œï¼Œå‡å°‘å‡ä¿¡å·', color: '#a855f7' },
            'H: MACDäº¤å‰æ‹©æ—¶': { icon: 'âœ‚ï¸', desc: 'æ­»å‰+èƒŒç¦»=å–å‡ºï¼Œé‡‘å‰+èƒŒé©°=ä¹°å…¥ï¼Œç”¨äº¤å‰åšç²¾ç¡®å…¥åœºæ—¶æœº', color: '#4a9eff' },
            'I: KDJ+RSIæå€¼': { icon: 'ğŸ“', desc: 'KDJ>75/RSI>65=è¶…ä¹°åŒºå–å‡ºï¼ŒKDJ<25/RSI<35=è¶…å–åŒºä¹°å…¥', color: '#06b6d4' },
            'J: é‡ä»·ç¡®è®¤': { icon: 'ğŸ“Š', desc: 'ä»·å‡é‡å‡=ä¸Šæ¶¨ä¹åŠ›â†’å–å‡ºç¡®è®¤ï¼›åœ°é‡+èƒŒé©°=æ½œåœ¨åº•éƒ¨â†’ä¹°å…¥', color: '#00d68f' },
            'K: ä¹¦ä¸­ä¸¥æ ¼åŸåˆ™': { icon: 'ğŸ“–', desc: 'ä¸¥æ ¼éµå¾ªï¼šéš”å †èƒŒç¦»+DIFé›¶è½´è¿”å›â†’å–ï¼›åŒéš”å †+åŒé›¶è½´+èƒŒé©°â†’æ‰ä¹°', color: '#ffaa00' },
            'L: å…¨æŒ‡æ ‡ç»ˆæèåˆ': { icon: 'ğŸ†', desc: 'æ¸è¿›å‡ä»“åŸºç¡€+å¤šæŒ‡æ ‡å…±æŒ¯+MACDæ‹©æ—¶+KDJ/RSIè¿‡æ»¤+é‡ä»·ç¡®è®¤+è¶‹åŠ¿åˆ¤æ–­', color: '#f43f5e' },
            'E9: åªå–ä¸ä¹°(å¯¹ç…§)': { icon: 'ğŸ“‰', desc: 'ä¸Šä¸€è½®å† å†›ç­–ç•¥ä½œä¸ºåŸºå‡†å¯¹ç…§', color: '#5c6078' },
        };

        const container = document.getElementById('se-strategy-cards');
        const sorted = [...results].sort((a, b) => b.summary.alpha - a.summary.alpha);
        container.innerHTML = sorted.slice(0, 6).map(r => {
            const d = descriptions[r.name] || { icon: 'ğŸ“Š', desc: r.name, color: '#4a9eff' };
            const alpha = r.summary.alpha;
            const alphaColor = alpha >= 0 ? 'var(--accent-green)' : 'var(--accent-red)';
            return `<div style="padding:14px;border-radius:10px;border:1px solid var(--border);border-top:3px solid ${d.color};">
                <div style="display:flex;align-items:center;gap:8px;margin-bottom:8px;">
                    <span style="font-size:18px;">${d.icon}</span>
                    <span style="font-weight:600;font-size:13px;">${r.name}</span>
                </div>
                <div style="font-size:11px;color:var(--text-secondary);line-height:1.5;margin-bottom:8px;min-height:40px;">${d.desc}</div>
                <div style="display:flex;justify-content:space-between;align-items:center;">
                    <span style="font-size:11px;color:var(--text-muted);">${r.summary.total_trades}ç¬” | å›æ’¤${r.summary.max_drawdown}%</span>
                    <span style="font-size:15px;font-weight:700;color:${alphaColor};">${alpha >= 0 ? '+' : ''}${alpha.toFixed(2)}%</span>
                </div>
            </div>`;
        }).join('');
    }

    function renderSEBarChart() {
        const results = (seData.enhanced_results || []).sort((a, b) => b.summary.alpha - a.summary.alpha);
        const container = document.getElementById('se-bar-chart');
        const maxAbs = Math.max(...results.map(r => Math.abs(r.summary.alpha)), 1);
        const barH = 240;

        let html = '<div style="position:relative;height:' + (barH + 60) + 'px;display:flex;align-items:center;">';
        html += '<div style="display:flex;flex-direction:column;justify-content:space-between;height:' + barH + 'px;padding-right:8px;font-size:11px;color:var(--text-muted);width:50px;text-align:right;">';
        html += '<span>+' + maxAbs.toFixed(0) + '%</span><span>0%</span><span>-' + maxAbs.toFixed(0) + '%</span></div>';
        html += '<div style="flex:1;display:flex;align-items:center;height:' + barH + 'px;position:relative;">';
        html += '<div style="position:absolute;top:50%;left:0;right:0;height:1px;background:var(--text-muted);opacity:0.3;"></div>';
        html += '<div style="display:flex;align-items:center;height:100%;width:100%;justify-content:space-around;">';

        const seColors = ['#00d68f', '#06b6d4', '#4a9eff', '#ffaa00', '#a855f7', '#f43f5e', '#5c6078'];
        results.forEach((r, i) => {
            const alpha = r.summary.alpha;
            const h = Math.abs(alpha / maxAbs) * (barH / 2 - 12);
            const isPos = alpha >= 0;
            const color = seColors[i % seColors.length];
            const valColor = isPos ? 'var(--accent-green)' : 'var(--accent-red)';
            const shortName = r.name.split(':')[1] || r.name.split(':')[0];

            html += '<div style="display:flex;flex-direction:column;align-items:center;flex:1;max-width:120px;height:100%;justify-content:center;position:relative;">';
            if (isPos) {
                html += '<div style="display:flex;flex-direction:column;align-items:center;justify-content:flex-end;height:50%;">';
                html += '<span style="font-size:12px;font-weight:700;color:' + valColor + ';margin-bottom:3px;">' + (alpha >= 0 ? '+' : '') + alpha.toFixed(1) + '%</span>';
                html += '<div style="width:44px;height:' + h + 'px;background:' + color + ';border-radius:6px 6px 0 0;opacity:0.85;"></div>';
                html += '</div><div style="height:50%;"></div>';
            } else {
                html += '<div style="height:50%;"></div>';
                html += '<div style="display:flex;flex-direction:column;align-items:center;justify-content:flex-start;height:50%;">';
                html += '<div style="width:44px;height:' + h + 'px;background:' + color + ';border-radius:0 0 6px 6px;opacity:0.85;"></div>';
                html += '<span style="font-size:12px;font-weight:700;color:' + valColor + ';margin-top:3px;">' + alpha.toFixed(1) + '%</span>';
                html += '</div>';
            }
            html += '<div style="position:absolute;bottom:-28px;font-size:10px;color:var(--text-muted);white-space:nowrap;text-align:center;">' + shortName.trim() + '</div>';
            html += '</div>';
        });

        html += '</div></div></div>';
        container.innerHTML = html;
    }

    function renderSETable() {
        const results = (seData.enhanced_results || []).sort((a, b) => b.summary.alpha - a.summary.alpha);

        let headHtml = '<th style="text-align:left;">#</th><th style="text-align:left;">ç­–ç•¥</th>';
        headHtml += '<th>ç­–ç•¥æ”¶ç›Š</th><th>ä¹°å…¥æŒæœ‰</th><th>è¶…é¢æ”¶ç›Š</th><th>æœ€å¤§å›æ’¤</th><th>äº¤æ˜“æ•°</th><th>ä¹°å…¥</th><th>å–å‡º</th><th>æœ€ç»ˆèµ„äº§</th>';
        document.getElementById('se-table-head').innerHTML = headHtml;

        const tbody = document.getElementById('se-table-body');
        tbody.innerHTML = results.map((r, i) => {
            const sm = r.summary;
            const isBest = i === 0;
            const rowStyle = isBest ? 'background:rgba(0,214,143,0.05);' : '';
            const alphaColor = sm.alpha >= 0 ? 'var(--accent-green)' : 'var(--accent-red)';
            const retColor = sm.strategy_return >= 0 ? 'var(--accent-green)' : 'var(--accent-red)';
            const medal = i === 0 ? ' ğŸ¥‡' : i === 1 ? ' ğŸ¥ˆ' : i === 2 ? ' ğŸ¥‰' : '';
            return `<tr style="${rowStyle}">
                <td style="font-weight:600;color:var(--text-muted);">${i+1}</td>
                <td style="text-align:left;font-weight:${isBest?'700':'400'};font-size:12px;">${r.name}${medal}</td>
                <td style="color:${retColor};font-weight:600;">${sm.strategy_return >= 0 ? '+' : ''}${sm.strategy_return}%</td>
                <td style="color:var(--text-muted);">${sm.buy_hold_return}%</td>
                <td style="color:${alphaColor};font-weight:700;font-size:14px;">${sm.alpha >= 0 ? '+' : ''}${sm.alpha}%</td>
                <td style="color:var(--accent-red);">${sm.max_drawdown}%</td>
                <td>${sm.total_trades}</td>
                <td style="color:var(--accent-green);">${sm.buy_trades}</td>
                <td style="color:var(--accent-red);">${sm.sell_trades}</td>
                <td style="font-weight:600;">$${sm.final_total.toLocaleString()}</td>
            </tr>`;
        }).join('');
    }

    function renderSEEquity() {
        const container = document.getElementById('se-equity-chart');
        const chart = LightweightCharts.createChart(container, {
            width: container.clientWidth, height: 380,
            layout: { background: { color: '#1e2130' }, textColor: '#8b8fa3' },
            grid: { vertLines: { color: '#2a2d3e' }, horzLines: { color: '#2a2d3e' } },
            crosshair: { mode: 0 },
            timeScale: { timeVisible: true, secondsVisible: false },
        });

        const results = (seData.enhanced_results || []).sort((a, b) => b.summary.alpha - a.summary.alpha);
        const eqColors = ['#00d68f', '#06b6d4', '#4a9eff', '#ffaa00', '#a855f7', '#f43f5e', '#5c6078'];

        results.forEach((r, i) => {
            const hist = r.history || [];
            if (hist.length < 2) return;
            const line = chart.addLineSeries({
                color: eqColors[i % eqColors.length],
                lineWidth: i === 0 ? 3 : (i <= 2 ? 2 : 1),
                title: r.name.split(':')[0],
            });
            line.setData(hist.map(h => ({
                time: Math.floor(new Date(h.time).getTime() / 1000),
                value: h.total,
            })));
        });

        chart.timeScale().fitContent();
        new ResizeObserver(() => chart.applyOptions({ width: container.clientWidth })).observe(container);
    }

    function renderSETrades() {
        const results = (seData.enhanced_results || []).sort((a, b) => b.summary.alpha - a.summary.alpha);
        const best = results[0];
        if (!best) return;

        const trades = best.trades || [];
        document.getElementById('se-trade-count').textContent = best.name + ' Â· ' + trades.length + 'ç¬”';

        const tbody = document.getElementById('se-trades-body');
        tbody.innerHTML = trades.map((t, i) => {
            const isBuy = t.action === 'BUY';
            const cls = isBuy ? 'pnl-pos' : 'pnl-neg';
            const dt = new Date(t.time);
            const ts = `${dt.getMonth()+1}/${dt.getDate()} ${String(dt.getHours()).padStart(2,'0')}:${String(dt.getMinutes()).padStart(2,'0')}`;
            return `<tr>
                <td>${i+1}</td>
                <td style="white-space:nowrap;">${ts}</td>
                <td class="${cls}" style="font-weight:700;">${t.action}</td>
                <td>$${t.price.toLocaleString()}</td>
                <td>${t.quantity.toFixed(4)}</td>
                <td>$${t.value.toLocaleString()}</td>
                <td>$${t.fee.toFixed(2)}</td>
                <td>$${t.usdt_after.toLocaleString()}</td>
                <td>${t.eth_after.toFixed(4)}</td>
                <td>$${t.total.toLocaleString()}</td>
                <td style="max-width:200px;overflow:hidden;text-overflow:ellipsis;white-space:nowrap;font-size:11px;" title="${t.reason}">${t.reason}</td>
            </tr>`;
        }).join('');
    }

    function renderSEConclusion() {
        const results = (seData.enhanced_results || []).sort((a, b) => b.summary.alpha - a.summary.alpha);
        const best = results[0];
        const second = results[1];
        const baseline = results.find(r => r.name.includes('å¯¹ç…§'));

        let html = '<div class="conclusion-title">ğŸ† ç»ˆæç­–ç•¥ä¼˜åŒ–ç»“è®º</div>';
        html += '<div class="conclusion-grid">';

        // å† å†›ç­–ç•¥
        html += '<div class="conclusion-item" style="border-color:var(--accent-green);">';
        html += '<h4 style="color:var(--accent-green);">ğŸ¥‡ æœ€ä¼˜ç­–ç•¥</h4>';
        html += '<p><strong>' + best.name + '</strong><br>';
        html += 'è¶…é¢æ”¶ç›Š: <strong style="color:var(--accent-green);">' + (best.summary.alpha >= 0 ? '+' : '') + best.summary.alpha + '%</strong><br>';
        html += 'æœ€å¤§å›æ’¤: <strong>' + best.summary.max_drawdown + '%</strong><br>';
        html += 'äº¤æ˜“æ¬¡æ•°: ' + best.summary.total_trades + 'ç¬”<br>';
        html += 'æœ€ç»ˆèµ„äº§: $' + best.summary.final_total.toLocaleString();
        if (baseline) {
            const improve = (best.summary.alpha - baseline.summary.alpha).toFixed(1);
            html += '<br><br>ç›¸æ¯”åŸºå‡†æå‡ <strong style="color:var(--accent-blue);">+' + improve + '%</strong>';
        }
        html += '</p></div>';

        // å…³é”®å‘ç°
        html += '<div class="conclusion-item" style="border-color:var(--accent-blue);">';
        html += '<h4 style="color:var(--accent-blue);">ğŸ”¬ å…³é”®å‘ç°</h4>';
        html += '<p>';
        html += 'â€¢ <strong>é‡ä»·èƒŒç¦»</strong>æ˜¯æœ€æœ‰ä»·å€¼çš„è¾…åŠ©æŒ‡æ ‡â€”â€”"ä»·å‡é‡å‡"ç²¾ç¡®ç¡®è®¤å–å‡ºæ—¶æœº<br>';
        html += 'â€¢ <strong>KDJ/RSIè¶…ä¹°è¶…å–</strong>æä¾›æœ‰æ•ˆè¿‡æ»¤ï¼Œé¿å…åœ¨ä¸­æ€§åŒºåŸŸé¢‘ç¹æ“ä½œ<br>';
        html += 'â€¢ <strong>å¤šæŒ‡æ ‡å…±æŒ¯</strong>è¦æ±‚è¿‡é«˜(â‰¥3ä¸ª)åè€Œå¯¼è‡´è¿‡åº¦äº¤æ˜“(-0.82%)<br>';
        html += 'â€¢ <strong>ä¹¦ä¸­ä¸¥æ ¼åŸåˆ™</strong>åœ¨30å¤©çª—å£å†…è¿‡äºä¿å®ˆï¼Œæ— äº¤æ˜“ä¿¡å·äº§ç”Ÿ';
        html += '</p></div>';

        // æŒ‡æ ‡ä»·å€¼æ’å
        html += '<div class="conclusion-item" style="border-color:var(--accent-purple);">';
        html += '<h4 style="color:var(--accent-purple);">ğŸ“Š æŒ‡æ ‡ä»·å€¼æ’å</h4>';
        html += '<p>';
        html += '<strong>1. é‡ä»·åˆ†æ</strong> â€” ä»·å‡é‡å‡+åœ°é‡ä¿¡å·,æœ€æœ‰æ•ˆçš„ç¡®è®¤å·¥å…·<br>';
        html += '<strong>2. MACDèƒŒç¦»/èƒŒé©°</strong> â€” æ ¸å¿ƒä¿¡å·æ¥æºï¼Œéš”å †èƒŒç¦»æœ€é‡è¦<br>';
        html += '<strong>3. è¶‹åŠ¿åˆ¤æ–­(MA50)</strong> â€” ä¸‹è·Œè¶‹åŠ¿ä¸­åŠ å¤§å–å‡ºåŠ›åº¦æ•ˆæœæ˜¾è‘—<br>';
        html += '<strong>4. KDJ/RSIæå€¼</strong> â€” æœ‰æ•ˆçš„è¾…åŠ©è¿‡æ»¤ï¼Œè¶…ä¹°åŒºå–å‡ºç¡®è®¤ç‡é«˜<br>';
        html += '<strong>5. CCIå¤©åœ°çº¿</strong> â€” ç©¿è¶ŠÂ±100ä½œä¸ºè¾…åŠ©å‚è€ƒ<br>';
        html += '<strong>6. å‡ ä½•å½¢æ€</strong> â€” å¹…åº¦/æ—¶é—´è¡°å‡æä¾›é¢å¤–ä½è¯';
        html += '</p></div>';

        // ä¸‰é˜¶æ®µå¯¹æ¯”
        html += '<div class="conclusion-item" style="border-color:var(--accent-yellow);">';
        html += '<h4 style="color:var(--accent-yellow);">ğŸ“ˆ ä¸‰é˜¶æ®µä¼˜åŒ–å†ç¨‹</h4>';
        html += '<p>';
        html += '<strong>Phase 1</strong>: 6ç§ç­–ç•¥æ€è·¯ â†’ æ¸è¿›å‡ä»“æœ€ä¼˜ +7.13%<br>';
        html += '<strong>Phase 2</strong>: å‚æ•°è°ƒä¼˜ â†’ åªå–ä¸ä¹°å˜ä½“ +9.06%<br>';
        html += '<strong>Phase 3</strong>: æ·±åº¦æŒ‡æ ‡å¢å¼º â†’ <strong style="color:var(--accent-green);">' + best.name + ' ' + (best.summary.alpha >= 0 ? '+' : '') + best.summary.alpha + '%</strong><br>';
        html += '<br>ä¸‰è½®ä¼˜åŒ–å°†è¶…é¢æ”¶ç›Šä»+7.13%æå‡è‡³+' + best.summary.alpha.toFixed(1) + '%';
        html += '</p></div>';

        html += '</div>';
        document.getElementById('se-conclusion').innerHTML = html;
    }

    // ========================================
    //   Multi-Interval Comparison
    // ========================================
    let multiData = null;

    async function loadMultiData() {
        if (window._multiLoaded) return;
        try {
            const resp = await fetch('/api/backtest_multi');
            if (!resp.ok) throw new Error('No data');
            multiData = await resp.json();
            window._multiLoaded = true;
            renderMultiBarChart();
            renderMultiTable();
            renderMultiEquity();
            renderConclusion();
            document.getElementById('multi-loading').style.display = 'none';
            document.getElementById('multi-content').style.display = 'block';
        } catch (e) {
            document.getElementById('multi-loading').innerHTML =
                '<span style="color:var(--accent-red)">æœªæ‰¾åˆ°å¤šå‘¨æœŸæ•°æ®ã€‚è¯·å…ˆç”Ÿæˆ backtest_multi.json</span>';
        }
    }

    function renderMultiBarChart() {
        const container = document.getElementById('alpha-bar-chart');
        const items = INTERVALS.map((iv, i) => {
            const s = multiData[iv];
            const alpha = s ? (s.total_return - s.buy_hold_return) : null;
            return { iv, alpha, color: COLORS[i], label: INTERVAL_LABELS[iv] };
        }).filter(x => x.alpha !== null);

        const maxAbs = Math.max(...items.map(x => Math.abs(x.alpha)), 1);

        // Build bar chart with CSS
        const barH = 200;
        const zeroY = barH / 2;

        let html = '<div style="position:relative;height:' + (barH + 60) + 'px;display:flex;align-items:center;">';
        // Y axis labels
        html += '<div style="display:flex;flex-direction:column;justify-content:space-between;height:' + barH + 'px;padding-right:8px;font-size:11px;color:var(--text-muted);width:50px;text-align:right;">';
        html += '<span>+' + maxAbs.toFixed(0) + '%</span>';
        html += '<span>0%</span>';
        html += '<span>-' + maxAbs.toFixed(0) + '%</span>';
        html += '</div>';
        // Bars
        html += '<div style="flex:1;display:flex;align-items:center;height:' + barH + 'px;position:relative;">';
        // Zero line
        html += '<div style="position:absolute;top:50%;left:0;right:0;height:1px;background:var(--text-muted);opacity:0.3;"></div>';
        // Bar area
        html += '<div style="display:flex;align-items:center;height:100%;width:100%;justify-content:space-around;">';

        items.forEach(item => {
            const pct = item.alpha / maxAbs;
            const h = Math.abs(pct) * (barH / 2 - 10);
            const isPos = item.alpha >= 0;
            const barColor = isPos ? 'var(--accent-green)' : 'var(--accent-red)';
            const valColor = isPos ? 'var(--accent-green)' : 'var(--accent-red)';

            html += '<div style="display:flex;flex-direction:column;align-items:center;flex:1;max-width:80px;height:100%;justify-content:center;position:relative;">';
            if (isPos) {
                html += '<div style="display:flex;flex-direction:column;align-items:center;justify-content:flex-end;height:50%;">';
                html += '<span style="font-size:11px;font-weight:600;color:' + valColor + ';margin-bottom:3px;">+' + item.alpha.toFixed(1) + '%</span>';
                html += '<div style="width:32px;height:' + h + 'px;background:' + barColor + ';border-radius:4px 4px 0 0;opacity:0.85;"></div>';
                html += '</div>';
                html += '<div style="height:50%;"></div>';
            } else {
                html += '<div style="height:50%;"></div>';
                html += '<div style="display:flex;flex-direction:column;align-items:center;justify-content:flex-start;height:50%;">';
                html += '<div style="width:32px;height:' + h + 'px;background:' + barColor + ';border-radius:0 0 4px 4px;opacity:0.85;"></div>';
                html += '<span style="font-size:11px;font-weight:600;color:' + valColor + ';margin-top:3px;">' + item.alpha.toFixed(1) + '%</span>';
                html += '</div>';
            }
            html += '<div style="position:absolute;bottom:-24px;font-size:11px;color:var(--text-muted);white-space:nowrap;">' + item.label + '</div>';
            html += '</div>';
        });

        html += '</div></div></div>';
        container.innerHTML = html;
    }

    function renderMultiTable() {
        // Header
        let headHtml = '<th style="text-align:left;">æŒ‡æ ‡</th>';
        INTERVALS.forEach((iv, i) => {
            headHtml += '<th>' + INTERVAL_LABELS[iv] + '</th>';
        });
        document.getElementById('multi-table-head').innerHTML = headHtml;

        // Rows
        const rows = [
            { label: 'ç­–ç•¥æ”¶ç›Š', key: 'total_return', unit: '%', signed: true, higherBetter: true },
            { label: 'ä¹°å…¥æŒæœ‰', key: 'buy_hold_return', unit: '%', signed: true },
            { label: 'è¶…é¢æ”¶ç›Š', key: '_alpha', unit: '%', signed: true, higherBetter: true },
            { label: 'æœ€å¤§å›æ’¤', key: 'max_drawdown', unit: '%', lowerBetter: true },
            { label: 'äº¤æ˜“æ¬¡æ•°', key: 'total_trades', unit: '' },
            { label: 'èƒœç‡', key: 'win_rate', unit: '%', higherBetter: true },
            { label: 'å¹³å‡ç›ˆåˆ©', key: 'avg_win_pct', unit: '%', higherBetter: true },
            { label: 'å¹³å‡äºæŸ', key: 'avg_loss_pct', unit: '%' },
            { label: 'Sharpe', key: 'sharpe_ratio', unit: '', higherBetter: true },
        ];

        let bodyHtml = '';
        rows.forEach(row => {
            let vals = INTERVALS.map(iv => {
                const s = multiData[iv];
                if (!s) return null;
                if (row.key === '_alpha') return s.total_return - s.buy_hold_return;
                return s[row.key];
            });

            // Find best value (only among intervals with trades)
            let bestIdx = -1;
            if (row.higherBetter) {
                let best = -Infinity;
                vals.forEach((v, i) => {
                    const s = multiData[INTERVALS[i]];
                    if (v !== null && s && s.total_trades > 0 && v > best) { best = v; bestIdx = i; }
                });
            } else if (row.lowerBetter) {
                let best = Infinity;
                vals.forEach((v, i) => {
                    const s = multiData[INTERVALS[i]];
                    if (v !== null && s && s.total_trades > 0 && Math.abs(v) < Math.abs(best)) { best = v; bestIdx = i; }
                });
            }

            bodyHtml += '<tr>';
            bodyHtml += '<td style="text-align:left;font-weight:600;color:var(--text-primary);">' + row.label + '</td>';
            vals.forEach((v, i) => {
                if (v === null) {
                    bodyHtml += '<td style="color:var(--text-muted);">â€”</td>';
                } else {
                    let cls = '';
                    if (i === bestIdx) cls = 'cell-best';
                    let display;
                    if (row.unit === '%') {
                        display = (row.signed && v > 0 ? '+' : '') + v.toFixed(1) + '%';
                    } else {
                        display = typeof v === 'number' ? (Number.isInteger(v) ? v : v.toFixed(1)) : v;
                    }
                    // Color coding for return/alpha
                    let style = '';
                    if (row.key === 'total_return' || row.key === '_alpha') {
                        style = v >= 0 ? 'color:var(--accent-green);' : 'color:var(--accent-red);';
                    }
                    bodyHtml += '<td class="' + cls + '" style="' + style + '">' + display + '</td>';
                }
            });
            bodyHtml += '</tr>';
        });

        document.getElementById('multi-table-body').innerHTML = bodyHtml;
    }

    function renderMultiEquity() {
        const container = document.getElementById('multi-equity-chart');

        const chart = LightweightCharts.createChart(container, {
            width: container.clientWidth,
            height: 380,
            layout: { background: { color: '#1e2130' }, textColor: '#8b8fa3' },
            grid: { vertLines: { color: '#2a2d3e' }, horzLines: { color: '#2a2d3e' } },
            crosshair: { mode: 0 },
            timeScale: { timeVisible: true, secondsVisible: false },
            rightPriceScale: { borderVisible: false },
        });

        const series = {};
        // Only show intervals with equity curves and trades
        const activeIntervals = INTERVALS.filter(iv => {
            const s = multiData[iv];
            return s && s.equity_curve && s.equity_curve.length > 0 && s.total_trades > 0;
        });

        activeIntervals.forEach((iv, i) => {
            const s = multiData[iv];
            const ec = s.equity_curve;
            if (!ec || ec.length < 2) return;

            const line = chart.addLineSeries({
                color: COLORS[i % COLORS.length],
                lineWidth: iv === '4h' ? 3 : 1,
                title: INTERVAL_LABELS[iv],
            });

            // Normalize to percentage
            const initVal = ec[0].equity || 10000;
            const data = ec.map(e => ({
                time: Math.floor(new Date(e.date).getTime() / 1000),
                value: (e.equity / initVal) * 100,
            }));
            line.setData(data);
            series[iv] = line;
        });

        chart.timeScale().fitContent();
        new ResizeObserver(() => chart.applyOptions({ width: container.clientWidth })).observe(container);
    }

    function renderConclusion() {
        // Rank by alpha (only intervals with actual trades)
        const ranked = INTERVALS
            .filter(iv => multiData[iv] && multiData[iv].total_trades > 0)
            .map(iv => ({
                iv,
                label: INTERVAL_LABELS[iv],
                alpha: multiData[iv].total_return - multiData[iv].buy_hold_return,
                ret: multiData[iv].total_return,
                dd: multiData[iv].max_drawdown,
                trades: multiData[iv].total_trades,
                wr: multiData[iv].win_rate,
            }))
            .sort((a, b) => b.alpha - a.alpha);

        const noTrade = INTERVALS.filter(iv => multiData[iv] && multiData[iv].total_trades === 0);

        let html = '<div class="conclusion-title">åˆ†æç»“è®º</div>';
        html += '<div class="conclusion-grid">';

        // Top 3
        html += '<div class="conclusion-item" style="border-color:var(--accent-green);">';
        html += '<h4 style="color:var(--accent-green);">è¶…é¢æ”¶ç›Šæ’å (æœ‰å®é™…äº¤æ˜“)</h4>';
        html += '<div style="margin-top:8px;">';
        ranked.slice(0, 5).forEach((r, i) => {
            const rankCls = i < 3 ? ' rank-' + (i+1) : '';
            const badge = i < 3 ? '<span class="rank-badge' + rankCls + '">' + (i+1) + '</span>' : '<span style="display:inline-block;width:26px;text-align:center;color:var(--text-muted);">' + (i+1) + '.</span>';
            html += '<div style="padding:4px 0;font-size:13px;">';
            html += badge;
            html += '<strong>' + r.label + '</strong>';
            html += ' <span style="color:' + (r.alpha >= 0 ? 'var(--accent-green)' : 'var(--accent-red)') + ';font-weight:600;">' + (r.alpha >= 0 ? '+' : '') + r.alpha.toFixed(1) + '%</span>';
            html += ' <span style="color:var(--text-muted);font-size:11px;">(' + r.trades + 'ç¬”, èƒœç‡' + r.wr.toFixed(0) + '%)</span>';
            html += '</div>';
        });
        html += '</div></div>';

        // Key insight
        const best = ranked[0];
        html += '<div class="conclusion-item" style="border-color:var(--accent-blue);">';
        html += '<h4 style="color:var(--accent-blue);">æ ¸å¿ƒå‘ç°</h4>';
        html += '<p>';
        html += '<strong>' + best.label + '</strong> æ˜¯å½“å‰è¡Œæƒ…æœ€ä¼˜å‘¨æœŸï¼Œè¶…é¢æ”¶ç›Š <strong style="color:var(--accent-green);">' + (best.alpha >= 0 ? '+' : '') + best.alpha.toFixed(1) + '%</strong>ã€‚';
        html += '<br><br>';
        html += 'èƒŒç¦»/èƒŒé©°æœ¬è´¨æ˜¯<strong>è¶‹åŠ¿çº§åˆ«</strong>ä¿¡å·ã€‚æ—¶é—´æ¡†æ¶è¶Šå¤§ï¼Œä¿¡å·å™ªéŸ³è¶Šå°‘ï¼Œä½†äº¤æ˜“æœºä¼šä¹Ÿè¶Šå°‘ã€‚';
        html += '<br><br>';
        html += '<strong>æœ€ä¼˜çª—å£: 2h ~ 8h</strong>ï¼Œå…¼é¡¾ä¿¡å·è´¨é‡å’Œäº¤æ˜“é¢‘ç‡ã€‚';
        if (noTrade.length > 0) {
            html += '<br><br><span style="color:var(--text-muted);font-size:12px;">' + noTrade.map(iv => INTERVAL_LABELS[iv]).join('ã€') + ' æœªè§¦å‘äº¤æ˜“ä¿¡å·ï¼ŒæŒå¸ä¸åŠ¨ã€‚</span>';
        }
        html += '</p></div>';

        html += '</div>';
        document.getElementById('multi-conclusion').innerHTML = html;
    }

    // ========================================
    //   Single Interval Detail (existing)
    // ========================================
    let btData = null;

    async function loadBacktestData() {
        if (window._backtestLoaded) return;
        try {
            const resp = await fetch('/api/backtest');
            if (!resp.ok) throw new Error('No data');
            btData = await resp.json();
            window._backtestLoaded = true;
            renderSummary();
            renderEquityChart();
            renderKlineChart();
            renderTrades();
        } catch (e) {
            ['summary-loading','chart-loading','trades-loading'].forEach(id => {
                const el = document.getElementById(id);
                if (el) el.innerHTML = '<span style="color:var(--accent-red)">æœªæ‰¾åˆ°å›æµ‹æ•°æ®ã€‚è¯·å…ˆè¿è¡Œ: python backtest.py</span>';
            });
        }
    }

    function renderSummary() {
        const s = btData.summary;
        document.getElementById('summary-loading').style.display = 'none';
        document.getElementById('summary-content').style.display = 'block';

        const statsHtml = [
            {label: 'ç­–ç•¥æ”¶ç›Š', value: s.total_return + '%', cls: s.total_return >= 0 ? 'positive' : 'negative'},
            {label: 'ä¹°å…¥æŒæœ‰æ”¶ç›Š', value: s.buy_hold_return + '%', cls: s.buy_hold_return >= 0 ? 'positive' : 'negative'},
            {label: 'æœ€ç»ˆèµ„é‡‘', value: '$' + s.final_equity.toLocaleString(), cls: s.final_equity >= s.initial_capital ? 'positive' : 'negative'},
            {label: 'æœ€å¤§å›æ’¤', value: s.max_drawdown + '%', cls: 'negative'},
            {label: 'äº¤æ˜“æ¬¡æ•°', value: s.total_trades, cls: ''},
            {label: 'èƒœç‡', value: s.win_rate + '%', cls: s.win_rate >= 50 ? 'positive' : 'negative', note: s.win_count + 'èƒœ / ' + s.lose_count + 'è´Ÿ'},
            {label: 'å¹³å‡ç›ˆåˆ©', value: '+' + s.avg_win_pct + '%', cls: 'positive'},
            {label: 'å¹³å‡äºæŸ', value: s.avg_loss_pct + '%', cls: 'negative'},
            {label: 'Sharpeæ¯”ç‡', value: s.sharpe_ratio, cls: s.sharpe_ratio >= 0 ? 'positive' : 'negative'},
            {label: 'å›æµ‹å¤©æ•°', value: s.total_days + 'å¤©', cls: ''},
        ].map(item => `
            <div class="stat-card">
                <div class="stat-label">${item.label}</div>
                <div class="stat-value ${item.cls}">${item.value}</div>
                ${item.note ? '<div class="stat-note">' + item.note + '</div>' : ''}
            </div>
        `).join('');
        document.getElementById('stats-grid').innerHTML = statsHtml;
    }

    function renderEquityChart() {
        const container = document.getElementById('equity-chart');
        if (!btData || !btData.equity_curve || !btData.equity_curve.length) return;

        const chart = LightweightCharts.createChart(container, {
            width: container.clientWidth, height: 300,
            layout: { background: { color: '#1e2130' }, textColor: '#8b8fa3' },
            grid: { vertLines: { color: '#2a2d3e' }, horzLines: { color: '#2a2d3e' } },
            crosshair: { mode: 0 },
            timeScale: { timeVisible: true, secondsVisible: false },
        });

        const equitySeries = chart.addLineSeries({ color: '#4a9eff', lineWidth: 2, title: 'ç­–ç•¥å‡€å€¼' });
        equitySeries.setData(btData.equity_curve.map(e => ({
            time: Math.floor(new Date(e.date).getTime() / 1000), value: e.equity,
        })));

        if (btData.kline_data && btData.kline_data.length > 0) {
            const baseline = chart.addLineSeries({ color: '#5c6078', lineWidth: 1, lineStyle: 2, title: 'ä¹°å…¥æŒæœ‰' });
            const fp = btData.kline_data[0].close;
            const ic = btData.summary.initial_capital;
            baseline.setData(btData.kline_data.map(k => ({
                time: Math.floor(new Date(k.date).getTime() / 1000), value: ic * (k.close / fp),
            })));
        }
        chart.timeScale().fitContent();
        new ResizeObserver(() => chart.applyOptions({ width: container.clientWidth })).observe(container);
    }

    function renderKlineChart() {
        const container = document.getElementById('kline-chart');
        document.getElementById('chart-loading').style.display = 'none';
        document.getElementById('chart-content').style.display = 'block';
        if (!btData || !btData.kline_data || !btData.kline_data.length) return;

        const chart = LightweightCharts.createChart(container, {
            width: container.clientWidth, height: 400,
            layout: { background: { color: '#1e2130' }, textColor: '#8b8fa3' },
            grid: { vertLines: { color: '#2a2d3e' }, horzLines: { color: '#2a2d3e' } },
            crosshair: { mode: 0 },
            timeScale: { timeVisible: true, secondsVisible: false },
        });

        const cs = chart.addCandlestickSeries({
            upColor: '#00d68f', downColor: '#ff4d6a',
            borderUpColor: '#00d68f', borderDownColor: '#ff4d6a',
            wickUpColor: '#00d68f', wickDownColor: '#ff4d6a',
        });
        cs.setData(btData.kline_data.map(k => ({
            time: Math.floor(new Date(k.date).getTime() / 1000),
            open: k.open, high: k.high, low: k.low, close: k.close,
        })));

        if (btData.signals && btData.signals.length > 0) {
            cs.setMarkers(btData.signals.map(s => ({
                time: Math.floor(new Date(s.date).getTime() / 1000),
                position: s.signal === 'BUY' ? 'belowBar' : 'aboveBar',
                color: s.signal === 'BUY' ? '#00d68f' : '#ff4d6a',
                shape: s.signal === 'BUY' ? 'arrowUp' : 'arrowDown',
                text: s.signal === 'BUY' ? 'B' : 'S',
            })));
        }

        const vs = chart.addHistogramSeries({ priceFormat: { type: 'volume' }, priceScaleId: 'vol' });
        chart.priceScale('vol').applyOptions({ scaleMargins: { top: 0.85, bottom: 0 } });
        vs.setData(btData.kline_data.map(k => ({
            time: Math.floor(new Date(k.date).getTime() / 1000), value: k.volume,
            color: k.close >= k.open ? 'rgba(0,214,143,0.3)' : 'rgba(255,77,106,0.3)',
        })));

        chart.timeScale().fitContent();
        new ResizeObserver(() => chart.applyOptions({ width: container.clientWidth })).observe(container);
    }

    function renderTrades() {
        document.getElementById('trades-loading').style.display = 'none';
        document.getElementById('trades-content').style.display = 'block';
        if (!btData || !btData.completed_trades) return;

        const trades = btData.completed_trades;
        const totalPnl = trades.reduce((s, t) => s + t.pnl, 0);
        const best = trades.length ? trades.reduce((b, t) => t.pnl_pct > b.pnl_pct ? t : b, trades[0]) : {pnl_pct:0};
        const worst = trades.length ? trades.reduce((w, t) => t.pnl_pct < w.pnl_pct ? t : w, trades[0]) : {pnl_pct:0};

        document.getElementById('trade-stats').innerHTML = [
            {label:'æ€»ç›ˆäº', value:'$'+totalPnl.toFixed(2), cls:totalPnl>=0?'positive':'negative'},
            {label:'æœ€ä½³äº¤æ˜“', value:'+'+(best.pnl_pct||0).toFixed(2)+'%', cls:'positive'},
            {label:'æœ€å·®äº¤æ˜“', value:(worst.pnl_pct||0).toFixed(2)+'%', cls:'negative'},
            {label:'å®Œæˆäº¤æ˜“', value:trades.length, cls:''},
        ].map(item=>`<div class="stat-card"><div class="stat-label">${item.label}</div><div class="stat-value ${item.cls}">${item.value}</div></div>`).join('');

        document.querySelector('#trades-table tbody').innerHTML = trades.map((t,i)=>`
            <tr>
                <td>${i+1}</td>
                <td>${fmtDate(t.buy_date)}</td><td>$${t.buy_price.toFixed(2)}</td>
                <td>${fmtDate(t.sell_date)}</td><td>$${t.sell_price.toFixed(2)}</td>
                <td class="${t.pnl>=0?'pnl-pos':'pnl-neg'}">${t.pnl>=0?'+':''}${t.pnl.toFixed(2)}</td>
                <td class="${t.pnl_pct>=0?'pnl-pos':'pnl-neg'}">${t.pnl_pct>=0?'+':''}${t.pnl_pct.toFixed(2)}%</td>
                <td style="max-width:120px;overflow:hidden;text-overflow:ellipsis;white-space:nowrap" title="${t.buy_reason||''}">${t.buy_reason||'-'}</td>
                <td style="max-width:120px;overflow:hidden;text-overflow:ellipsis;white-space:nowrap" title="${t.sell_reason||''}">${t.sell_reason||'-'}</td>
            </tr>`).join('');
    }

    function fmtDate(s) {
        if (!s) return '-';
        const d = new Date(s);
        return `${d.getMonth()+1}/${d.getDate()} ${String(d.getHours()).padStart(2,'0')}:${String(d.getMinutes()).padStart(2,'0')}`;
    }

    // ===================== åˆçº¦åšç©ºç­–ç•¥ =====================
    async function loadFuturesStrategy() {
        try {
            const res = await fetch('/api/strategy_futures');
            if (!res.ok) throw new Error('æ— æ•°æ®');
            const data = await res.json();
            window._ftLoaded = true;
            renderFuturesPage(data);
        } catch (e) {
            document.getElementById('ft-intro').innerHTML += `<p style="color:var(--accent-red);margin-top:12px;">åŠ è½½å¤±è´¥: ${e.message}</p>`;
        }
        // åŠ è½½Phase 2
        try {
            const res2 = await fetch('/api/strategy_futures_v2');
            if (res2.ok) {
                const data2 = await res2.json();
                renderFuturesV2(data2);
            }
        } catch(e) { /* Phase 2å¯é€‰ */ }
        // åŠ è½½Phase 3
        try {
            const res3 = await fetch('/api/strategy_futures_v3');
            if (res3.ok) { renderFuturesV3(await res3.json()); }
        } catch(e) {}
        // åŠ è½½Phase 4
        try {
            const res4 = await fetch('/api/strategy_futures_v4');
            if (res4.ok) { renderFuturesPhase(await res4.json(), 'ft4', 4, '#ef4444'); }
        } catch(e) {}
        // åŠ è½½Phase 5
        try {
            const res5 = await fetch('/api/strategy_futures_v5');
            if (res5.ok) { renderFuturesPhase(await res5.json(), 'ft5', 5, '#10b981'); }
        } catch(e) {}
        // åŠ è½½Phase 6+7+8 ç»ˆæä¼˜åŒ–
        try {
            const resF = await fetch('/api/strategy_futures_final');
            if (resF.ok) { renderFuturesFinal(await resF.json()); }
        } catch(e) {}
        // åŠ è½½å¤šæ—¶é—´å‘¨æœŸåˆ†æ
        try {
            const resTF = await fetch('/api/timeframe_analysis');
            if (resTF.ok) { renderTimeframeAnalysis(await resTF.json()); }
        } catch(e) {}
        // åŠ è½½15åˆ†é’ŸåŒå‘å›æµ‹
        try {
            const res15m = await fetch('/api/strategy_15m');
            if (res15m.ok) { render15mStrategy(await res15m.json()); }
        } catch(e) {}
        // åŠ è½½å‡çº¿æŠ€æœ¯åˆ†æ
        try {
            const resMA = await fetch('/api/ma_strategy');
            if (resMA.ok) { renderMAStrategy(await resMA.json()); }
        } catch(e) {}
    }

    function renderFuturesPage(data) {
        const results = data.futures_results || [];
        const sorted = [...results].sort((a, b) => (b.summary?.alpha || 0) - (a.summary?.alpha || 0));

        renderFTCards(sorted);
        renderFTBarChart(sorted);
        renderFTTable(sorted);
        renderFTEquity(results);
        renderFTTrades(sorted[0]); // best strategy
        renderFTConclusion(sorted, data.best_strategy);
    }

    function renderFTCards(sorted) {
        const descs = {
            'å¯¹ç…§': { icon: 'ğŸ“¦', color: 'var(--text-muted)', desc: 'çº¯ç°è´§é‡ä»·ç¡®è®¤ç­–ç•¥,ä¸ä½¿ç”¨åˆçº¦' },
            'M': { icon: 'ğŸ›¡ï¸', color: 'var(--accent-blue)', desc: 'æŒæœ‰ç°è´§ETH,é¡¶èƒŒç¦»å¼€ç©ºå¤´å¯¹å†²ä¸‹è·Œ' },
            'N': { icon: 'âš¡', color: 'var(--accent-purple)', desc: 'çº¯åˆçº¦åŒå‘äº¤æ˜“,ä¸æŒæœ‰ç°è´§' },
            'O': { icon: 'ğŸš€', color: 'var(--accent-green)', desc: 'ç°è´§+åˆçº¦å¢å¼º,å‡ä»“åŒæ—¶å¼€ç©º' },
            'P': { icon: 'ğŸ¯', color: 'var(--accent-yellow)', desc: 'ä¿¡å·å¼ºåº¦å†³å®šæ æ†å€æ•°å’Œä»“ä½æ–¹å‘' },
            'Q': { icon: 'ğŸ“Š', color: 'var(--accent-red)', desc: 'é‡ä»·ç¡®è®¤+åˆçº¦,ä»·å‡é‡å‡å¼€ç©º' },
        };
        const box = document.getElementById('ft-strategy-cards');
        box.innerHTML = sorted.map((r, i) => {
            const s = r.summary;
            const key = r.name.split(':')[0].replace('å¯¹ç…§', 'å¯¹ç…§');
            const d = descs[key] || descs['å¯¹ç…§'];
            const isTop = i === 0;
            return `<div style="background:var(--bg-hover);border-radius:10px;padding:14px;${isTop ? 'border:1.5px solid var(--accent-green);' : ''}">
                <div style="display:flex;align-items:center;gap:8px;margin-bottom:6px;">
                    <span style="font-size:22px;">${d.icon}</span>
                    <span style="font-weight:700;font-size:14px;color:${d.color};">${r.name}${isTop ? ' â˜…' : ''}</span>
                </div>
                <div style="font-size:12px;color:var(--text-secondary);margin-bottom:8px;">${d.desc}</div>
                <div style="display:flex;gap:14px;font-size:13px;">
                    <span style="color:${s.alpha > 0 ? 'var(--accent-green)' : 'var(--accent-red)'};">${s.alpha > 0 ? '+' : ''}${s.alpha}% Î±</span>
                    <span style="color:var(--text-muted);">${s.max_drawdown}% DD</span>
                    <span style="color:var(--text-muted);">${s.total_trades}ç¬”</span>
                    ${s.liquidations > 0 ? `<span style="color:var(--accent-red);">å¼ºå¹³${s.liquidations}</span>` : ''}
                </div>
            </div>`;
        }).join('');
    }

    function renderFTBarChart(sorted) {
        const container = document.getElementById('ft-bar-chart');
        const barW = Math.floor((container.clientWidth - 80) / sorted.length);
        const maxVal = Math.max(...sorted.map(r => Math.abs(r.summary?.alpha || 0)), 10);
        const scale = 280 / maxVal;

        let html = `<svg width="100%" height="350" viewBox="0 0 ${container.clientWidth} 350">`;
        sorted.forEach((r, i) => {
            const s = r.summary;
            const alpha = s?.alpha || 0;
            const ret = s?.strategy_return || 0;
            const x = 50 + i * barW;
            const barH = Math.abs(alpha) * scale;
            const y = alpha >= 0 ? (300 - barH) : 300;
            const color = alpha >= 0 ? '#00d68f' : '#ff4d6a';
            const retH = Math.max(Math.abs(ret) * scale * 0.3, 2);
            const retY = ret >= 0 ? (300 - retH) : 300;
            const retColor = ret >= 0 ? 'rgba(74,158,255,0.6)' : 'rgba(255,77,106,0.4)';

            html += `<rect x="${x}" y="${y}" width="${barW * 0.35}" height="${barH}" fill="${color}" rx="3"/>`;
            html += `<rect x="${x + barW * 0.4}" y="${retY}" width="${barW * 0.35}" height="${retH}" fill="${retColor}" rx="3"/>`;
            html += `<text x="${x + barW * 0.37}" y="${Math.min(y, retY) - 6}" text-anchor="middle" fill="${color}" font-size="11" font-weight="700">${alpha > 0 ? '+' : ''}${alpha.toFixed(1)}%</text>`;
            html += `<text x="${x + barW * 0.37}" y="325" text-anchor="middle" fill="#8b8fa3" font-size="10" transform="rotate(-15,${x + barW * 0.37},325)">${r.name.split(':')[0]}</text>`;
        });
        html += `<line x1="48" y1="300" x2="${container.clientWidth}" y2="300" stroke="#2a2d3e" stroke-width="1"/>`;
        html += `<text x="14" y="304" fill="#5c6078" font-size="10">0%</text>`;
        html += `</svg>`;
        html += `<div style="display:flex;gap:16px;justify-content:center;margin-top:8px;font-size:12px;">
            <span><span style="display:inline-block;width:10px;height:10px;background:#00d68f;border-radius:2px;margin-right:4px;"></span>è¶…é¢æ”¶ç›Š(Î±)</span>
            <span><span style="display:inline-block;width:10px;height:10px;background:rgba(74,158,255,0.6);border-radius:2px;margin-right:4px;"></span>ç­–ç•¥æ”¶ç›Š</span>
        </div>`;
        container.innerHTML = html;
    }

    function renderFTTable(sorted) {
        const head = document.getElementById('ft-table-head');
        const body = document.getElementById('ft-table-body');
        head.innerHTML = `<th>#</th><th>ç­–ç•¥</th><th>ç­–ç•¥æ”¶ç›Š</th><th>è¶…é¢Î±</th><th>å›æ’¤</th><th>ç¬”æ•°</th><th>æ€»è´¹ç”¨</th><th>æ»‘ç‚¹æˆæœ¬</th><th>èµ„é‡‘è´¹å‡€</th><th>è´¹ç”¨å æ¯”</th><th>æœ€ç»ˆèµ„äº§</th>`;

        body.innerHTML = sorted.map((r, i) => {
            const s = r.summary;
            const f = s.fees || {};
            const cls = i === 0 ? 'style="background:rgba(0,214,143,0.08);"' : '';
            return `<tr ${cls}>
                <td>${i + 1}</td>
                <td><b>${r.name}</b>${i === 0 ? ' â˜…' : ''}</td>
                <td style="color:${s.strategy_return >= 0 ? 'var(--accent-green)' : 'var(--accent-red)'}">${s.strategy_return > 0 ? '+' : ''}${s.strategy_return}%</td>
                <td style="color:${s.alpha >= 0 ? 'var(--accent-green)' : 'var(--accent-red)'}; font-weight:700;">${s.alpha > 0 ? '+' : ''}${s.alpha}%</td>
                <td>${s.max_drawdown}%</td>
                <td>${s.total_trades}</td>
                <td>$${Number(f.total_fees || 0).toLocaleString()}</td>
                <td>$${Number(f.slippage_cost || 0).toLocaleString()}</td>
                <td style="color:${(f.net_funding||0) >= 0 ? 'var(--accent-green)' : 'var(--accent-red)'}">$${(f.net_funding||0) >= 0 ? '+' : ''}${Number(f.net_funding || 0).toLocaleString()}</td>
                <td>${f.fee_drag_pct || 0}%</td>
                <td style="font-weight:600;">$${Number(s.final_total).toLocaleString()}</td>
            </tr>`;
        }).join('');
    }

    function renderFTEquity(results) {
        const container = document.getElementById('ft-equity-chart');
        container.innerHTML = '';
        const chart = LightweightCharts.createChart(container, {
            width: container.clientWidth,
            height: 400,
            layout: { background: { type: 'solid', color: '#1e2130' }, textColor: '#8b8fa3' },
            grid: { vertLines: { color: '#2a2d3e' }, horzLines: { color: '#2a2d3e' } },
            rightPriceScale: { borderColor: '#2a2d3e' },
            timeScale: { borderColor: '#2a2d3e', timeVisible: true },
        });

        const colors = ['#00d68f', '#4a9eff', '#a855f7', '#ffaa00', '#ff4d6a', '#8b8fa3'];
        results.forEach((r, i) => {
            if (!r.history || r.history.length === 0) return;
            const series = chart.addLineSeries({
                color: colors[i % colors.length],
                lineWidth: r.name.includes('â˜…') || i === 0 ? 2.5 : 1.5,
                title: r.name.split(':')[0].trim(),
            });
            const lineData = r.history.map(h => ({
                time: Math.floor(new Date(h.time).getTime() / 1000),
                value: h.total,
            }));
            series.setData(lineData);
        });
        chart.timeScale().fitContent();
    }

    function renderFTTrades(bestResult) {
        if (!bestResult || !bestResult.trades) return;
        const trades = bestResult.trades;
        document.getElementById('ft-trade-count').textContent = `${trades.length} ç¬”äº¤æ˜“`;
        const body = document.getElementById('ft-trades-body');

        const actionColors = {
            'SPOT_BUY': 'var(--accent-green)',
            'SPOT_SELL': 'var(--accent-red)',
            'OPEN_LONG': 'var(--accent-blue)',
            'CLOSE_LONG': 'var(--accent-purple)',
            'OPEN_SHORT': 'var(--accent-red)',
            'CLOSE_SHORT': 'var(--accent-green)',
            'LIQUIDATED': '#ff0000',
        };
        const actionLabels = {
            'SPOT_BUY': 'ç°è´§ä¹°å…¥',
            'SPOT_SELL': 'ç°è´§å–å‡º',
            'OPEN_LONG': 'å¼€å¤š',
            'CLOSE_LONG': 'å¹³å¤š',
            'OPEN_SHORT': 'å¼€ç©º',
            'CLOSE_SHORT': 'å¹³ç©º',
            'LIQUIDATED': 'å¼ºå¹³',
        };

        body.innerHTML = trades.map((t, i) => {
            const c = actionColors[t.action] || 'var(--text-primary)';
            const label = actionLabels[t.action] || t.action;
            return `<tr>
                <td>${i + 1}</td>
                <td>${fmtDate(t.time)}</td>
                <td style="color:${c};font-weight:700;">${label}</td>
                <td>${t.direction === 'long' ? 'ğŸ“ˆå¤š' : 'ğŸ“‰ç©º'}</td>
                <td>$${t.price.toLocaleString()}</td>
                <td>${t.quantity.toFixed(4)}</td>
                <td>$${Number(t.value).toLocaleString()}</td>
                <td>${t.leverage}x</td>
                <td>$${Number(t.usdt_after).toLocaleString()}</td>
                <td>$${Number(t.frozen_margin).toLocaleString()}</td>
                <td style="font-weight:600;">$${Number(t.total).toLocaleString()}</td>
                <td style="font-size:11px;max-width:180px;overflow:hidden;text-overflow:ellipsis;">${t.reason}</td>
            </tr>`;
        }).join('');
    }

    // ===================== åˆçº¦Phase 2 =====================
    function renderFuturesV2(data) {
        const section = document.getElementById('ft2-section');
        if (!section) return;
        section.style.display = 'block';

        const results = data.futures_results || [];
        const sorted = [...results].sort((a, b) => (b.summary?.alpha || 0) - (a.summary?.alpha || 0));

        // ç­–ç•¥è¯´æ˜å¡ç‰‡
        const v2descs = {
            'R': { icon: 'ğŸ”ï¸', color: 'var(--accent-blue)', desc: '4h/8hå®šæ–¹å‘â†’2hç¡®è®¤â†’1hæ­»å‰/KDJå…¥åœº' },
            'S': { icon: 'âš¡', color: 'var(--accent-green)', desc: 'åªåœ¨éš”å †/é¢ç§¯/é›¶è½´èƒŒç¦»æ—¶åšç©º,3xæ æ†' },
            'T': { icon: 'ğŸ¯', color: 'var(--accent-yellow)', desc: 'KDJ>80+CCI>100+RSI>70ä¸‰é‡æå€¼åè½¬' },
            'U': { icon: 'ğŸ“ˆ', color: 'var(--accent-purple)', desc: 'ç§»åŠ¨æ­¢ç›ˆæ›¿ä»£å›ºå®šæ­¢ç›ˆ,æ•è·å¤§è¡Œæƒ…' },
            'V': { icon: 'ğŸ“Š', color: 'var(--accent-red)', desc: 'ä»·å‡é‡å‡+MACDæ­»å‰ç»å…¸ç»„åˆåšç©º' },
            'W': { icon: 'ğŸ†', color: '#ff6b35', desc: 'å¤šå‘¨æœŸ+éš”å †+æå€¼+è¿½è¸ª+é‡ä»·å…¨èåˆ' },
            'P': { icon: 'ğŸ”„', color: 'var(--text-muted)', desc: 'Phase 1æœ€ä½³ç­–ç•¥(åŸºçº¿å¯¹ç…§)' },
            'å¯¹ç…§': { icon: 'ğŸ“¦', color: 'var(--text-muted)', desc: 'çº¯ç°è´§(æ— åˆçº¦)' },
        };
        const box = document.getElementById('ft2-strategy-cards');
        box.innerHTML = sorted.map((r, i) => {
            const s = r.summary;
            const key = r.name.split(':')[0].replace(/.*?([A-Z\u5bf9])/,'$1').trim();
            const d = v2descs[key] || v2descs['å¯¹ç…§'];
            const isTop = i === 0;
            return `<div style="background:var(--bg-hover);border-radius:10px;padding:14px;${isTop ? 'border:1.5px solid var(--accent-green);' : ''}">
                <div style="display:flex;align-items:center;gap:8px;margin-bottom:6px;">
                    <span style="font-size:22px;">${d.icon}</span>
                    <span style="font-weight:700;font-size:13px;color:${d.color};">${r.name}${isTop ? ' â˜…' : ''}</span>
                </div>
                <div style="font-size:12px;color:var(--text-secondary);margin-bottom:8px;">${d.desc}</div>
                <div style="display:flex;gap:12px;font-size:13px;">
                    <span style="color:${s.alpha > 0 ? 'var(--accent-green)' : 'var(--accent-red)'};">${s.alpha > 0 ? '+' : ''}${s.alpha}% Î±</span>
                    <span style="color:var(--text-muted);">${s.max_drawdown}% DD</span>
                    <span style="color:var(--text-muted);">${s.total_trades}ç¬”</span>
                </div>
            </div>`;
        }).join('');

        // æŸ±çŠ¶å›¾
        const chartC = document.getElementById('ft2-bar-chart');
        const barW = Math.floor((chartC.clientWidth - 80) / sorted.length);
        const maxVal = Math.max(...sorted.map(r => Math.abs(r.summary?.alpha || 0)), 10);
        const scale = 280 / maxVal;
        let svg = `<svg width="100%" height="350" viewBox="0 0 ${chartC.clientWidth} 350">`;
        sorted.forEach((r, i) => {
            const s = r.summary;
            const alpha = s?.alpha || 0;
            const x = 50 + i * barW;
            const barH = Math.abs(alpha) * scale;
            const y = alpha >= 0 ? (300 - barH) : 300;
            const color = alpha >= 0 ? '#00d68f' : '#ff4d6a';
            svg += `<rect x="${x}" y="${y}" width="${barW * 0.6}" height="${barH}" fill="${color}" rx="4"/>`;
            svg += `<text x="${x + barW * 0.3}" y="${y - 6}" text-anchor="middle" fill="${color}" font-size="11" font-weight="700">${alpha > 0 ? '+' : ''}${alpha.toFixed(1)}%</text>`;
            svg += `<text x="${x + barW * 0.3}" y="325" text-anchor="middle" fill="#8b8fa3" font-size="9" transform="rotate(-20,${x + barW * 0.3},325)">${r.name.split(':')[0].slice(-6)}</text>`;
        });
        svg += `<line x1="48" y1="300" x2="${chartC.clientWidth}" y2="300" stroke="#2a2d3e"/>`;
        svg += `</svg>`;
        chartC.innerHTML = svg;

        // è¡¨æ ¼
        const head = document.getElementById('ft2-table-head');
        const body = document.getElementById('ft2-table-body');
        head.innerHTML = `<th>#</th><th>ç­–ç•¥</th><th>ç­–ç•¥æ”¶ç›Š</th><th>è¶…é¢Î±</th><th>å›æ’¤</th><th>ç¬”æ•°</th><th>æ€»è´¹ç”¨</th><th>æ»‘ç‚¹</th><th>è´¹ç”¨å æ¯”</th><th>æœ€ç»ˆèµ„äº§</th>`;
        body.innerHTML = sorted.map((r, i) => {
            const s = r.summary;
            const f = s.fees || {};
            const cls = i === 0 ? 'style="background:rgba(0,214,143,0.08);"' : '';
            return `<tr ${cls}>
                <td>${i + 1}</td>
                <td><b>${r.name}</b>${i === 0 ? ' â˜…' : ''}</td>
                <td style="color:${s.strategy_return >= 0 ? 'var(--accent-green)' : 'var(--accent-red)'}">${s.strategy_return > 0 ? '+' : ''}${s.strategy_return}%</td>
                <td style="color:var(--accent-green);font-weight:700;">${s.alpha > 0 ? '+' : ''}${s.alpha}%</td>
                <td>${s.max_drawdown}%</td>
                <td>${s.total_trades}</td>
                <td>$${Number(f.total_fees || 0).toLocaleString()}</td>
                <td>$${Number(f.slippage_cost || 0).toLocaleString()}</td>
                <td>${f.fee_drag_pct || 0}%</td>
                <td style="font-weight:600;">$${Number(s.final_total).toLocaleString()}</td>
            </tr>`;
        }).join('');

        // èµ„äº§æ›²çº¿
        const eqC = document.getElementById('ft2-equity-chart');
        eqC.innerHTML = '';
        const chart = LightweightCharts.createChart(eqC, {
            width: eqC.clientWidth, height: 400,
            layout: { background: { type: 'solid', color: '#1e2130' }, textColor: '#8b8fa3' },
            grid: { vertLines: { color: '#2a2d3e' }, horzLines: { color: '#2a2d3e' } },
            rightPriceScale: { borderColor: '#2a2d3e' },
            timeScale: { borderColor: '#2a2d3e', timeVisible: true },
        });
        const colors2 = ['#00d68f', '#4a9eff', '#a855f7', '#ff6b35', '#ffaa00', '#ff4d6a', '#22d3ee', '#8b8fa3'];
        results.forEach((r, i) => {
            if (!r.history || r.history.length === 0) return;
            const series = chart.addLineSeries({
                color: colors2[i % colors2.length],
                lineWidth: i === 0 || sorted[0]?.name === r.name ? 2.5 : 1.5,
                title: r.name.split(':')[0].trim(),
            });
            series.setData(r.history.map(h => ({
                time: Math.floor(new Date(h.time).getTime() / 1000),
                value: h.total,
            })));
        });
        chart.timeScale().fitContent();

        // æœ€ä½³ç­–ç•¥äº¤æ˜“æ˜ç»†
        renderFTTrades2(sorted[0]);

        // ç»“è®º
        const best = sorted[0]?.summary;
        const pBase = sorted.find(r => r.name.includes('P-åŸºçº¿'))?.summary;
        const spot = sorted.find(r => r.name.includes('å¯¹ç…§'))?.summary;
        const box2 = document.getElementById('ft2-conclusion');
        const improve = pBase ? (best.alpha - pBase.alpha).toFixed(2) : 'â€”';
        box2.innerHTML = `
            <div class="card-title">Phase 2 è¿›é˜¶ä¼˜åŒ–ç»“è®º</div>
            <div style="line-height:2;font-size:14px;color:var(--text-secondary);">
                <p><b style="color:var(--accent-green);font-size:16px;">ğŸ† æœ€ä½³ç­–ç•¥: ${sorted[0].name}</b></p>
                <p style="margin-top:8px;">
                    è¶…é¢æ”¶ç›Š(Î±) <b style="color:var(--accent-green);">+${best.alpha}%</b>
                    | ç­–ç•¥æ”¶ç›Š <b style="color:var(--accent-green);">+${best.strategy_return}%</b>
                    | æœ€å¤§å›æ’¤ <b>${best.max_drawdown}%</b>
                    | äº¤æ˜“ <b>${best.total_trades}ç¬”</b>
                </p>
                ${pBase ? `<p style="margin-top:6px;">
                    vs Phase 1æœ€ä½³(P): Î±=+${pBase.alpha}% â†’ <b style="color:var(--accent-yellow);">æå‡ +${improve}%</b>
                </p>` : ''}
                <div style="margin-top:16px;padding:14px;background:var(--bg-hover);border-radius:8px;border-left:3px solid var(--accent-purple);">
                    <b style="color:var(--accent-purple);">Phase 2 å…³é”®å‘ç°:</b><br>
                    <span>1. <b>éš”å †èƒŒç¦»</b>æ˜¯ä¹¦ä¸­æœ€å¼ºä¿¡å· â€” ç”¨äºåˆçº¦åšç©ºæ—¶æ•ˆæœè¿œè¶…é€šç”¨è¯„åˆ†</span><br>
                    <span>2. ç²¾ç¡®ä¿¡å· > é¢‘ç¹äº¤æ˜“ â€” Sç­–ç•¥135ç¬”äº¤æ˜“ä¼˜äºPçš„196ç¬”</span><br>
                    <span>3. <b>è¿½è¸ªæ­¢ç›ˆ</b>(U)æœ‰æ•ˆå‡å°‘äº†è¿‡æ—©æ­¢ç›ˆçš„é—®é¢˜</span><br>
                    <span>4. å¤šå‘¨æœŸç€‘å¸ƒ(R)è¿‡äºä¸¥æ ¼(ä»…15ç¬”äº¤æ˜“), éœ€è¦æ›´å¤šæ•°æ®éªŒè¯</span><br>
                    <span>5. æå€¼ä¸‰é‡ç¡®è®¤(T)å’Œé‡ä»·æ­»å‰(V)ä½œä¸ºè¿‡æ»¤å™¨æœ‰æ•ˆä½†ç‹¬ç«‹ä½¿ç”¨æ”¶ç›Šæœ‰é™</span><br>
                    <span>6. ä»çº¯ç°è´§Î±=+${spot?.alpha}% â†’ åˆçº¦Phase2 Î±=+${best.alpha}%, <b>åšç©ºèƒ½åŠ›æå‡${(best.alpha / (spot?.alpha || 1)).toFixed(0)}å€</b></span>
                </div>
            </div>`;
    }

    function renderFTTrades2(bestResult) {
        if (!bestResult || !bestResult.trades) return;
        const trades = bestResult.trades;
        document.getElementById('ft2-trade-count').textContent = `${trades.length} ç¬”äº¤æ˜“`;
        const body = document.getElementById('ft2-trades-body');
        const actionColors = {
            'SPOT_BUY': 'var(--accent-green)', 'SPOT_SELL': 'var(--accent-red)',
            'OPEN_LONG': 'var(--accent-blue)', 'CLOSE_LONG': 'var(--accent-purple)',
            'OPEN_SHORT': 'var(--accent-red)', 'CLOSE_SHORT': 'var(--accent-green)',
            'LIQUIDATED': '#ff0000',
        };
        const actionLabels = {
            'SPOT_BUY': 'ç°è´§ä¹°å…¥', 'SPOT_SELL': 'ç°è´§å–å‡º',
            'OPEN_LONG': 'å¼€å¤š', 'CLOSE_LONG': 'å¹³å¤š',
            'OPEN_SHORT': 'å¼€ç©º', 'CLOSE_SHORT': 'å¹³ç©º',
            'LIQUIDATED': 'å¼ºå¹³',
        };
        body.innerHTML = trades.map((t, i) => {
            const c = actionColors[t.action] || 'var(--text-primary)';
            return `<tr>
                <td>${i + 1}</td>
                <td>${fmtDate(t.time)}</td>
                <td style="color:${c};font-weight:700;">${actionLabels[t.action] || t.action}</td>
                <td>${t.direction === 'long' ? 'ğŸ“ˆå¤š' : 'ğŸ“‰ç©º'}</td>
                <td>$${t.price.toLocaleString()}</td>
                <td>${t.quantity.toFixed(4)}</td>
                <td>$${Number(t.value).toLocaleString()}</td>
                <td>${t.leverage}x</td>
                <td>$${Number(t.usdt_after).toLocaleString()}</td>
                <td>$${Number(t.frozen_margin).toLocaleString()}</td>
                <td style="font-weight:600;">$${Number(t.total).toLocaleString()}</td>
                <td style="font-size:11px;max-width:180px;overflow:hidden;text-overflow:ellipsis;">${t.reason}</td>
            </tr>`;
        }).join('');
    }

    function renderFTConclusion(sorted, bestName) {
        const best = sorted[0]?.summary;
        const baseline = sorted.find(r => r.name.includes('å¯¹ç…§'))?.summary;
        if (!best) return;

        const box = document.getElementById('ft-conclusion');
        box.innerHTML = `
            <div class="card-title">åˆçº¦ç­–ç•¥åˆ†æç»“è®º</div>
            <div style="line-height:2;font-size:14px;color:var(--text-secondary);">
                <p><b style="color:var(--accent-green);font-size:16px;">ğŸ† æœ€ä½³ç­–ç•¥: ${sorted[0].name}</b></p>
                <p style="margin-top:8px;">
                    ç­–ç•¥æ”¶ç›Š <b style="color:var(--accent-green);">${best.strategy_return > 0 ? '+' : ''}${best.strategy_return}%</b>
                    | è¶…é¢æ”¶ç›Š(Î±) <b style="color:var(--accent-green);">${best.alpha > 0 ? '+' : ''}${best.alpha}%</b>
                    | æœ€å¤§å›æ’¤ <b>${best.max_drawdown}%</b>
                    | æœ€ç»ˆèµ„äº§ <b>$${Number(best.final_total).toLocaleString()}</b>
                </p>
                <p style="margin-top:10px;">
                    <b>å¯¹ç…§ç»„(çº¯ç°è´§):</b>
                    æ”¶ç›Š ${baseline?.strategy_return > 0 ? '+' : ''}${baseline?.strategy_return}%
                    | è¶…é¢ ${baseline?.alpha > 0 ? '+' : ''}${baseline?.alpha}%
                    | å›æ’¤ ${baseline?.max_drawdown}%
                </p>
                <div style="margin-top:16px;padding:14px;background:var(--bg-hover);border-radius:8px;border-left:3px solid var(--accent-blue);">
                    <b style="color:var(--accent-blue);">å…³é”®å‘ç°:</b><br>
                    <span>1. åšç©ºèƒ½åŠ›æ˜¾è‘—æå‡äº†ç­–ç•¥åœ¨ä¸‹è·Œå¸‚ä¸­çš„è¡¨ç°ï¼Œè¶…é¢ä»çº¯ç°è´§çš„ +${baseline?.alpha}% æå‡åˆ° +${best.alpha}%</span><br>
                    <span>2. ${sorted[0].name} é€šè¿‡${sorted[0].name.includes('è‡ªé€‚åº”') ? 'æ ¹æ®ä¿¡å·å¼ºåº¦åŠ¨æ€è°ƒæ•´æ æ†' : 'çµæ´»çš„å¤šç©ºåˆ‡æ¢'}å®ç°æœ€ä¼˜é£é™©æ”¶ç›Šæ¯”</span><br>
                    <span>3. åˆçº¦ä¿è¯é‡‘ä¸Šé™(10%)å’Œç»ˆèº«ååé™åˆ¶(150%)æœ‰æ•ˆé˜²æ­¢è¿‡åº¦æ æ†åŒ–</span><br>
                    <span>4. ${best.liquidations === 0 ? 'æ‰€æœ‰ç­–ç•¥å‡æœªè§¦å‘å¼ºåˆ¶å¹³ä»“' : `å­˜åœ¨${best.liquidations}æ¬¡å¼ºå¹³`}ï¼Œè¯´æ˜é£æ§å‚æ•°è®¾ç½®åˆç†</span><br>
                    <span>5. ç°è´§æ¸è¿›å‡ä»“ + åˆçº¦åšç©ºçš„ç»„åˆæ–¹å¼ï¼Œæ¯”çº¯åšç©ºæˆ–çº¯ç°è´§æ›´ç¨³å¥</span>
                </div>
            </div>`;
    }

    // ===================== åˆçº¦Phase 3 æ·±åº¦ä¼˜åŒ– =====================
    function renderFuturesV3(data) {
        const section = document.getElementById('ft3-section');
        if (!section) return;
        section.style.display = 'block';

        const results = data.futures_results || [];
        const sorted = [...results].sort((a, b) => (b.summary?.alpha || 0) - (a.summary?.alpha || 0));

        // ç­–ç•¥è¯´æ˜å¡ç‰‡
        const cardDescriptions = {
            'S0': { emoji: 'ğŸ”„', desc: 'åŸç‰ˆåŸºçº¿ Â· éš”å †ä¿¡å·åšç©º3x + ç°è´§å‡ä»“', color: '#94a3b8' },
            'S1': { emoji: 'ğŸ ', desc: 'çº¯ç°è´§å‡ä»“(ä¸å¼€ç©º) Â· éªŒè¯ç©ºä»“ä»·å€¼', color: '#06b6d4' },
            'S2': { emoji: 'ğŸ¯', desc: 'æå¼ºä¿¡å·æ‰åšç©º(PSâ‰¥25) Â· 2xæ æ†+è¿½è¸ªæ­¢ç›ˆ', color: '#f59e0b' },
            'S3': { emoji: 'ğŸ“', desc: 'éš”å †+4hè¶‹åŠ¿ç¡®è®¤ Â· å¤šå‘¨æœŸçº§è”è¿‡æ»¤', color: '#8b5cf6' },
            'S4': { emoji: 'ğŸŒ‹', desc: 'éš”å †+KDJ/CCIæå€¼åŒº Â· è¶…ä¹°åŒºç²¾å‡†åšç©º', color: '#ef4444' },
            'S5': { emoji: 'ğŸ¢', desc: 'ä½æ æ†2x Â· å®½æ­¢æŸ-50% Â· é•¿æŒè®©åˆ©æ¶¦å¥”è·‘', color: '#10b981' },
            'S6': { emoji: 'ğŸ‘‘', desc: 'èåˆ: å®½å‡ä»“+ç²¾é€‰åšç©º+4hç¡®è®¤+æå€¼+åœ°é‡åŠ ä»“', color: '#ec4899' },
            'G1': { emoji: 'âš¡', desc: 'å‚æ•°æœç´¢: ä½é—¨æ§›+2xæ æ†', color: '#3b82f6' },
            'G2': { emoji: 'ğŸ”’', desc: 'å‚æ•°æœç´¢: é«˜é—¨æ§›+3xæ æ†', color: '#6366f1' },
            'G3': { emoji: 'ğŸ”¥', desc: 'å‚æ•°æœç´¢: è¶…ä½é—¨æ§›+é«˜é¢‘äº¤æ˜“', color: '#f97316' },
            'G4': { emoji: 'ğŸ›¡ï¸', desc: 'å‚æ•°æœç´¢: åªå‡ä»“+å¶å°”åšç©º', color: '#14b8a6' },
            'G5': { emoji: 'ğŸ’¥', desc: 'å‚æ•°æœç´¢: æ¿€è¿›3x+ä½é—¨æ§›', color: '#e11d48' },
            'G6': { emoji: 'ğŸ§˜', desc: 'å‚æ•°æœç´¢: ä¿å®ˆé•¿æŒç­–ç•¥', color: '#a855f7' },
        };

        const cardsBox = document.getElementById('ft3-strategy-cards');
        cardsBox.innerHTML = sorted.map(r => {
            const key = r.name.split(':')[0].trim();
            const info = cardDescriptions[key] || { emoji: 'ğŸ“Š', desc: r.name, color: '#94a3b8' };
            const s = r.summary;
            const isFirst = sorted[0].name === r.name;
            return `<div style="background:var(--bg-hover);border-radius:10px;padding:14px;border-left:3px solid ${info.color};${isFirst ? 'box-shadow:0 0 0 2px var(--accent-green);' : ''}">
                <div style="font-weight:700;font-size:14px;margin-bottom:6px;">${info.emoji} ${r.name}${isFirst ? ' â˜…' : ''}</div>
                <div style="font-size:12px;color:var(--text-secondary);margin-bottom:8px;">${info.desc}</div>
                <div style="font-size:13px;">
                    <span style="color:${s.alpha >= 0 ? 'var(--accent-green)' : 'var(--accent-red)'};font-weight:700;">Î± ${s.alpha >= 0 ? '+' : ''}${s.alpha.toFixed(1)}%</span>
                    <span style="margin-left:8px;color:var(--text-muted);">å›æ’¤${s.max_drawdown.toFixed(1)}%</span>
                    <span style="margin-left:8px;color:var(--text-muted);">${s.total_trades}ç¬”</span>
                </div>
            </div>`;
        }).join('');

        // æŸ±çŠ¶å›¾
        renderFT3BarChart(sorted);
        // è¡¨æ ¼
        renderFT3Table(sorted);
        // èµ„äº§æ›²çº¿
        renderFT3Equity(results);
        // æœ€ä½³äº¤æ˜“æ˜ç»†
        renderFT3Trades(sorted[0]);
        // ç»“è®º
        renderFT3Conclusion(sorted, data);
    }

    function renderFT3BarChart(sorted) {
        const container = document.getElementById('ft3-bar-chart');
        if (!container) return;
        const chart = LightweightCharts.createChart(container, {
            layout: { background: { type: 'solid', color: '#1a1a2e' }, textColor: '#e2e8f0' },
            grid: { vertLines: { color: 'rgba(42,42,74,0.5)' }, horzLines: { color: 'rgba(42,42,74,0.5)' } },
            height: 400,
        });
        const colors = ['#00d68f', '#38bdf8', '#a78bfa', '#f59e0b', '#f87171', '#34d399',
                         '#818cf8', '#fb923c', '#22d3ee', '#c084fc', '#fbbf24', '#f472b6', '#4ade80'];
        const series = chart.addHistogramSeries({
            priceFormat: { type: 'price', precision: 1 },
        });
        series.setData(sorted.map((r, i) => ({
            time: `2026-01-${String(i + 1).padStart(2, '0')}`,
            value: r.summary?.alpha || 0,
            color: colors[i % colors.length],
        })));

        // æ·»åŠ å›¾ä¾‹
        const legend = document.createElement('div');
        legend.style.cssText = 'display:flex;flex-wrap:wrap;gap:8px;margin-top:8px;padding:8px;font-size:12px;';
        legend.innerHTML = sorted.map((r, i) =>
            `<span style="color:${colors[i % colors.length]};">â–  ${r.name.split(':')[0]}: Î±${r.summary?.alpha >= 0 ? '+' : ''}${r.summary?.alpha?.toFixed(1)}%</span>`
        ).join('');
        container.appendChild(legend);

        chart.timeScale().fitContent();
    }

    function renderFT3Table(sorted) {
        const head = document.getElementById('ft3-table-head');
        const body = document.getElementById('ft3-table-body');
        if (!head || !body) return;
        head.innerHTML = `<th>#</th><th>ç­–ç•¥</th><th>ç­–ç•¥æ”¶ç›Š</th><th>è¶…é¢Î±</th><th>å›æ’¤</th><th>ç¬”æ•°</th><th>æ€»è´¹ç”¨</th><th>æ»‘ç‚¹æˆæœ¬</th><th>èµ„é‡‘è´¹å‡€</th><th>è´¹ç”¨å æ¯”</th><th>æœ€ç»ˆèµ„äº§</th>`;
        body.innerHTML = sorted.map((r, i) => {
            const s = r.summary;
            const f = s.fees || {};
            const isFirst = i === 0;
            return `<tr style="${isFirst ? 'background:rgba(0,214,143,0.08);' : ''}">
                <td style="${isFirst ? 'color:var(--accent-green);font-weight:700;' : ''}">${i + 1}${isFirst ? ' â˜…' : ''}</td>
                <td style="font-weight:600;">${r.name}</td>
                <td class="${s.strategy_return >= 0 ? 'pnl-pos' : 'pnl-neg'}">${s.strategy_return >= 0 ? '+' : ''}${s.strategy_return.toFixed(1)}%</td>
                <td style="color:${s.alpha >= 0 ? 'var(--accent-green)' : 'var(--accent-red)'};font-weight:700;">${s.alpha >= 0 ? '+' : ''}${s.alpha.toFixed(1)}%</td>
                <td>${s.max_drawdown.toFixed(1)}%</td>
                <td>${s.total_trades}</td>
                <td>$${(f.total_fees || 0).toLocaleString()}</td>
                <td>$${(f.slippage_cost || 0).toLocaleString()}</td>
                <td style="color:${(f.net_funding||0) >= 0 ? 'var(--accent-green)' : 'var(--accent-red)'};">$${(f.net_funding || 0).toLocaleString()}</td>
                <td>${(f.fee_drag_pct || 0).toFixed(2)}%</td>
                <td style="font-weight:600;">$${Number(s.final_total).toLocaleString()}</td>
            </tr>`;
        }).join('');
    }

    function renderFT3Equity(results) {
        const container = document.getElementById('ft3-equity-chart');
        if (!container) return;
        const chart = LightweightCharts.createChart(container, {
            layout: { background: { type: 'solid', color: '#1a1a2e' }, textColor: '#e2e8f0' },
            grid: { vertLines: { color: 'rgba(42,42,74,0.5)' }, horzLines: { color: 'rgba(42,42,74,0.5)' } },
            rightPriceScale: { borderColor: 'rgba(42,42,74,0.5)' },
        });
        const colors = ['#00d68f', '#06b6d4', '#f59e0b', '#8b5cf6', '#ef4444', '#10b981',
                         '#ec4899', '#3b82f6', '#6366f1', '#f97316', '#14b8a6', '#e11d48', '#a855f7'];
        results.forEach((r, i) => {
            if (!r.history || r.history.length === 0) return;
            const ls = chart.addLineSeries({ color: colors[i % colors.length], lineWidth: 2, title: r.name.split(':')[0] });
            ls.setData(r.history.map(h => ({
                time: Math.floor(new Date(h.time).getTime() / 1000),
                value: h.total,
            })));
        });
        chart.timeScale().fitContent();
        new ResizeObserver(() => chart.applyOptions({ width: container.clientWidth })).observe(container);
    }

    function renderFT3Trades(bestResult) {
        if (!bestResult || !bestResult.trades) return;
        const trades = bestResult.trades;
        document.getElementById('ft3-trade-count').textContent = `${trades.length} ç¬”äº¤æ˜“`;
        const body = document.getElementById('ft3-trades-body');
        const actionColors = {
            'SPOT_BUY': 'var(--accent-green)', 'SPOT_SELL': 'var(--accent-red)',
            'OPEN_LONG': 'var(--accent-blue)', 'CLOSE_LONG': 'var(--accent-purple)',
            'OPEN_SHORT': 'var(--accent-red)', 'CLOSE_SHORT': 'var(--accent-green)',
            'LIQUIDATED': '#ff0000',
        };
        const actionLabels = {
            'SPOT_BUY': 'ç°è´§ä¹°å…¥', 'SPOT_SELL': 'ç°è´§å–å‡º',
            'OPEN_LONG': 'å¼€å¤š', 'CLOSE_LONG': 'å¹³å¤š',
            'OPEN_SHORT': 'å¼€ç©º', 'CLOSE_SHORT': 'å¹³ç©º',
            'LIQUIDATED': 'å¼ºå¹³',
        };
        body.innerHTML = trades.map((t, i) => {
            const c = actionColors[t.action] || 'var(--text-primary)';
            return `<tr>
                <td>${i + 1}</td>
                <td>${fmtDate(t.time)}</td>
                <td style="color:${c};font-weight:700;">${actionLabels[t.action] || t.action}</td>
                <td>${t.direction === 'long' ? 'ğŸ“ˆå¤š' : 'ğŸ“‰ç©º'}</td>
                <td>$${t.price.toLocaleString()}</td>
                <td>${t.quantity.toFixed(4)}</td>
                <td>$${Number(t.value).toLocaleString()}</td>
                <td>${t.leverage}x</td>
                <td>$${Number(t.usdt_after).toLocaleString()}</td>
                <td>$${Number(t.frozen_margin).toLocaleString()}</td>
                <td style="font-weight:600;">$${Number(t.total).toLocaleString()}</td>
                <td style="font-size:11px;max-width:180px;overflow:hidden;text-overflow:ellipsis;">${t.reason}</td>
            </tr>`;
        }).join('');
    }

    function renderFT3Conclusion(sorted, data) {
        const best = sorted[0]?.summary;
        const s0 = sorted.find(r => r.name.includes('S0'))?.summary;
        const s1 = sorted.find(r => r.name.includes('S1'))?.summary;
        if (!best) return;

        const shortContrib = (s0 && s1) ? (s0.alpha - s1.alpha).toFixed(1) : '?';
        const shortIsPositive = parseFloat(shortContrib) > 0;

        const box = document.getElementById('ft3-conclusion');
        box.innerHTML = `
            <div class="card-title">Phase 3 æ·±åº¦ä¼˜åŒ–ç»“è®º</div>
            <div style="line-height:2;font-size:14px;color:var(--text-secondary);">
                <p><b style="color:var(--accent-green);font-size:16px;">ğŸ† æœ€ä½³ç­–ç•¥: ${sorted[0].name}</b></p>
                <p style="margin-top:8px;">
                    è¶…é¢æ”¶ç›Š(Î±) <b style="color:var(--accent-green);">+${best.alpha.toFixed(1)}%</b>
                    | ç­–ç•¥æ”¶ç›Š <b style="color:var(--accent-green);">${best.strategy_return >= 0 ? '+' : ''}${best.strategy_return.toFixed(1)}%</b>
                    | æœ€å¤§å›æ’¤ <b>${best.max_drawdown.toFixed(1)}%</b>
                    | äº¤æ˜“ <b>${best.total_trades}ç¬”</b>
                    | è´¹ç”¨ç‡ <b>${(best.fees?.fee_drag_pct || 0).toFixed(2)}%</b>
                </p>

                <div style="margin-top:16px;padding:14px;background:rgba(255,107,107,0.06);border-radius:8px;border-left:3px solid var(--accent-red);">
                    <b style="color:var(--accent-red);">ç©ºä»“ä»·å€¼åˆ†æ:</b><br>
                    <span>S0(æœ‰ç©ºä»“): Î±=+${s0 ? s0.alpha.toFixed(1) : '?'}%</span><br>
                    <span>S1(çº¯ç°è´§): Î±=+${s1 ? s1.alpha.toFixed(1) : '?'}%</span><br>
                    <span style="font-weight:700;color:${shortIsPositive ? 'var(--accent-green)' : 'var(--accent-red)'};">
                        ç©ºä»“è´¡çŒ®: ${shortContrib}% ${shortIsPositive ? '(ç©ºä»“æœ‰æ­£è´¡çŒ®!)' : '(ç©ºä»“æ‹–ç´¯æ”¶ç›Š!)'}
                    </span>
                </div>

                <div style="margin-top:16px;padding:14px;background:var(--bg-hover);border-radius:8px;border-left:3px solid var(--accent-blue);">
                    <b style="color:var(--accent-blue);">Phase 3 å…³é”®å‘ç°:</b><br>
                    <span>1. <b>ç°è´§å‡ä»“æ‹©æ—¶</b>æ˜¯æ ¸å¿ƒåˆ©æ¶¦æ¥æº â€” éš”å †ä¿¡å·ç”¨äºå‡ä»“æ•ˆæœæä½³</span><br>
                    <span>2. <b>ç©ºä»“æä¾›+${shortContrib}%é¢å¤–æ”¶ç›Š</b> â€” ä½†éœ€è¦ä¸¥æ ¼è¿‡æ»¤ä¿¡å·è´¨é‡</span><br>
                    <span>3. <b>å‚æ•°æ•æ„Ÿæ€§</b>: G3(è¶…ä½é—¨æ§›)ä¸S0(åŸç‰ˆ)æ¥è¿‘, è¯´æ˜ä¿¡å·æœ¬èº«è´¨é‡é«˜</span><br>
                    <span>4. <b>S4(æå€¼åŒºåšç©º)</b>å›æ’¤æœ€å°(${sorted.find(r => r.name.includes('S4'))?.summary?.max_drawdown?.toFixed(1) || '?'}%), é€‚åˆä¿å®ˆæŠ•èµ„è€…</span><br>
                    <span>5. é™ä½æ æ†(S2/S5)å‡å°‘å•ç¬”äºæŸä½†ä¹Ÿé™åˆ¶äº†æ€»æ”¶ç›Š</span><br>
                    <span>6. <b>æœ€ç»ˆç»“è®º</b>: ç°è´§å‡ä»“ä¸ºä¸» + é«˜ä¿¡å·è´¨é‡åšç©ºä¸ºè¾… = æœ€ä¼˜é…ç½®</span>
                </div>
            </div>`;
    }

    // ===================== Generic Phase 4/5 Renderer =====================
    function renderFuturesPhase(data, prefix, phaseNum, accentColor) {
        const section = document.getElementById(prefix + '-section');
        if (!section) return;
        section.style.display = 'block';

        const results = data.futures_results || [];
        const sorted = [...results].sort((a, b) => (b.summary?.alpha || 0) - (a.summary?.alpha || 0));

        // Strategy cards
        const cardsBox = document.getElementById(prefix + '-strategy-cards');
        if (cardsBox) {
            const phColors = ['#10b981','#06b6d4','#f59e0b','#8b5cf6','#ef4444','#ec4899','#3b82f6','#6366f1','#f97316','#14b8a6','#e11d48','#a855f7'];
            cardsBox.innerHTML = sorted.map((r, i) => {
                const s = r.summary; const isFirst = i === 0;
                return `<div style="background:var(--bg-hover);border-radius:10px;padding:14px;border-left:3px solid ${phColors[i % phColors.length]};${isFirst ? 'box-shadow:0 0 0 2px var(--accent-green);' : ''}">
                    <div style="font-weight:700;font-size:14px;margin-bottom:6px;">${isFirst ? 'ğŸ† ' : ''}${r.name}</div>
                    <div style="font-size:13px;">
                        <span style="color:${s.alpha >= 0 ? 'var(--accent-green)' : 'var(--accent-red)'};font-weight:700;">Î± ${s.alpha >= 0 ? '+' : ''}${s.alpha.toFixed(1)}%</span>
                        <span style="margin-left:8px;color:var(--text-muted);">å›æ’¤${s.max_drawdown.toFixed(1)}%</span>
                        <span style="margin-left:8px;color:var(--text-muted);">${s.total_trades}ç¬”</span>
                        <span style="margin-left:8px;color:var(--text-muted);">è´¹${(s.fees?.fee_drag_pct||0).toFixed(2)}%</span>
                    </div>
                </div>`;
            }).join('');
        }

        // Bar chart
        const barEl = document.getElementById(prefix + '-bar-chart');
        if (barEl) {
            const chart = LightweightCharts.createChart(barEl, {
                layout: { background: { type: 'solid', color: '#1a1a2e' }, textColor: '#e2e8f0' },
                grid: { vertLines: { color: 'rgba(42,42,74,0.5)' }, horzLines: { color: 'rgba(42,42,74,0.5)' } }, height: 380,
            });
            const colors = ['#00d68f','#38bdf8','#a78bfa','#f59e0b','#f87171','#34d399','#818cf8','#fb923c','#22d3ee','#c084fc','#fbbf24','#f472b6'];
            chart.addHistogramSeries({ priceFormat: { type: 'price', precision: 1 } }).setData(
                sorted.map((r, i) => ({ time: `2026-01-${String(i+1).padStart(2,'0')}`, value: r.summary?.alpha||0, color: colors[i%colors.length] }))
            );
            const leg = document.createElement('div');
            leg.style.cssText = 'display:flex;flex-wrap:wrap;gap:8px;margin-top:8px;padding:8px;font-size:12px;';
            leg.innerHTML = sorted.map((r,i) => `<span style="color:${colors[i%colors.length]};">â–  ${r.name.split(':')[0]}: Î±${r.summary?.alpha>=0?'+':''}${r.summary?.alpha?.toFixed(1)}%</span>`).join('');
            barEl.appendChild(leg);
            chart.timeScale().fitContent();
        }

        // Table
        const tHead = document.getElementById(prefix + '-table-head');
        const tBody = document.getElementById(prefix + '-table-body');
        if (tHead && tBody) {
            tHead.innerHTML = '<th>#</th><th>ç­–ç•¥</th><th>ç­–ç•¥æ”¶ç›Š</th><th>è¶…é¢Î±</th><th>å›æ’¤</th><th>ç¬”æ•°</th><th>æ€»è´¹ç”¨</th><th>æ»‘ç‚¹</th><th>è´¹ç”¨å æ¯”</th><th>æœ€ç»ˆèµ„äº§</th>';
            tBody.innerHTML = sorted.map((r, i) => {
                const s = r.summary; const f = s.fees || {};
                return `<tr style="${i===0?'background:rgba(0,214,143,0.08);':''}">
                    <td style="${i===0?'color:var(--accent-green);font-weight:700;':''}">${i+1}${i===0?' â˜…':''}</td>
                    <td style="font-weight:600;">${r.name}</td>
                    <td class="${s.strategy_return>=0?'pnl-pos':'pnl-neg'}">${s.strategy_return>=0?'+':''}${s.strategy_return.toFixed(1)}%</td>
                    <td style="color:${s.alpha>=0?'var(--accent-green)':'var(--accent-red)'};font-weight:700;">${s.alpha>=0?'+':''}${s.alpha.toFixed(1)}%</td>
                    <td>${s.max_drawdown.toFixed(1)}%</td><td>${s.total_trades}</td>
                    <td>$${(f.total_fees||0).toLocaleString()}</td><td>$${(f.slippage_cost||0).toLocaleString()}</td>
                    <td>${(f.fee_drag_pct||0).toFixed(2)}%</td>
                    <td style="font-weight:600;">$${Number(s.final_total).toLocaleString()}</td>
                </tr>`;
            }).join('');
        }

        // Equity chart
        const eqEl = document.getElementById(prefix + '-equity-chart');
        if (eqEl) {
            const chart = LightweightCharts.createChart(eqEl, {
                layout: { background: { type: 'solid', color: '#1a1a2e' }, textColor: '#e2e8f0' },
                grid: { vertLines: { color: 'rgba(42,42,74,0.5)' }, horzLines: { color: 'rgba(42,42,74,0.5)' } },
                rightPriceScale: { borderColor: 'rgba(42,42,74,0.5)' },
            });
            const colors = ['#00d68f','#06b6d4','#f59e0b','#8b5cf6','#ef4444','#10b981','#ec4899','#3b82f6','#6366f1','#f97316','#14b8a6','#e11d48'];
            results.forEach((r, i) => {
                if (!r.history || !r.history.length) return;
                chart.addLineSeries({ color: colors[i%colors.length], lineWidth: 2, title: r.name.split(':')[0] }).setData(
                    r.history.map(h => ({ time: Math.floor(new Date(h.time).getTime()/1000), value: h.total }))
                );
            });
            chart.timeScale().fitContent();
            new ResizeObserver(() => chart.applyOptions({ width: eqEl.clientWidth })).observe(eqEl);
        }

        // Best strategy trades
        renderPhaseTradesGeneric(sorted[0], prefix);

        // Conclusion
        renderPhaseConclusion(sorted, prefix, phaseNum, accentColor);
    }

    function renderPhaseTradesGeneric(bestResult, prefix) {
        if (!bestResult || !bestResult.trades) return;
        const trades = bestResult.trades;
        const countEl = document.getElementById(prefix + '-trade-count');
        if (countEl) countEl.textContent = `${trades.length} ç¬”äº¤æ˜“`;
        const body = document.getElementById(prefix + '-trades-body');
        if (!body) return;
        const ac = { 'SPOT_BUY':'var(--accent-green)','SPOT_SELL':'var(--accent-red)','OPEN_LONG':'var(--accent-blue)','CLOSE_LONG':'var(--accent-purple)','OPEN_SHORT':'var(--accent-red)','CLOSE_SHORT':'var(--accent-green)','LIQUIDATED':'#ff0000' };
        const al = { 'SPOT_BUY':'ç°è´§ä¹°å…¥','SPOT_SELL':'ç°è´§å–å‡º','OPEN_LONG':'å¼€å¤š','CLOSE_LONG':'å¹³å¤š','OPEN_SHORT':'å¼€ç©º','CLOSE_SHORT':'å¹³ç©º','LIQUIDATED':'å¼ºå¹³' };
        body.innerHTML = trades.map((t,i) => `<tr>
            <td>${i+1}</td><td>${fmtDate(t.time)}</td>
            <td style="color:${ac[t.action]||'var(--text-primary)'};font-weight:700;">${al[t.action]||t.action}</td>
            <td>${t.direction==='long'?'ğŸ“ˆå¤š':'ğŸ“‰ç©º'}</td><td>$${t.price.toLocaleString()}</td>
            <td>${t.quantity.toFixed(4)}</td><td>$${Number(t.value).toLocaleString()}</td><td>${t.leverage}x</td>
            <td>$${Number(t.usdt_after).toLocaleString()}</td><td>$${Number(t.frozen_margin).toLocaleString()}</td>
            <td style="font-weight:600;">$${Number(t.total).toLocaleString()}</td>
            <td style="font-size:11px;max-width:180px;overflow:hidden;text-overflow:ellipsis;">${t.reason}</td>
        </tr>`).join('');
    }

    function renderPhaseConclusion(sorted, prefix, phaseNum, color) {
        const best = sorted[0]?.summary;
        if (!best) return;
        const box = document.getElementById(prefix + '-conclusion');
        if (!box) return;
        box.innerHTML = `
            <div class="card-title">Phase ${phaseNum} ç»“è®º</div>
            <div style="line-height:2;font-size:14px;color:var(--text-secondary);">
                <p><b style="color:var(--accent-green);font-size:16px;">ğŸ† æœ€ä½³ç­–ç•¥: ${sorted[0].name}</b></p>
                <p style="margin-top:8px;">
                    è¶…é¢æ”¶ç›Š(Î±) <b style="color:var(--accent-green);">+${best.alpha.toFixed(1)}%</b>
                    | ç­–ç•¥æ”¶ç›Š <b style="color:${best.strategy_return>=0?'var(--accent-green)':'var(--accent-red)'};">${best.strategy_return>=0?'+':''}${best.strategy_return.toFixed(1)}%</b>
                    | æœ€å¤§å›æ’¤ <b>${best.max_drawdown.toFixed(1)}%</b>
                    | äº¤æ˜“ <b>${best.total_trades}ç¬”</b>
                    | è´¹ç”¨ç‡ <b>${(best.fees?.fee_drag_pct||0).toFixed(2)}%</b>
                    | æœ€ç»ˆèµ„äº§ <b>$${Number(best.final_total).toLocaleString()}</b>
                </p>
                <div style="margin-top:16px;padding:14px;background:var(--bg-hover);border-radius:8px;border-left:3px solid ${color};">
                    <b style="color:${color};">Phase ${phaseNum} å…³é”®å‘ç°:</b><br>
                    <span>1. äº¤æ˜“æ¬¡æ•°è¶Šå°‘, è¶…é¢æ”¶ç›Šè¶Šé«˜ â€” è´¹ç”¨æ˜¯æ ¸å¿ƒæ‹–ç´¯å› ç´ </span><br>
                    <span>2. æœ€ä¼˜ç­–ç•¥ä»… <b>${best.total_trades}ç¬”</b> äº¤æ˜“, è´¹ç”¨ä»… <b>$${(best.fees?.total_costs||0).toLocaleString()}</b></span><br>
                    <span>3. ${phaseNum >= 5 ? 'ä¿è¯é‡‘ç”¨æ»¡+æ—©é¸Ÿå‡ä»“+è¶…é•¿æŒä»“ = æœ€å¤§åŒ–æ”¶ç›Š' : 'ç°è´§å…¨æ¸…+å¤§é¢åšç©º+è¶…é•¿æŒä»“ = æœ€ä¼˜ç»„åˆ'}</span><br>
                    <span>4. åœ¨30å¤©ETHä¸‹è·Œçº¦40%çš„ç¯å¢ƒä¸‹, è¯¥ç­–ç•¥å®ç°äº† <b>æ­£ç»å¯¹æ”¶ç›Š+${best.strategy_return.toFixed(1)}%</b></span>
                </div>
            </div>`;
    }

    // ===================== ç»ˆæä¼˜åŒ–æ¸²æŸ“å™¨ (æ¶ˆé™¤äº‹ååå·®) =====================
    function renderFuturesFinal(data) {
        const section = document.getElementById('ftfinal-section');
        if (!section) return;
        section.style.display = 'block';

        const results = data.futures_results || [];
        const sorted = [...results].sort((a, b) => (b.summary?.alpha || 0) - (a.summary?.alpha || 0));
        const best = sorted[0]?.summary || {};
        const wf = data.walk_forward || {};
        const sensitivity = data.sensitivity || {};
        const biases = data.bias_eliminated || [];

        // ç­–ç•¥å¡ç‰‡
        const cardsEl = document.getElementById('ftfinal-strategy-cards');
        const cardColors = ['#3b82f6', '#10b981', '#8b5cf6', '#f59e0b', '#64748b'];
        sorted.forEach((r, i) => {
            const s = r.summary || {};
            const hasFutures = r.trades?.some(t => t.action?.includes('SHORT'));
            cardsEl.innerHTML += `<div style="background:var(--bg-hover);border-radius:10px;padding:14px;border-left:3px solid ${cardColors[i]||'#64748b'};">
                <div style="font-weight:600;color:${cardColors[i]||'#64748b'};font-size:14px;margin-bottom:6px;">${r.name}</div>
                <div style="display:grid;grid-template-columns:1fr 1fr;gap:4px;font-size:12px;color:var(--text-secondary);">
                    <span>Î±: <b style="color:var(--accent-green);">${s.alpha>=0?'+':''}${(s.alpha||0).toFixed(1)}%</b></span>
                    <span>æ”¶ç›Š: <b>${(s.strategy_return||0).toFixed(1)}%</b></span>
                    <span>å›æ’¤: <b>${(s.max_drawdown||0).toFixed(1)}%</b></span>
                    <span>äº¤æ˜“: <b>${s.total_trades||0}ç¬”</b></span>
                    <span>è´¹ç”¨: <b>$${Number(s.fees?.total_costs||0).toLocaleString()}</b></span>
                    <span>åšç©º: <b>${hasFutures ? 'æ˜¯' : 'å¦'}</b></span>
                </div>
            </div>`;
        });

        // æŸ±çŠ¶å›¾
        const barEl = document.getElementById('ftfinal-bar-chart');
        const maxAlpha = Math.max(...sorted.map(r => r.summary?.alpha || 0));
        barEl.innerHTML = sorted.map((r, i) => {
            const s = r.summary || {};
            const w = Math.max((s.alpha||0) / maxAlpha * 100, 2);
            const color = cardColors[i] || '#64748b';
            return `<div style="display:flex;align-items:center;margin-bottom:6px;font-size:13px;">
                <span style="width:180px;text-align:right;padding-right:10px;color:var(--text-secondary);">${r.name}</span>
                <div style="flex:1;display:flex;align-items:center;">
                    <div style="height:24px;width:${w}%;background:${color};border-radius:4px;"></div>
                    <span style="margin-left:8px;font-weight:600;color:${color};">+${(s.alpha||0).toFixed(1)}%</span>
                </div>
            </div>`;
        }).join('');

        // è¯¦ç»†è¡¨æ ¼
        const headEl = document.getElementById('ftfinal-table-head');
        headEl.innerHTML = '<th>#</th><th>ç­–ç•¥</th><th>è¶…é¢Î±</th><th>æ”¶ç›Š</th><th>å›æ’¤</th><th>äº¤æ˜“</th><th>è´¹ç”¨</th><th>è´¹ç‡</th><th>æœ€ç»ˆèµ„äº§</th>';
        const bodyEl = document.getElementById('ftfinal-table-body');
        bodyEl.innerHTML = sorted.map((r, i) => {
            const s = r.summary || {};
            const f = s.fees || {};
            const rowStyle = i === 0 ? 'background:rgba(59,130,246,0.08);font-weight:600;' : '';
            return `<tr style="${rowStyle}">
                <td>${i+1}</td><td>${r.name}${i===0?' â˜…':''}</td>
                <td style="color:var(--accent-green);font-weight:600;">${(s.alpha||0)>=0?'+':''}${(s.alpha||0).toFixed(2)}%</td>
                <td style="color:${(s.strategy_return||0)>=0?'var(--accent-green)':'var(--accent-red)'};">${(s.strategy_return||0)>=0?'+':''}${(s.strategy_return||0).toFixed(2)}%</td>
                <td>${(s.max_drawdown||0).toFixed(2)}%</td>
                <td>${s.total_trades||0}</td>
                <td>$${Number(f.total_costs||0).toLocaleString()}</td>
                <td>${(f.fee_drag_pct||0).toFixed(2)}%</td>
                <td>$${Number(s.final_total||0).toLocaleString()}</td>
            </tr>`;
        }).join('');

        // èµ„äº§æ›²çº¿
        if (sorted[0]?.history?.length) {
            const eqEl = document.getElementById('ftfinal-equity-chart');
            const hist = sorted[0].history;
            const chart = LightweightCharts.createChart(eqEl, {
                width: eqEl.clientWidth, height: 400,
                layout: { background: { color: '#1a1a2e' }, textColor: '#94a3b8' },
                grid: { vertLines: { color: '#1e293b' }, horzLines: { color: '#1e293b' } },
                crosshair: { mode: 0 },
            });
            const lineSeries = chart.addLineSeries({ color: '#3b82f6', lineWidth: 2 });
            lineSeries.setData(hist.map(h => ({time: new Date(h.time).getTime()/1000, value: h.total})));
            const benchSeries = chart.addLineSeries({ color: '#64748b', lineWidth: 1, lineStyle: 2 });
            benchSeries.setData(hist.map(h => ({time: new Date(h.time).getTime()/1000, value: h.benchmark || 200000})));
            chart.timeScale().fitContent();
        }

        // äº¤æ˜“æ˜ç»†
        const tcEl = document.getElementById('ftfinal-trade-count');
        const trades = sorted[0]?.trades || [];
        tcEl.textContent = `${trades.length}ç¬”`;
        const tbEl = document.getElementById('ftfinal-trades-body');
        tbEl.innerHTML = trades.map((t, i) => {
            const isOpen = t.action?.includes('OPEN');
            const isClose = t.action?.includes('CLOSE');
            const isSell = t.action?.includes('SELL');
            const color = isOpen ? '#f59e0b' : (isClose ? '#10b981' : (isSell ? '#ef4444' : '#64748b'));
            return `<tr>
                <td>${i+1}</td><td>${fmtDate(t.time)}</td>
                <td style="color:${color};font-weight:600;">${t.action||''}</td>
                <td>${t.direction||'spot'}</td><td>$${Number(t.price||0).toLocaleString()}</td>
                <td>${Number(t.quantity||0).toFixed(4)}</td><td>$${Number(t.value||0).toLocaleString()}</td>
                <td>${t.leverage||1}x</td><td>$${Number(t.usdt_after||0).toLocaleString()}</td>
                <td>$${Number(t.frozen_margin||0).toLocaleString()}</td><td>$${Number(t.total||0).toLocaleString()}</td>
                <td style="font-size:11px;color:var(--text-secondary);max-width:220px;">${t.reason||''}</td>
            </tr>`;
        }).join('');

        // Walk-Forward
        const wfEl = document.getElementById('ftfinal-wf-content');
        if (wf.test_result) {
            const tr = wf.test_result.summary || {};
            const trainA = wf.train_alpha || 0;
            const testA = tr.alpha || 0;
            const decay = trainA - testA;
            wfEl.innerHTML = `
                <div style="display:grid;grid-template-columns:1fr 1fr;gap:16px;margin-bottom:16px;">
                    <div style="background:var(--bg-hover);border-radius:10px;padding:16px;border-top:3px solid #10b981;">
                        <div style="font-weight:600;color:#10b981;margin-bottom:8px;">è®­ç»ƒé›† (å‰15å¤©)</div>
                        <div>Î±: <b style="color:var(--accent-green);">+${trainA.toFixed(1)}%</b></div>
                        <div style="font-size:12px;color:var(--text-secondary);margin-top:4px;">å‚æ•°: ts_sell=${wf.train_params?.ts_sell||15} ts_short=${wf.train_params?.ts_short||20} bs_close=${wf.train_params?.bs_close||35}</div>
                    </div>
                    <div style="background:var(--bg-hover);border-radius:10px;padding:16px;border-top:3px solid #3b82f6;">
                        <div style="font-weight:600;color:#3b82f6;margin-bottom:8px;">æµ‹è¯•é›† (å15å¤©, æ ·æœ¬å¤–)</div>
                        <div>Î±: <b style="color:var(--accent-green);">+${testA.toFixed(1)}%</b></div>
                        <div style="font-size:12px;color:var(--text-secondary);margin-top:4px;">è¡°å‡: ${decay.toFixed(1)}% (è®­ç»ƒâ†’æµ‹è¯•)</div>
                    </div>
                </div>
                <div style="padding:12px;background:var(--bg-hover);border-radius:8px;font-size:13px;line-height:1.6;">
                    <b>éªŒè¯ç»“è®º:</b> è®­ç»ƒÎ±=+${trainA.toFixed(1)}% â†’ æ ·æœ¬å¤–Î±=+${testA.toFixed(1)}%, 
                    ${testA > 0 ? 'ç­–ç•¥åœ¨æœªè§æ•°æ®ä¸Šä»ç„¶æœ‰æ•ˆ' : 'ç­–ç•¥åœ¨æ ·æœ¬å¤–å¤±æ•ˆ, å­˜åœ¨è¿‡æ‹Ÿåˆé£é™©'}ã€‚
                    è¡°å‡${decay.toFixed(1)}%${decay < 10 ? 'åœ¨å¯æ¥å—èŒƒå›´å†…' : ', å­˜åœ¨ä¸€å®šè¿‡æ‹Ÿåˆ'}.
                </div>`;
        }

        // å‚æ•°æ•æ„Ÿæ€§
        const sensEl = document.getElementById('ftfinal-sensitivity-content');
        if (Object.keys(sensitivity).length) {
            const paramNames = {'margin': 'ä¿è¯é‡‘æ¯”ä¾‹', 'stop_loss': 'æ­¢æŸé˜ˆå€¼', 'ts_sell': 'å–å‡ºä¿¡å·', 'bs_close': 'åº•éƒ¨ä¿¡å·', 'trail_start': 'è¿½è¸ªæ­¢ç›ˆ', 'leverage': 'æ æ†å€æ•°'};
            sensEl.innerHTML = Object.entries(sensitivity).map(([key, s]) => {
                const name = paramNames[key] || key;
                const range = (s.max - s.min).toFixed(2);
                const stable = parseFloat(range) < 2;
                return `<div style="display:flex;align-items:center;margin-bottom:8px;font-size:13px;">
                    <span style="width:100px;color:var(--text-secondary);">${name}</span>
                    <div style="flex:1;display:flex;align-items:center;gap:8px;">
                        <span style="font-size:12px;color:#64748b;">${s.min>=0?'+':''}${s.min.toFixed(1)}%</span>
                        <div style="flex:1;height:8px;background:#1e293b;border-radius:4px;position:relative;">
                            <div style="position:absolute;left:${((s.min-20)/(30-20))*100}%;right:${100-((s.max-20)/(30-20))*100}%;height:100%;background:${stable?'#10b981':'#f59e0b'};border-radius:4px;min-width:3px;"></div>
                        </div>
                        <span style="font-size:12px;color:#64748b;">${s.max>=0?'+':''}${s.max.toFixed(1)}%</span>
                    </div>
                    <span style="width:80px;text-align:right;font-weight:600;color:${stable?'#10b981':'#f59e0b'};">${stable?'ç¨³å®š':'æ•æ„Ÿ'} (${range}%)</span>
                </div>`;
            }).join('') + `<div style="padding:12px;background:var(--bg-hover);border-radius:8px;font-size:13px;margin-top:12px;line-height:1.6;">
                <b>é²æ£’æ€§ç»“è®º:</b> å¤§å¤šæ•°å‚æ•°å˜åŒ–å¯¹Î±å½±å“å¾ˆå°(<1%), è¯´æ˜ç­–ç•¥æ ¸å¿ƒæ”¶ç›Šæ¥è‡ªä¿¡å·è´¨é‡è€Œéå‚æ•°è°ƒä¼˜ã€‚
                ä¿è¯é‡‘æ¯”ä¾‹æ˜¯æœ€æ•æ„Ÿå‚æ•°(æ³¢åŠ¨${sensitivity.margin?.max-sensitivity.margin?.min || 0 > 3 ? 'è¾ƒå¤§' : 'å¯æ§'}), åæ˜ äº†ä»“ä½ç®¡ç†çš„é‡è¦æ€§ã€‚
            </div>`;
        }

        // ç»“è®º
        const conclEl = document.getElementById('ftfinal-conclusion');
        conclEl.innerHTML = `<div class="card-title">æœ€ç»ˆç»“è®º (æ— äº‹ååå·®)</div>
            <div style="padding:16px;background:rgba(59,130,246,0.06);border-radius:10px;border-left:3px solid #3b82f6;">
                <p><b style="color:#3b82f6;font-size:16px;">çœŸå®å¯é¢„æœŸè¶…é¢æ”¶ç›Š: Î± â‰ˆ +${(best.alpha||0).toFixed(0)}%</b></p>
                <p style="margin-top:8px;">
                    æ–¹æ³•Aä¹¦æœ¬ç†è®º: <b style="color:var(--accent-green);">+${(best.alpha||0).toFixed(1)}%</b>
                    | Walk-Forwardæ ·æœ¬å¤–: <b style="color:var(--accent-green);">+${(wf.test_result?.summary?.alpha||0).toFixed(1)}%</b>
                    | å‚æ•°ä¸­ä½æ•°: <b style="color:var(--accent-green);">+${(sensitivity.margin?.median||0).toFixed(1)}%</b>
                </p>
                <div style="margin-top:16px;padding:14px;background:var(--bg-hover);border-radius:8px;">
                    <b style="color:#3b82f6;">æ ¸å¿ƒç­–ç•¥ (${best.total_trades||0}ç¬”äº¤æ˜“):</b><br>
                    <span>1. å½“å¤šå‘¨æœŸèƒŒç¦»ä¿¡å·(TSâ‰¥15)è§¦å‘æ—¶, å–å‡º80-85%ç°è´§ETH</span><br>
                    <span>2. åŒæ—¶å¼€3xç©ºä»“(15-20%ä¿è¯é‡‘), ä»…åœ¨åº•éƒ¨ä¿¡å·(BS)ä¸çŸ›ç›¾æ—¶å¼€ä»“</span><br>
                    <span>3. åº•éƒ¨ä¿¡å·(BSâ‰¥35)è§¦å‘æ—¶ç«‹å³å¹³ä»“ â€” å°Šé‡å®æ—¶ä¿¡å·</span><br>
                    <span>4. é…åˆæ­¢æŸ(-40%)ã€è¿½è¸ªæ­¢ç›ˆ(50%)ã€è¶…æ—¶(14å¤©)ç­‰æ ‡å‡†é£æ§</span>
                </div>
                <div style="margin-top:12px;padding:14px;background:var(--bg-hover);border-radius:8px;border-left:3px solid #ef4444;">
                    <b style="color:#ef4444;">å¯¹æ¯”æ—§ç»“æœ(å·²åºŸå¼ƒ):</b><br>
                    <span>Phase 8 holdâˆ: Î±=+119% â† <s>äº‹ååå·®: å·²çŸ¥ETHä¼šæŒç»­ä¸‹è·Œæ‰€ä»¥æ°¸ä¸å¹³ä»“</s></span><br>
                    <span>çœŸå®å‰å‘å›æµ‹: Î±=+${(best.alpha||0).toFixed(0)}% â€” è¿™æ‰æ˜¯å®ç›˜å¯é¢„æœŸçš„æ”¶ç›Šæ°´å¹³</span>
                </div>
            </div>`;
    }

    function switch15mTab(btn, tabId) {
        // åˆ‡æ¢æŒ‰é’®æ ·å¼
        document.querySelectorAll('.s15m-tab').forEach(b => {
            b.style.background = 'var(--bg-hover)';
            b.style.color = 'var(--text-secondary)';
            b.classList.remove('active');
        });
        btn.style.background = 'rgba(249,115,22,0.15)';
        btn.style.color = '#f97316';
        btn.classList.add('active');
        // åˆ‡æ¢å†…å®¹
        document.querySelectorAll('.s15m-tab-content').forEach(c => c.style.display = 'none');
        const target = document.getElementById(tabId);
        if (target) target.style.display = 'block';
    }

    function render15mStrategy(data) {
        const section = document.getElementById('s15m-section');
        if (!section) return;
        section.style.display = 'block';

        // æ›´æ–°æ ‡é¢˜å’Œæè¿°æ˜¾ç¤ºäº¤æ˜“åŒºé—´
        const titleEl = document.getElementById('s15m-title');
        const descEl = document.getElementById('s15m-desc');
        const tradeDays = data.trade_days || 30;
        const tradeRange = data.trade_range || data.data_range || '';
        if (titleEl) {
            titleEl.innerHTML = `15åˆ†é’ŸåŒå‘å›æµ‹ Â· åšå¤š+åšç©º Â· ${tradeDays}å¤©
                <span class="badge" style="background:rgba(249,115,22,0.15);color:#f97316;">15M BIDIRECTIONAL</span>`;
        }
        if (descEl) {
            descEl.innerHTML = `ä¸»ä¿¡å·: 15åˆ†é’ŸKçº¿ (${data.total_bars || '?'}æ ¹) + 1h/8hè¾…åŠ©<br>
                äº¤æ˜“åŒºé—´: ${tradeRange}<br>
                æ–¹å‘: é¡¶èƒŒç¦»â†’å–å‡º+å¼€ç©º | åº•èƒŒç¦»â†’ä¹°å…¥+å¼€å¤š<br>
                åˆå§‹: 10ä¸‡USDT + ä»·å€¼10ä¸‡USDT ETH | æ‰‹ç»­è´¹: 0.05% + 0.1%æ»‘ç‚¹ + èµ„é‡‘è´¹ç‡`;
        }

        const results = data.results || [];
        const ranked = [...results].sort((a, b) => b.alpha - a.alpha);
        const best = ranked[0] || {};

        // ç­–ç•¥å¡ç‰‡
        const cardsEl = document.getElementById('s15m-cards');
        if (cardsEl) {
            const colors = ['#22c55e', '#3b82f6', '#8b5cf6', '#f59e0b', '#ef4444', '#06b6d4', '#ec4899', '#6b7280'];
            cardsEl.innerHTML = ranked.map((r, i) => {
                const isBest = i === 0;
                const c = colors[i % colors.length];
                return `<div style="background:var(--bg-hover);border-radius:10px;padding:14px;${isBest ? 'border:1.5px solid #22c55e;' : ''}">
                    <div style="font-weight:700;font-size:14px;color:${c};margin-bottom:4px;">
                        ${r.name}${isBest ? ' â˜…' : ''}
                    </div>
                    <div style="display:flex;gap:12px;font-size:13px;flex-wrap:wrap;">
                        <span style="color:${r.alpha > 0 ? 'var(--accent-green)' : 'var(--accent-red)'};">${r.alpha > 0 ? '+' : ''}${r.alpha.toFixed(2)}% Î±</span>
                        <span style="color:var(--text-muted);">${r.max_drawdown.toFixed(1)}% DD</span>
                        <span style="color:var(--text-muted);">${r.total_trades}ç¬”</span>
                        ${r.liquidations > 0 ? '<span style="color:var(--accent-red);">å¼ºå¹³'+r.liquidations+'</span>' : ''}
                    </div>
                </div>`;
            }).join('');
        }

        // æŸ±çŠ¶å›¾
        const barEl = document.getElementById('s15m-bar');
        if (barEl && ranked.length > 0) {
            const chart = LightweightCharts.createChart(barEl, {
                width: barEl.clientWidth, height: 300,
                layout: { background: { color: 'transparent' }, textColor: '#d1d5db' },
                grid: { vertLines: { color: 'rgba(255,255,255,0.04)' }, horzLines: { color: 'rgba(255,255,255,0.04)' } },
            });
            const s = chart.addHistogramSeries({ color: '#f97316' });
            s.setData(ranked.map((r, i) => ({
                time: `2026-03-${String(i + 1).padStart(2, '0')}`,
                value: r.alpha,
                color: r.alpha >= 25 ? '#22c55e' : r.alpha >= 15 ? '#3b82f6' : r.alpha > 0 ? '#f97316' : '#ef4444',
            })));
            chart.timeScale().fitContent();
            new ResizeObserver(() => chart.applyOptions({ width: barEl.clientWidth })).observe(barEl);
        }

        // è¡¨æ ¼
        const tbody = document.getElementById('s15m-body');
        if (tbody) {
            tbody.innerHTML = ranked.map((r, i) => {
                const fees = r.fees || {};
                return `<tr style="${i === 0 ? 'background:rgba(34,197,94,0.08);' : ''}">
                    <td><b>#${i + 1}</b>${i === 0 ? ' â˜…' : ''}</td>
                    <td>${r.name}</td>
                    <td class="${r.alpha >= 0 ? 'pnl-pos' : 'pnl-neg'}"><b>${r.alpha >= 0 ? '+' : ''}${r.alpha.toFixed(2)}%</b></td>
                    <td class="${r.strategy_return >= 0 ? 'pnl-pos' : 'pnl-neg'}">${r.strategy_return >= 0 ? '+' : ''}${r.strategy_return.toFixed(2)}%</td>
                    <td class="pnl-neg">${r.buy_hold_return.toFixed(2)}%</td>
                    <td>${r.max_drawdown.toFixed(2)}%</td>
                    <td>${r.total_trades}</td>
                    <td>${r.liquidations || 0}</td>
                    <td>$${(fees.total_costs || 0).toLocaleString(undefined, {maximumFractionDigits: 0})}</td>
                </tr>`;
            }).join('');
        }

        // èµ„äº§æ›²çº¿
        const eqEl = document.getElementById('s15m-equity');
        if (eqEl && best.history && best.history.length > 0) {
            const chart2 = LightweightCharts.createChart(eqEl, {
                width: eqEl.clientWidth, height: 400,
                layout: { background: { color: 'transparent' }, textColor: '#d1d5db' },
                grid: { vertLines: { color: 'rgba(255,255,255,0.04)' }, horzLines: { color: 'rgba(255,255,255,0.04)' } },
                rightPriceScale: { borderColor: 'rgba(255,255,255,0.1)' },
            });
            const totalLine = chart2.addLineSeries({ color: '#22c55e', lineWidth: 2, title: 'æ€»èµ„äº§' });
            totalLine.setData(best.history.map(h => ({
                time: Math.floor(new Date(h.time).getTime() / 1000),
                value: h.total,
            })));
            const bhLine = chart2.addLineSeries({ color: '#6b7280', lineWidth: 1, lineStyle: 2, title: 'Buy&Hold' });
            const firstTotal = best.history[0].total;
            const firstPrice = best.history[0].eth_price;
            bhLine.setData(best.history.map(h => ({
                time: Math.floor(new Date(h.time).getTime() / 1000),
                value: firstTotal * (1 + (h.eth_price - firstPrice) / firstPrice * 0.5),
            })));
            chart2.timeScale().fitContent();
            new ResizeObserver(() => chart2.applyOptions({ width: eqEl.clientWidth })).observe(eqEl);
        }

        // äº¤æ˜“æ˜ç»†
        const tradesEl = document.getElementById('s15m-trades');
        const countEl = document.getElementById('s15m-trade-count');
        if (tradesEl && best.trades) {
            if (countEl) countEl.textContent = `${best.trades.length}ç¬”`;
            tradesEl.innerHTML = best.trades.map((t, i) => {
                const actionColor = {
                    'OPEN_SHORT': '#ef4444', 'CLOSE_SHORT': '#22c55e',
                    'OPEN_LONG': '#3b82f6', 'CLOSE_LONG': '#f59e0b',
                    'SPOT_SELL': '#f97316', 'SPOT_BUY': '#06b6d4',
                    'LIQUIDATED': '#dc2626',
                }[t.action] || '#6b7280';
                return `<tr>
                    <td>${i + 1}</td>
                    <td style="font-family:monospace;font-size:12px;">${(t.time || '').substring(0, 16)}</td>
                    <td><span style="color:${actionColor};font-weight:600;">${t.action}</span></td>
                    <td>${t.direction || ''}</td>
                    <td>$${(t.price || 0).toLocaleString(undefined, {minimumFractionDigits: 2, maximumFractionDigits: 2})}</td>
                    <td>${t.leverage || 1}x</td>
                    <td>$${(t.total || 0).toLocaleString(undefined, {maximumFractionDigits: 0})}</td>
                    <td style="font-size:12px;max-width:200px;overflow:hidden;text-overflow:ellipsis;white-space:nowrap;" title="${t.reason || ''}">${t.reason || ''}</td>
                </tr>`;
            }).join('');
        }

        // è´¹ç”¨æ˜ç»†
        const feesEl = document.getElementById('s15m-fees');
        if (feesEl && best.fees) {
            const f = best.fees;
            feesEl.innerHTML = `
                <div style="display:grid;grid-template-columns:repeat(auto-fit,minmax(160px,1fr));gap:10px;">
                    <div style="background:var(--bg-hover);border-radius:8px;padding:12px;text-align:center;">
                        <div style="font-size:12px;color:var(--text-muted);">ç°è´§æ‰‹ç»­è´¹</div>
                        <div style="font-size:16px;font-weight:700;color:#f97316;">$${(f.spot_fees || 0).toFixed(2)}</div>
                    </div>
                    <div style="background:var(--bg-hover);border-radius:8px;padding:12px;text-align:center;">
                        <div style="font-size:12px;color:var(--text-muted);">åˆçº¦æ‰‹ç»­è´¹</div>
                        <div style="font-size:16px;font-weight:700;color:#ef4444;">$${(f.futures_fees || 0).toFixed(2)}</div>
                    </div>
                    <div style="background:var(--bg-hover);border-radius:8px;padding:12px;text-align:center;">
                        <div style="font-size:12px;color:var(--text-muted);">èµ„é‡‘è´¹ç‡(å‡€)</div>
                        <div style="font-size:16px;font-weight:700;color:${(f.net_funding||0)>0?'#22c55e':'#ef4444'};">$${(f.net_funding || 0).toFixed(2)}</div>
                    </div>
                    <div style="background:var(--bg-hover);border-radius:8px;padding:12px;text-align:center;">
                        <div style="font-size:12px;color:var(--text-muted);">æ»‘ç‚¹æˆæœ¬</div>
                        <div style="font-size:16px;font-weight:700;color:#f59e0b;">$${(f.slippage_cost || 0).toFixed(2)}</div>
                    </div>
                    <div style="background:var(--bg-hover);border-radius:8px;padding:12px;text-align:center;">
                        <div style="font-size:12px;color:var(--text-muted);">æ€»è´¹ç”¨</div>
                        <div style="font-size:16px;font-weight:700;color:#ef4444;">$${(f.total_costs || 0).toFixed(2)}</div>
                    </div>
                </div>`;
        }

        // ç»“è®º
        const concEl = document.getElementById('s15m-conclusion');
        if (concEl) {
            const bestInfo = data.best_strategy || {};
            concEl.innerHTML = `
                <div class="card-title">15åˆ†é’ŸåŒå‘å›æµ‹ç»“è®º</div>
                <div style="background:var(--bg-hover);border-radius:8px;padding:14px;margin-bottom:12px;">
                    <b style="color:#f97316;">æœ€ä½³ç­–ç•¥: ${bestInfo.name || best.name}</b>
                    &nbsp;|&nbsp; Î±=<b style="color:#22c55e;">${(bestInfo.alpha || best.alpha || 0).toFixed(2)}%</b>
                    &nbsp;|&nbsp; ${bestInfo.trades_count || best.total_trades || 0}ç¬”äº¤æ˜“
                </div>
                <div style="font-size:13px;color:var(--text-secondary);line-height:1.7;">
                    <b>å…³é”®å‘ç°:</b><br>
                    1. 15åˆ†é’Ÿä¿¡å·å¯ä»¥åšå¤šåšç©ºåŒå‘äº¤æ˜“, Î±èŒƒå›´: +2%~+26%<br>
                    2. ä¿¡å·å†²çª(TSå’ŒBSåŒæ—¶é«˜)æ˜¯15mçš„æ ¸å¿ƒæŒ‘æˆ˜, éœ€è¦å†²çªè¿‡æ»¤æœºåˆ¶<br>
                    3. ç°è´§äº¤æ˜“éœ€è¦ä¸¥æ ¼å†·å´(12h+), å¦åˆ™é¢‘ç¹ä¹°å–çš„æ‰‹ç»­è´¹ä¼šåå™¬æ‰€æœ‰åˆ©æ¶¦<br>
                    4. åšå¤šåœ¨åº•éƒ¨åŒºåŸŸ(2/6)æ•æ‰åˆ°+$10,905ç›ˆåˆ©çš„å¤šå¤´åˆçº¦, æ˜¯Î±çš„é‡è¦æ¥æº<br>
                    5. å¯¹æ¯”1hç­–ç•¥Î±â‰ˆ+25%, 15mç­–ç•¥çš„æ ¸å¿ƒä¼˜åŠ¿åœ¨äºæ›´ç²¾ç¡®çš„å…¥åœºæ—¶æœº
                </div>`;
        }
    }

    function renderTimeframeAnalysis(data) {
        const section = document.getElementById('tf-analysis-section');
        if (!section) return;
        section.style.display = 'block';

        // 1. å•ä¸€å‘¨æœŸæŸ±çŠ¶å›¾
        const singleResults = data.single_timeframe_results || [];
        const singleContainer = document.getElementById('tf-single-bar');
        if (singleContainer && singleResults.length > 0) {
            const chart = LightweightCharts.createChart(singleContainer, {
                width: singleContainer.clientWidth, height: 300,
                layout: { background: { color: 'transparent' }, textColor: getComputedStyle(document.body).getPropertyValue('--text-primary').trim() || '#d1d5db' },
                grid: { vertLines: { color: 'rgba(255,255,255,0.04)' }, horzLines: { color: 'rgba(255,255,255,0.04)' } },
            });
            const series = chart.addHistogramSeries({ color: '#a855f7' });
            series.setData(singleResults.map((r, i) => ({
                time: `2026-01-${String(i + 1).padStart(2, '0')}`,
                value: r.alpha,
                color: r.alpha >= 30 ? '#22c55e' : r.alpha >= 20 ? '#3b82f6' : r.alpha >= 10 ? '#f59e0b' : r.alpha > 0 ? '#ef4444' : '#6b7280',
            })));
            // labels
            const labels = singleResults.map((r, i) => ({
                time: `2026-01-${String(i + 1).padStart(2, '0')}`,
                position: 'aboveBar', color: '#fff', shape: 'circle',
                text: `${r.timeframe}: ${r.alpha >= 0 ? '+' : ''}${r.alpha.toFixed(1)}%`,
            }));
            chart.timeScale().fitContent();
            new ResizeObserver(() => chart.applyOptions({ width: singleContainer.clientWidth })).observe(singleContainer);
        }

        // å•ä¸€å‘¨æœŸè¡¨æ ¼
        const singleBody = document.getElementById('tf-single-body');
        if (singleBody) {
            const sorted = [...singleResults].sort((a, b) => b.alpha - a.alpha);
            singleBody.innerHTML = sorted.map((r, i) => {
                const best = i === 0;
                return `<tr style="${best ? 'background:rgba(34,197,94,0.08);' : ''}">
                    <td><b>${r.timeframe}</b>${best ? ' â˜…' : ''}</td>
                    <td class="${r.alpha >= 0 ? 'pnl-pos' : 'pnl-neg'}">${r.alpha >= 0 ? '+' : ''}${r.alpha.toFixed(2)}%</td>
                    <td class="${r.strategy_return >= 0 ? 'pnl-pos' : 'pnl-neg'}">${r.strategy_return >= 0 ? '+' : ''}${r.strategy_return.toFixed(2)}%</td>
                    <td>${r.max_drawdown.toFixed(2)}%</td>
                    <td>${r.total_trades}</td>
                    <td>${r.signal_count}</td>
                    <td>$${(r.fees || 0).toFixed(0)}</td>
                </tr>`;
            }).join('');
        }

        // 2. å‘¨æœŸç»„åˆæ’åæŸ±çŠ¶å›¾
        const ranking = data.ranking || [];
        const comboBar = document.getElementById('tf-combo-bar');
        if (comboBar && ranking.length > 0) {
            const chart2 = LightweightCharts.createChart(comboBar, {
                width: comboBar.clientWidth, height: 400,
                layout: { background: { color: 'transparent' }, textColor: getComputedStyle(document.body).getPropertyValue('--text-primary').trim() || '#d1d5db' },
                grid: { vertLines: { color: 'rgba(255,255,255,0.04)' }, horzLines: { color: 'rgba(255,255,255,0.04)' } },
            });
            const s2 = chart2.addHistogramSeries({ color: '#a855f7' });
            s2.setData(ranking.map((r, i) => ({
                time: `2026-02-${String(i + 1).padStart(2, '0')}`,
                value: r.alpha,
                color: r.rank === 1 ? '#22c55e' : r.rank <= 3 ? '#3b82f6' : r.alpha > 0 ? '#8b5cf6' : '#6b7280',
            })));
            chart2.timeScale().fitContent();
            new ResizeObserver(() => chart2.applyOptions({ width: comboBar.clientWidth })).observe(comboBar);
        }

        // ç»„åˆæ’åè¡¨æ ¼
        const comboBody = document.getElementById('tf-combo-body');
        const comboResults = data.combo_results || [];
        if (comboBody) {
            const sortedCombo = [...comboResults].sort((a, b) => b.alpha - a.alpha);
            comboBody.innerHTML = sortedCombo.map((r, i) => {
                const best = i === 0;
                const cls = r.name.startsWith('A:') ? 'background:rgba(59,130,246,0.08);' : '';
                return `<tr style="${best ? 'background:rgba(34,197,94,0.08);' : cls}">
                    <td><b>#${i + 1}</b>${best ? ' â˜…' : ''}</td>
                    <td>${r.name}${r.name.startsWith('A:') ? ' (å½“å‰)' : ''}</td>
                    <td class="${r.alpha >= 0 ? 'pnl-pos' : 'pnl-neg'}"><b>${r.alpha >= 0 ? '+' : ''}${r.alpha.toFixed(2)}%</b></td>
                    <td class="${r.strategy_return >= 0 ? 'pnl-pos' : 'pnl-neg'}">${r.strategy_return >= 0 ? '+' : ''}${r.strategy_return.toFixed(2)}%</td>
                    <td>${r.max_drawdown.toFixed(2)}%</td>
                    <td>${r.total_trades}</td>
                </tr>`;
            }).join('');
        }

        // 3. ä¿¡å·æ—¶é—´çº¿
        const timing = data.signal_timing || [];
        const timingDetail = document.getElementById('tf-timing-detail');
        if (timingDetail && timing.length > 0) {
            const peak = data.eth_peak || {};
            let html = `<div style="background:var(--bg-hover);border-radius:8px;padding:14px;margin-bottom:12px;">
                <b>ETHé¡¶éƒ¨:</b> ${(peak.time || '').substring(0, 16)} @$${(peak.price || 0).toLocaleString()}<br>
                <span style="font-size:13px;color:var(--text-secondary);">å„å‘¨æœŸé¦–æ¬¡å‘å‡ºé¡¶éƒ¨ä¿¡å·(topâ‰¥3)çš„æ—¶é—´å’Œé€Ÿåº¦</span>
            </div>`;
            html += '<div style="display:grid;grid-template-columns:repeat(auto-fit,minmax(180px,1fr));gap:10px;">';
            timing.forEach(t => {
                const hours = Math.abs(t.hours_vs_peak);
                const early = t.early;
                const color = early ? '#22c55e' : t.hours_vs_peak === 0 ? '#f59e0b' : hours < 100 ? '#3b82f6' : hours < 300 ? '#f59e0b' : '#ef4444';
                const label = t.first_signal_time ? `${early ? 'æå‰' : 'å»¶è¿Ÿ'} ${hours.toFixed(0)}h` : 'æ— ä¿¡å·';
                html += `<div style="background:var(--bg-hover);border-radius:8px;padding:12px;border-left:3px solid ${color};">
                    <div style="font-weight:700;font-size:16px;color:${color};">${t.timeframe}</div>
                    <div style="font-size:13px;color:var(--text-secondary);">${label}</div>
                    ${t.first_signal_time ? `<div style="font-size:12px;color:var(--text-muted);">å¼ºåº¦=${t.signal_strength.toFixed(1)}</div>` : ''}
                    ${t.first_signal_time ? `<div style="font-size:11px;color:var(--text-muted);">${t.first_signal_time.substring(0, 16)}</div>` : ''}
                </div>`;
            });
            html += '</div>';
            timingDetail.innerHTML = html;
        }

        // 4. ä¿¡å·çŸ©é˜µçƒ­åŠ›å›¾
        const matrix = data.signal_matrix || [];
        const matrixEl = document.getElementById('tf-matrix-content');
        if (matrixEl && matrix.length > 0) {
            const tfs = ['15m', '30m', '1h', '2h', '4h', '6h', '8h'];
            let html = '<div class="trade-table-wrap" style="max-height:none;"><table style="font-size:13px;"><thead><tr>';
            html += '<th style="min-width:140px;">æ—¶é—´</th><th>è¯´æ˜</th>';
            tfs.forEach(tf => { html += `<th style="text-align:center;">${tf}</th>`; });
            html += '</tr></thead><tbody>';
            matrix.forEach(row => {
                html += `<tr><td style="font-family:monospace;font-size:12px;">${row.time}</td><td>${row.description}</td>`;
                tfs.forEach(tf => {
                    const sig = (row.signals || {})[tf] || { top: 0, bottom: 0 };
                    const top = sig.top || 0;
                    const bot = sig.bottom || 0;
                    let bg = 'transparent';
                    let text = '--';
                    if (top > 0) {
                        const intensity = Math.min(top / 100, 1);
                        bg = `rgba(239,68,68,${0.1 + intensity * 0.4})`;
                        text = `<span style="color:#ef4444;">â–¼${top.toFixed(0)}</span>`;
                    } else if (bot > 0) {
                        const intensity = Math.min(bot / 100, 1);
                        bg = `rgba(34,197,94,${0.1 + intensity * 0.4})`;
                        text = `<span style="color:#22c55e;">â–²${bot.toFixed(0)}</span>`;
                    }
                    html += `<td style="text-align:center;background:${bg};">${text}</td>`;
                });
                html += '</tr>';
            });
            html += '</tbody></table></div>';
            matrixEl.innerHTML = html;
        }

        // 5. æ ¸å¿ƒå‘ç°
        const findings = data.findings || [];
        const findingsEl = document.getElementById('tf-findings-content');
        if (findingsEl && findings.length > 0) {
            const icons = ['ğŸ”´', 'ğŸŸ¢', 'ğŸŸ¡', 'ğŸ”µ', 'âš¡', 'âœ…'];
            findingsEl.innerHTML = findings.map((f, i) => {
                const icon = icons[i] || 'ğŸ“Œ';
                return `<div style="background:var(--bg-hover);border-radius:8px;padding:14px;margin-bottom:10px;">
                    <div style="font-weight:700;font-size:14px;margin-bottom:4px;">${icon} å‘ç°${i + 1}: ${f.title}</div>
                    <div style="font-size:13px;color:var(--text-secondary);line-height:1.6;">${f.detail}</div>
                    <div style="font-size:12px;color:var(--text-muted);margin-top:4px;font-style:italic;">è¯æ®: ${f.evidence}</div>
                </div>`;
            }).join('');
        }

        // 6. æœ€ä½³ç­–ç•¥äº¤æ˜“æ˜ç»†
        const best = [...comboResults].sort((a, b) => b.alpha - a.alpha)[0];
        const tradesBody = document.getElementById('tf-trades-body');
        if (tradesBody && best && best.trades) {
            tradesBody.innerHTML = best.trades.map((t, i) => `
                <tr>
                    <td>${i + 1}</td>
                    <td style="font-family:monospace;font-size:12px;">${(t.time || '').substring(0, 16)}</td>
                    <td><span style="color:${t.action === 'OPEN_SHORT' ? '#ef4444' : t.action === 'CLOSE_SHORT' ? '#22c55e' : '#f59e0b'};">${t.action}</span></td>
                    <td>${t.direction}</td>
                    <td>$${(t.price || 0).toLocaleString(undefined, { minimumFractionDigits: 2, maximumFractionDigits: 2 })}</td>
                    <td style="font-size:12px;">${t.reason || ''}</td>
                </tr>
            `).join('');
        }

        // 7. ç»“è®º
        const conclusion = data.conclusion || {};
        const conclusionEl = document.getElementById('tf-conclusion');
        if (conclusionEl) {
            const curr = data.current_weights || {};
            const rec = conclusion.recommended_weights || {};
            conclusionEl.innerHTML = `
                <div class="card-title">åˆ†æç»“è®º</div>
                <div style="display:grid;grid-template-columns:1fr 1fr;gap:16px;margin-bottom:16px;">
                    <div style="background:rgba(239,68,68,0.06);border-radius:8px;padding:14px;border-left:3px solid #ef4444;">
                        <b style="color:#ef4444;">å½“å‰æƒé‡ (æœ‰é—®é¢˜)</b>
                        <div style="font-size:13px;margin-top:6px;font-family:monospace;">
                            ${Object.entries(curr).sort((a,b)=>b[1]-a[1]).map(([k,v])=>`${k}: ${v}`).join(' > ')}
                        </div>
                        <div style="font-size:12px;color:var(--text-muted);margin-top:4px;">
                            4hæƒé‡æœ€é«˜ä½†30å¤©å†…0ä¿¡å·, 8hæœ€æœ‰æ•ˆä½†æƒé‡ä»…0.5
                        </div>
                    </div>
                    <div style="background:rgba(34,197,94,0.06);border-radius:8px;padding:14px;border-left:3px solid #22c55e;">
                        <b style="color:#22c55e;">å»ºè®®æƒé‡</b>
                        <div style="font-size:13px;margin-top:6px;font-family:monospace;">
                            ${Object.entries(rec).sort((a,b)=>b[1]-a[1]).map(([k,v])=>`${k}: ${v}`).join(' > ')}
                        </div>
                        <div style="font-size:12px;color:var(--text-muted);margin-top:4px;">
                            8hæƒé‡æå‡åˆ°1.0, 4hé™è‡³0.3, å¯é€‰åŠ å…¥30m(0.3)
                        </div>
                    </div>
                </div>
                <div style="background:var(--bg-hover);border-radius:8px;padding:14px;">
                    <b>${conclusion.summary || ''}</b>
                    <div style="margin-top:8px;font-size:13px;color:var(--text-secondary);">
                        å½“å‰ç³»ç»ŸÎ±: <b>+${(conclusion.current_alpha || 0).toFixed(2)}%</b>
                        &nbsp;|&nbsp; æœ€ä½³ç»„åˆ(${conclusion.best_combo_name || ''}): <b style="color:#22c55e;">+${(conclusion.best_combo_alpha || 0).toFixed(2)}%</b>
                    </div>
                    ${conclusion.caveat ? `<div style="margin-top:8px;font-size:12px;color:#f59e0b;">âš  ${conclusion.caveat}</div>` : ''}
                </div>
            `;
        }
    }
    // ===================== å‡çº¿æŠ€æœ¯åˆ†æ =====================
    async function loadMAStrategy() {
        try {
            const res = await fetch('/api/ma_strategy');
            if (res.ok) {
                window._maLoaded = true;
                renderMAStrategy(await res.json());
            } else {
                document.getElementById('ma-loading').innerHTML = '<p style="color:var(--accent-red);">å‡çº¿ç­–ç•¥æ•°æ®æœªæ‰¾åˆ°, è¯·å…ˆè¿è¡Œ python ma_strategy.py</p>';
            }
        } catch(e) {
            document.getElementById('ma-loading').innerHTML = `<p style="color:var(--accent-red);">åŠ è½½å¤±è´¥: ${e.message}</p>`;
        }
    }

    function renderMAStrategy(data) {
        document.getElementById('ma-loading').style.display = 'none';
        document.getElementById('ma-content').style.display = 'block';

        const results = data.results || [];
        const ranked = [...results].sort((a, b) => b.alpha - a.alpha);
        const best = ranked[0] || {};
        const stats = data.signal_stats || {};
        const outline = data.book_outline || {};

        // æ ‡é¢˜æ›´æ–°
        const titleEl = document.getElementById('ma-strat-title');
        if (titleEl) titleEl.textContent = `8ç§å‡çº¿ç­–ç•¥å¯¹æ¯” Â· ${data.trade_days || 7}å¤©`;

        const descEl = document.getElementById('ma-desc');
        if (descEl) {
            descEl.innerHTML = `ä¸»ä¿¡å·: 1h Kçº¿ (${data.total_bars || '?'}æ ¹) Â· å‡çº¿: SMA5/10/20/30/60/120/240<br>
                äº¤æ˜“åŒºé—´: ${data.trade_range || ''}<br>
                æ–¹å‘: ä¹°å…¥ä¿¡å·â†’ä¹°å…¥ç°è´§+å¼€å¤š | å–å‡ºä¿¡å·â†’å–å‡ºç°è´§+å¼€ç©º<br>
                åˆå§‹: ${data.initial_capital || '10ä¸‡USDT + ä»·å€¼10ä¸‡USDTçš„ETH'}`;
        }

        // ä¹¦ç±å¤§çº²
        const outlineEl = document.getElementById('ma-outline-content');
        if (outlineEl && outline.chapters) {
            const chapterColors = ['#3b82f6', '#22c55e', '#f59e0b', '#ef4444'];
            outlineEl.innerHTML = outline.chapters.map((ch, i) => `
                <div style="margin-bottom:16px;">
                    <div style="font-weight:700;color:${chapterColors[i % 4]};font-size:15px;margin-bottom:8px;">${ch.chapter}</div>
                    <div style="display:grid;grid-template-columns:repeat(auto-fit,minmax(280px,1fr));gap:8px;">
                        ${ch.sections.map(s => `<div style="background:var(--bg-hover);border-radius:6px;padding:8px 12px;font-size:13px;color:var(--text-secondary);border-left:3px solid ${chapterColors[i % 4]}30;">${s}</div>`).join('')}
                    </div>
                </div>
            `).join('');
        }

        // ä¿¡å·ç»Ÿè®¡
        const sigEl = document.getElementById('ma-signal-content');
        if (sigEl && stats.buy_signals) {
            const bs = stats.buy_signals;
            const ss = stats.sell_signals;
            const arr = stats.arrangement || {};
            const gran = stats.granville || {};
            const buyRules = (gran.rule_1||0)+(gran.rule_2||0)+(gran.rule_3||0)+(gran.rule_4||0);
            const sellRules = (gran.rule_5||0)+(gran.rule_6||0)+(gran.rule_7||0)+(gran.rule_8||0);
            sigEl.innerHTML = `
                <div style="display:grid;grid-template-columns:repeat(auto-fit,minmax(200px,1fr));gap:12px;">
                    <div style="background:rgba(34,197,94,0.08);border-radius:8px;padding:14px;">
                        <div style="font-size:12px;color:var(--text-muted);">ä¹°å…¥ä¿¡å·</div>
                        <div style="font-size:24px;font-weight:700;color:#22c55e;">${bs.count_gt_15}</div>
                        <div style="font-size:12px;color:var(--text-muted);">å¼ºä¿¡å·(>30): ${bs.count_gt_30} | æå¼º(>50): ${bs.count_gt_50}</div>
                    </div>
                    <div style="background:rgba(239,68,68,0.08);border-radius:8px;padding:14px;">
                        <div style="font-size:12px;color:var(--text-muted);">å–å‡ºä¿¡å·</div>
                        <div style="font-size:24px;font-weight:700;color:#ef4444;">${ss.count_gt_15}</div>
                        <div style="font-size:12px;color:var(--text-muted);">å¼ºä¿¡å·(>30): ${ss.count_gt_30} | æå¼º(>50): ${ss.count_gt_50}</div>
                    </div>
                    <div style="background:rgba(59,130,246,0.08);border-radius:8px;padding:14px;">
                        <div style="font-size:12px;color:var(--text-muted);">å‡çº¿æ’åˆ—</div>
                        <div style="font-size:14px;margin-top:6px;">
                            <span style="color:#22c55e;">å¤šå¤´ ${arr.bullish_pct?.toFixed(1)||0}%</span> Â·
                            <span style="color:#ef4444;">ç©ºå¤´ ${arr.bearish_pct?.toFixed(1)||0}%</span> Â·
                            <span style="color:var(--text-muted);">æ··åˆ ${arr.mixed_pct?.toFixed(1)||0}%</span>
                        </div>
                    </div>
                    <div style="background:rgba(168,85,247,0.08);border-radius:8px;padding:14px;">
                        <div style="font-size:12px;color:var(--text-muted);">è‘›å—ç»´æ³•åˆ™</div>
                        <div style="font-size:14px;margin-top:6px;">
                            <span style="color:#22c55e;">ä¹°å…¥ ${buyRules}æ¬¡</span> Â·
                            <span style="color:#ef4444;">å–å‡º ${sellRules}æ¬¡</span>
                        </div>
                        <div style="font-size:11px;color:var(--text-muted);margin-top:4px;">
                            æ³•åˆ™1-4(ä¹°): ${gran.rule_1||0}/${gran.rule_2||0}/${gran.rule_3||0}/${gran.rule_4||0} |
                            æ³•åˆ™5-8(å–): ${gran.rule_5||0}/${gran.rule_6||0}/${gran.rule_7||0}/${gran.rule_8||0}
                        </div>
                    </div>
                </div>
            `;
        }

        // ç­–ç•¥å¡ç‰‡
        const cardsEl = document.getElementById('ma-cards');
        if (cardsEl) {
            const colors = ['#3b82f6', '#22c55e', '#a855f7', '#f59e0b', '#ef4444', '#06b6d4', '#ec4899', '#6b7280'];
            cardsEl.innerHTML = ranked.map((r, i) => {
                const isBest = i === 0;
                const c = colors[i % colors.length];
                return `<div style="background:var(--bg-hover);border-radius:10px;padding:14px;${isBest ? 'border:1.5px solid #22c55e;' : ''}">
                    <div style="font-weight:700;font-size:14px;color:${c};margin-bottom:4px;">${r.name}${isBest ? ' â˜…' : ''}</div>
                    <div style="display:flex;gap:12px;font-size:13px;flex-wrap:wrap;">
                        <span style="color:${r.alpha > 0 ? 'var(--accent-green)' : 'var(--accent-red)'};">${r.alpha > 0 ? '+' : ''}${r.alpha.toFixed(2)}% Î±</span>
                        <span style="color:var(--text-muted);">${r.max_drawdown.toFixed(1)}% DD</span>
                        <span style="color:var(--text-muted);">${r.total_trades}ç¬”</span>
                    </div>
                </div>`;
            }).join('');
        }

        // Alphaå¯¹æ¯”æŸ±çŠ¶å›¾
        const chartEl = document.getElementById('ma-alpha-chart');
        if (chartEl && ranked.length > 0) {
            chartEl.innerHTML = '';
            const maxAlpha = Math.max(...ranked.map(r => Math.abs(r.alpha)), 1);
            chartEl.innerHTML = `<div style="display:flex;align-items:flex-end;gap:12px;height:260px;padding:20px;">
                ${ranked.map((r, i) => {
                    const h = Math.max(Math.abs(r.alpha) / maxAlpha * 200, 8);
                    const isPos = r.alpha >= 0;
                    const c = isPos ? '#22c55e' : '#ef4444';
                    return `<div style="flex:1;display:flex;flex-direction:column;align-items:center;justify-content:flex-end;height:100%;">
                        <div style="font-size:11px;color:${c};font-weight:700;margin-bottom:4px;">${r.alpha > 0 ? '+' : ''}${r.alpha.toFixed(2)}%</div>
                        <div style="width:100%;max-width:60px;height:${h}px;background:${c}30;border:1px solid ${c};border-radius:4px 4px 0 0;"></div>
                        <div style="font-size:10px;color:var(--text-muted);margin-top:6px;text-align:center;writing-mode:vertical-rl;height:80px;">${r.name}</div>
                    </div>`;
                }).join('')}
            </div>`;
        }

        // ç­–ç•¥è¯¦æƒ…è¡¨æ ¼
        const tableBody = document.querySelector('#ma-table tbody');
        if (tableBody) {
            tableBody.innerHTML = ranked.map((r, i) => {
                const fees = r.fees || {};
                return `<tr ${i === 0 ? 'style="background:rgba(34,197,94,0.06);"' : ''}>
                    <td>#${i + 1}${i === 0 ? ' â˜…' : ''}</td>
                    <td><b>${r.name}</b></td>
                    <td style="color:${r.alpha >= 0 ? 'var(--accent-green)' : 'var(--accent-red)'};">${r.alpha > 0 ? '+' : ''}${r.alpha.toFixed(2)}%</td>
                    <td>${r.strategy_return > 0 ? '+' : ''}${r.strategy_return.toFixed(2)}%</td>
                    <td>${r.buy_hold_return > 0 ? '+' : ''}${r.buy_hold_return.toFixed(2)}%</td>
                    <td>${r.max_drawdown.toFixed(2)}%</td>
                    <td>${r.total_trades}</td>
                    <td>${r.liquidations || 0}</td>
                    <td>$${(fees.total_costs || 0).toLocaleString(undefined, {maximumFractionDigits: 0})}</td>
                </tr>`;
            }).join('');
        }

        // æœ€ä½³ç­–ç•¥äº¤æ˜“æ˜ç»†
        const bestTitle = document.getElementById('ma-best-title');
        if (bestTitle) bestTitle.textContent = `æœ€ä½³ç­–ç•¥: ${best.name} Â· äº¤æ˜“æ˜ç»†`;

        const tradesBody = document.querySelector('#ma-trades-table tbody');
        if (tradesBody && best.trades) {
            tradesBody.innerHTML = best.trades.slice(0, 50).map(t => {
                const isOpen = t.action?.includes('OPEN');
                const isSell = t.action?.includes('SELL') || t.action?.includes('SHORT');
                const color = isSell ? 'var(--accent-red)' : 'var(--accent-green)';
                return `<tr>
                    <td style="font-size:12px;">${String(t.time).substring(0, 16)}</td>
                    <td style="color:${color};font-weight:600;">${t.action || ''}</td>
                    <td>${t.direction || ''}</td>
                    <td>$${(t.price || 0).toLocaleString(undefined, {minimumFractionDigits: 2, maximumFractionDigits: 2})}</td>
                    <td>${t.leverage || 1}x</td>
                    <td>$${(t.total || 0).toLocaleString(undefined, {maximumFractionDigits: 0})}</td>
                    <td style="font-size:12px;max-width:300px;overflow:hidden;text-overflow:ellipsis;">${(t.reason || '').substring(0, 60)}</td>
                </tr>`;
            }).join('');
        }

        // ç»“è®º
        const conclusionEl = document.getElementById('ma-conclusion');
        if (conclusionEl) {
            const bestStrat = data.best_strategy || {};
            conclusionEl.innerHTML = `
                <div class="card-title">å›æµ‹ç»“è®º</div>
                <div style="background:rgba(59,130,246,0.06);border-radius:8px;padding:16px;border-left:3px solid #3b82f6;">
                    <div style="font-weight:700;color:#3b82f6;margin-bottom:8px;">
                        æœ€ä½³ç­–ç•¥: ${bestStrat.name || best.name} Â· Î± = ${(bestStrat.alpha || best.alpha || 0) > 0 ? '+' : ''}${(bestStrat.alpha || best.alpha || 0).toFixed(2)}%
                    </div>
                    <div style="font-size:13px;color:var(--text-secondary);line-height:1.8;">
                        åŸºäºã€Šå‡çº¿æŠ€æœ¯åˆ†æã€‹å…¨ä¹¦ç†è®º, åœ¨ETH/USDT ${data.trade_days || 7}å¤©å›æµ‹ä¸­:<br>
                        Â· ä¹°å…¥æŒæœ‰æ”¶ç›Š: ${(best.buy_hold_return || 0).toFixed(2)}%<br>
                        Â· æœ€ä½³ç­–ç•¥æ”¶ç›Š: ${(best.strategy_return || 0).toFixed(2)}%, è¶…é¢Î± = ${(best.alpha || 0) > 0 ? '+' : ''}${(best.alpha || 0).toFixed(2)}%<br>
                        Â· äº¤æ˜“${bestStrat.trades_count || best.total_trades || 0}ç¬”, æœ€å¤§å›æ’¤${(best.max_drawdown || 0).toFixed(2)}%<br>
                        Â· æ ¸å¿ƒä¿¡å·æº: è‘›å—ç»´å…«å¤§æ³•åˆ™ + å‡çº¿æ’åˆ—(å¤šå¤´/ç©ºå¤´) + é‡‘å‰æ­»å‰ + ç‰¹æ®Šå½¢æ€(é“¶å±±è°·/é‡‘å±±è°·/æ­»äº¡è°·/è›Ÿé¾™å‡ºæµ·/çƒ˜äº‘æ‰˜æœˆç­‰)
                    </div>
                </div>
            `;
        }
    }

    // ===================== åŒä¹¦èåˆç­–ç•¥ =====================
    async function loadCombinedStrategy() {
        try {
            const res = await fetch('/api/combined_strategy');
            if (res.ok) {
                window._csLoaded = true;
                renderCombinedStrategy(await res.json());
            } else {
                document.getElementById('cs-loading').innerHTML = '<p style="color:var(--accent-red);">èåˆç­–ç•¥æ•°æ®æœªæ‰¾åˆ°, è¯·å…ˆè¿è¡Œ python combined_strategy.py</p>';
            }
        } catch(e) {
            document.getElementById('cs-loading').innerHTML = '<p style="color:var(--accent-red);">åŠ è½½å¤±è´¥: '+e.message+'</p>';
        }
    }

    function renderCombinedStrategy(data) {
        document.getElementById('cs-loading').style.display = 'none';
        document.getElementById('cs-content').style.display = 'block';

        const results = data.results || [];
        const ranking = data.ranking || [];
        const bestInfo = data.best_strategy || {};
        const sigInfo = data.signal_summary || {};

        // ä¿¡å·ç»Ÿè®¡
        const statsEl = document.getElementById('cs-signal-stats');
        const statItems = [
            {label: '1hèƒŒç¦»ä¿¡å·', value: sigInfo.div_1h_count || 0, color: 'var(--accent-red)'},
            {label: '8hèƒŒç¦»ä¿¡å·', value: sigInfo.div_8h_count || 0, color: 'var(--accent-yellow)'},
            {label: 'å‡çº¿ä¹°å…¥ä¿¡å·', value: sigInfo.ma_buy_count || 0, color: 'var(--accent-green)'},
            {label: 'å‡çº¿å–å‡ºä¿¡å·', value: sigInfo.ma_sell_count || 0, color: 'var(--accent-blue)'},
        ];
        statsEl.innerHTML = statItems.map(s => `
            <div style="background:var(--bg-secondary);border-radius:12px;padding:16px;text-align:center;border-top:3px solid ${s.color}">
                <div style="font-size:28px;font-weight:700;color:${s.color}">${s.value}</div>
                <div style="font-size:12px;color:var(--text-muted);margin-top:4px">${s.label}</div>
            </div>`).join('');

        // ç­–ç•¥å¡ç‰‡
        const cardsEl = document.getElementById('cs-strategy-cards');
        const fusionLabels = {
            'weighted': 'åŠ æƒ', 'resonance': 'å…±æŒ¯', 'ma_filter': 'å‡çº¿æ»¤æ³¢', 'div_filter': 'èƒŒç¦»æ»¤æ³¢'
        };
        const sorted = [...results].sort((a,b) => (b.alpha||0) - (a.alpha||0));
        cardsEl.innerHTML = sorted.map((r, i) => {
            const alpha = (r.alpha || 0);
            const isTop = i === 0;
            const borderColor = alpha > 10 ? 'var(--accent-green)' : alpha > 0 ? 'var(--accent-blue)' : 'var(--accent-red)';
            const fees = r.fees || {};
            return `
            <div style="background:var(--bg-secondary);border-radius:12px;padding:16px;border-left:4px solid ${borderColor};${isTop?'box-shadow:0 0 20px rgba(0,214,143,0.15);':''}">
                <div style="font-weight:700;font-size:14px;margin-bottom:8px;color:var(--text-primary)">${isTop?'<span style="color:gold">â˜… </span>':''}${r.name}</div>
                <div style="font-size:24px;font-weight:700;color:${borderColor};margin-bottom:8px">
                    Î± ${alpha > 0 ? '+' : ''}${alpha.toFixed(2)}%
                </div>
                <div style="font-size:12px;color:var(--text-muted);line-height:1.8">
                    æ”¶ç›Š: ${(r.strategy_return||0).toFixed(2)}% Â· ä¹°æŒ: ${(r.buy_hold_return||0).toFixed(2)}%<br>
                    å›æ’¤: ${(r.max_drawdown||0).toFixed(2)}% Â· äº¤æ˜“: ${r.total_trades||0}ç¬”<br>
                    è´¹ç”¨: $${(fees.total_costs||0).toLocaleString()}
                </div>
            </div>`;
        }).join('');

        // AlphaæŸ±çŠ¶å›¾
        const chartEl = document.getElementById('cs-alpha-chart');
        const maxAlpha = Math.max(...results.map(r => Math.abs(r.alpha || 0)), 1);
        chartEl.innerHTML = results.map(r => {
            const alpha = r.alpha || 0;
            const h = Math.max(8, Math.abs(alpha) / maxAlpha * 200);
            const color = alpha > 10 ? 'var(--accent-green)' : alpha > 0 ? 'var(--accent-blue)' : 'var(--accent-red)';
            const name = r.name.replace(/C\d+: /, '');
            return `
            <div style="display:flex;flex-direction:column;align-items:center;gap:6px;flex:1">
                <div style="font-size:11px;font-weight:600;color:${color}">${alpha > 0 ? '+' : ''}${alpha.toFixed(1)}%</div>
                <div style="width:100%;height:${h}px;background:${color};border-radius:6px 6px 0 0;opacity:0.8"></div>
                <div style="font-size:10px;color:var(--text-muted);text-align:center;max-width:80px;word-break:break-all">${name}</div>
            </div>`;
        }).join('');

        // æ’åè¡¨æ ¼
        const rankBody = document.getElementById('cs-ranking-body');
        const fusionModeMap = {};
        const strategies = [
            {name:'C1',mode:'åŠ æƒ(èƒŒç¦»6:å‡çº¿4)'},{name:'C2',mode:'åŠ æƒ(èƒŒç¦»4:å‡çº¿6)'},
            {name:'C3',mode:'å…±æŒ¯ç¡®è®¤'},{name:'C4',mode:'å‡çº¿è¿‡æ»¤èƒŒç¦»'},
            {name:'C5',mode:'èƒŒç¦»è¿‡æ»¤å‡çº¿'},{name:'C6',mode:'åŠ æƒ+æ¿€è¿›åšç©º'},
            {name:'C7',mode:'å…±æŒ¯+ä¿å®ˆ'},{name:'C8',mode:'å‡çº¿è¿‡æ»¤+è¶‹åŠ¿åŠ é€Ÿ'}
        ];
        strategies.forEach(s => fusionModeMap[s.name] = s.mode);

        rankBody.innerHTML = sorted.map((r, i) => {
            const alpha = r.alpha || 0;
            const ac = alpha > 10 ? 'var(--accent-green)' : alpha > 0 ? 'var(--accent-blue)' : 'var(--accent-red)';
            const fees = r.fees || {};
            const cKey = (r.name || '').substring(0, 2);
            const mode = fusionModeMap[cKey] || '-';
            return `<tr>
                <td>${i+1}</td>
                <td style="font-weight:600">${i===0?'â˜… ':''}${r.name}</td>
                <td><span style="font-size:11px;background:var(--bg-hover);padding:2px 8px;border-radius:4px">${mode}</span></td>
                <td style="font-weight:700;color:${ac}">${alpha>0?'+':''}${alpha.toFixed(2)}%</td>
                <td>${(r.strategy_return||0).toFixed(2)}%</td>
                <td>${(r.buy_hold_return||0).toFixed(2)}%</td>
                <td>${(r.max_drawdown||0).toFixed(2)}%</td>
                <td>${r.total_trades||0}</td>
                <td>${r.liquidations||0}</td>
                <td>$${(fees.total_costs||0).toLocaleString()}</td>
                <td>$${(r.final_total||0).toLocaleString()}</td>
            </tr>`;
        }).join('');

        // æœ€ä½³ç­–ç•¥äº¤æ˜“è®°å½•
        const best = sorted[0];
        document.getElementById('cs-best-title').textContent = `æœ€ä½³ç­–ç•¥: ${best.name} Â· äº¤æ˜“è®°å½•`;
        const tradesBody = document.getElementById('cs-trades-body');
        const trades = (best.trades || []).slice(0, 30);
        tradesBody.innerHTML = trades.map(t => {
            const action = t.action || '';
            const ac = action.includes('SELL') || action.includes('SHORT') ? 'var(--accent-red)' :
                        action.includes('BUY') || action.includes('LONG') ? 'var(--accent-green)' : 'var(--text-secondary)';
            return `<tr>
                <td style="font-size:11px">${(t.time||'').toString().substring(0,16)}</td>
                <td style="color:${ac};font-weight:600">${action}</td>
                <td>$${(t.price||0).toLocaleString(undefined,{minimumFractionDigits:2})}</td>
                <td>${t.leverage||1}x</td>
                <td>$${(t.total||0).toLocaleString()}</td>
                <td style="font-size:11px;color:var(--text-muted);max-width:300px;overflow:hidden;text-overflow:ellipsis">${t.reason||''}</td>
            </tr>`;
        }).join('');

        // è·¨ç­–ç•¥å¯¹æ¯”
        const crossEl = document.getElementById('cs-cross-compare');
        const bestAlpha = best.alpha || 0;
        crossEl.innerHTML = `
        <div style="display:grid;grid-template-columns:repeat(3,1fr);gap:20px">
            <div style="background:var(--bg-secondary);border-radius:12px;padding:20px;text-align:center">
                <div style="font-size:12px;color:var(--text-muted);margin-bottom:6px">èåˆç­–ç•¥æœ€ä½³Î±</div>
                <div style="font-size:32px;font-weight:700;color:var(--accent-green)">${bestAlpha>0?'+':''}${bestAlpha.toFixed(2)}%</div>
                <div style="font-size:11px;color:var(--text-muted);margin-top:4px">${best.name}</div>
            </div>
            <div style="background:var(--bg-secondary);border-radius:12px;padding:20px;text-align:center">
                <div style="font-size:12px;color:var(--text-muted);margin-bottom:6px">äº¤æ˜“æ¬¡æ•° / å¼ºå¹³</div>
                <div style="font-size:32px;font-weight:700;color:var(--accent-blue)">${best.total_trades||0} / ${best.liquidations||0}</div>
                <div style="font-size:11px;color:var(--text-muted);margin-top:4px">æ‰‹ç»­è´¹ $${((best.fees||{}).total_costs||0).toLocaleString()}</div>
            </div>
            <div style="background:var(--bg-secondary);border-radius:12px;padding:20px;text-align:center">
                <div style="font-size:12px;color:var(--text-muted);margin-bottom:6px">æœ€å¤§å›æ’¤</div>
                <div style="font-size:32px;font-weight:700;color:var(--accent-yellow)">${(best.max_drawdown||0).toFixed(2)}%</div>
                <div style="font-size:11px;color:var(--text-muted);margin-top:4px">æœ€ç»ˆèµ„äº§ $${(best.final_total||0).toLocaleString()}</div>
            </div>
        </div>
        <div style="margin-top:20px;padding:16px;background:var(--bg-secondary);border-radius:12px;font-size:13px;color:var(--text-secondary);line-height:1.8">
            <b style="color:var(--accent-purple)">èåˆä¼˜åŠ¿åˆ†æ:</b><br>
            Â· èƒŒç¦»ç³»ç»Ÿæ“…é•¿æ£€æµ‹<b style="color:var(--accent-red)">é¡¶éƒ¨/åº•éƒ¨æ‹ç‚¹</b>ï¼Œå‡çº¿ç³»ç»Ÿæ“…é•¿ç¡®è®¤<b style="color:var(--accent-blue)">è¶‹åŠ¿æ–¹å‘</b><br>
            Â· ä¸¤è€…ç»“åˆå¯ä»¥åœ¨èƒŒç¦»ä¿¡å·å‡ºç°æ—¶ï¼Œç”¨å‡çº¿æ’åˆ—æ–¹å‘è¿›è¡ŒäºŒæ¬¡ç¡®è®¤ï¼Œè¿‡æ»¤å‡ä¿¡å·<br>
            Â· å…±æŒ¯ç­–ç•¥(C3)è™½ç„¶äº¤æ˜“æ¬¡æ•°å°‘ï¼Œä½†ä¿¡å·è´¨é‡æœ€é«˜ï¼›åŠ æƒç­–ç•¥(C1/C2)åˆ™å¹³è¡¡äº†ä¿¡å·è¦†ç›–ç‡å’Œå‡†ç¡®åº¦<br>
            Â· æ¿€è¿›åšç©º(C6)åœ¨ä¸‹è·Œè¡Œæƒ…ä¸­è¡¨ç°çªå‡ºï¼Œå› ä¸ºèƒŒç¦»é¡¶éƒ¨ä¿¡å·+å‡çº¿ç©ºå¤´æ’åˆ—çš„åŒé‡ç¡®è®¤å¤§å¹…æå‡äº†åšç©ºæ—¶æœºçš„å‡†ç¡®æ€§
        </div>`;

        // ç»“è®º
        const conclusionEl = document.getElementById('cs-conclusion');
        const bestFees = best.fees || {};
        conclusionEl.innerHTML = `
            <div class="card-title">å›æµ‹ç»“è®º</div>
            <div style="background:rgba(168,85,247,0.08);border-radius:8px;padding:16px;border-left:3px solid var(--accent-purple);">
                <div style="font-weight:700;color:var(--accent-purple);margin-bottom:8px;">
                    æœ€ä½³èåˆç­–ç•¥: ${best.name} Â· Î± = ${bestAlpha > 0 ? '+' : ''}${bestAlpha.toFixed(2)}%
                </div>
                <div style="font-size:13px;color:var(--text-secondary);line-height:1.8;">
                    åŸºäºã€ŠèƒŒç¦»æŠ€æœ¯åˆ†æã€‹å’Œã€Šå‡çº¿æŠ€æœ¯åˆ†æã€‹åŒä¹¦èåˆ, åœ¨ETH/USDT ${data.trade_days || 30}å¤©å›æµ‹ä¸­:<br>
                    Â· ä¹°å…¥æŒæœ‰æ”¶ç›Š: ${(best.buy_hold_return || 0).toFixed(2)}%<br>
                    Â· æœ€ä½³ç­–ç•¥æ”¶ç›Š: ${(best.strategy_return || 0).toFixed(2)}%, è¶…é¢Î± = ${bestAlpha > 0 ? '+' : ''}${bestAlpha.toFixed(2)}%<br>
                    Â· äº¤æ˜“${best.total_trades||0}ç¬”, æœ€å¤§å›æ’¤${(best.max_drawdown||0).toFixed(2)}%<br>
                    Â· æ€»è´¹ç”¨: ç°è´§$${(bestFees.spot_fees||0).toLocaleString()} + åˆçº¦$${(bestFees.futures_fees||0).toLocaleString()} + èµ„é‡‘è´¹$${(bestFees.net_funding||0).toLocaleString()} + æ»‘ç‚¹$${(bestFees.slippage_cost||0).toLocaleString()}<br>
                    Â· <b style="color:var(--accent-purple)">æ ¸å¿ƒä»·å€¼:</b> ä¸¤æœ¬ä¹¦çš„æŠ€æœ¯ä½“ç³»äº’è¡¥èåˆ, èƒŒç¦»æ£€æµ‹æ‹ç‚¹ + å‡çº¿ç¡®è®¤è¶‹åŠ¿, æœ‰æ•ˆå‡å°‘å‡ä¿¡å·, æå‡äº¤æ˜“è´¨é‡
                </div>
            </div>
        `;
    }
    </script>
</body>
</html>
